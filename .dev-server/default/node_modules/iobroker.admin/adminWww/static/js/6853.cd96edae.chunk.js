(self.webpackChunksrc_rx=self.webpackChunksrc_rx||[]).push([[6853],{9995:(t,e,s)=>{"use strict";s.r(e),s.d(e,{ConfigGeneric:()=>g,ConfigPanel:()=>Ae,JsonConfig:()=>qe,JsonConfigComponent:()=>Be});var i=s(29183),o=s.n(i),a=s(77226),n=s.n(a),r=s(83931),l=s.n(r),h=s(89303),p=s(32075),c=s(16904),d=s(79159);const u=window.innerWidth<=600?12:void 0;function m(t){return"[object Object]"===Object.prototype.toString.call(t)}class g extends i.Component{constructor(t){super(t),this.defaultValue=void 0,this.isError=void 0,this.lang=void 0,this.defaultSendToDone=void 0,this.sendToTimeout=void 0,this.noPlaceRequired=void 0,this.onUpdate=t=>{const e=g.getValue(t||this.props.data,this.props.attr)||"";this.state.value!==e?this.setState({value:e}):this.forceUpdate()},this.state={confirmDialog:!1,confirmNewValue:null,confirmAttr:null,confirmData:null,confirmCallback:null},this.isError={},t.schema&&(t.custom?this.defaultValue=t.schema.defaultFunc?this.executeCustom(t.schema.defaultFunc,t.data,t.customObj,t.oContext.instanceObj,t.arrayIndex,t.globalData):t.schema.default:"state"!==t.schema.type&&(this.defaultValue=t.schema.defaultFunc?this.execute(t.schema.defaultFunc,t.schema.default,t.data,t.arrayIndex,t.globalData):t.schema.default)),this.lang=c.I18n.getLanguage()}componentDidMount(){this.props.oContext.registerOnForceUpdate&&this.props.oContext.registerOnForceUpdate(this.props.attr,this.onUpdate);const t=["select","autocomplete","autocompleteSendTo"];if(void 0!==this.defaultValue){const e=g.getValue(this.props.data,this.props.attr);(void 0===e||t.includes(this.props.schema.type)&&(""===e||null===e))&&setTimeout((()=>{this.props.custom?this.props.onChange(this.props.attr,this.defaultValue,(()=>setTimeout((()=>this.props.oContext.forceUpdate([this.props.attr],this.props.data)),100))):(g.setValue(this.props.data,this.props.attr,this.defaultValue),this.props.onChange(this.props.data,void 0,(()=>this.props.oContext.forceUpdate([this.props.attr],this.props.data))))}),100)}else this.props.schema.defaultSendTo&&this.sendTo()}sendTo(){if(this.props.alive){this.defaultSendToDone=!0;let t=this.props.schema.data;if(void 0===t&&this.props.schema.jsonData){const e=this.getPattern(this.props.schema.jsonData,null,!0);try{t=JSON.parse(e)}catch{console.error(`Cannot parse json data: ${e}`)}}else t={attr:this.props.attr,value:g.getValue(this.props.data,this.props.attr)};void 0===t&&(t=null),this.props.oContext.socket.sendTo(`${this.props.oContext.adapterName}.${this.props.oContext.instance}`,this.props.schema.defaultSendTo,t).then((t=>{null!==t&&void 0!==t&&(this.props.custom?this.props.onChange(this.props.attr,t,(()=>this.props.oContext.forceUpdate([this.props.attr],this.props.data))):(g.setValue(this.props.data,this.props.attr,t),this.props.onChange(this.props.data,void 0,(()=>this.props.oContext.forceUpdate([this.props.attr],this.props.data)))))}))}else this.defaultSendToDone=!1,this.props.schema.allowSaveWithError||this.onError(this.props.attr,c.I18n.t("ra_Instance %s is not alive",this.props.oContext.instance.toString()))}componentWillUnmount(){this.props.oContext.registerOnForceUpdate&&this.props.oContext.registerOnForceUpdate(this.props.attr),this.sendToTimeout&&(clearTimeout(this.sendToTimeout),this.sendToTimeout=null)}static getValue(t,e){if("string"===typeof e)return g.getValue(t,e.split("."));if(1===e.length)return t[e[0]];const s=e.shift();return"string"===typeof s&&"object"===typeof t[s]?g.getValue(t[s],e):void 0}static setValue(t,e,s){if("string"!==typeof e)if(1===e.length)null===s?delete t[e[0]]:t[e[0]]=s;else{const i=e.shift();if("string"!==typeof i)return;t[i]&&"object"!==typeof t[i]||(t[i]=t[i]||{}),g.setValue(t[i],e,s)}else g.setValue(t,e.split("."),s)}getText(t,e){if(!t)return"";if("string"===typeof t){const s=e?t:c.I18n.t(t);return s.includes("${")?this.getPattern(s,null,e):s}return m(t)?t.func?"object"===typeof t.func?this.getPattern(t.func[this.lang]||t.func.en||"",null,!0):this.getPattern(t.func,null,e):t[this.lang]||t.en||"":t.toString()}renderDialogConfirm(){if(!this.state.confirmDialog)return null;const t=this.state.confirmData||this.props.schema.confirm;let e=null;return"warning"===t.type?e=(0,d.jsx)(p.Warning,{}):"error"===t.type?e=(0,d.jsx)(p.Error,{}):"info"===t.type&&(e=(0,d.jsx)(p.Info,{})),(0,d.jsx)(c.DialogConfirm,{title:this.getText(t.title)||c.I18n.t("ra_Please confirm"),text:this.getText(t.text),ok:this.getText(t.ok)||c.I18n.t("ra_Ok"),cancel:this.getText(t.cancel)||c.I18n.t("ra_Cancel"),icon:e||void 0,onClose:t=>this.setState({confirmDialog:!1},(()=>{if(t){if(this.state.confirmCallback){const t=this.state.confirmCallback;return void this.setState({confirmCallback:null},(()=>t(!0)))}const t=JSON.parse(JSON.stringify(this.props.data));this.state.confirmDepAttr&&g.setValue(t,this.state.confirmDepAttr,this.state.confirmDepNewValue),g.setValue(t,this.state.confirmAttr,this.state.confirmNewValue),this.setState({confirmDialog:!1,confirmDepAttr:null,confirmDepNewValue:null,confirmNewValue:null,confirmAttr:null,confirmData:null},(()=>this.props.onChange(t)))}else{const t=this.state.confirmCallback;this.setState({confirmDialog:!1,confirmDepAttr:null,confirmDepNewValue:null,confirmNewValue:null,confirmAttr:null,confirmData:null,confirmCallback:null},(()=>{t&&t(!1)}))}}))})}getIcon(t){let e=null;return"auth"===(t=t||this.props.schema.icon)?e=(0,d.jsx)(p.Key,{}):"send"===t?e=(0,d.jsx)(p.Send,{}):"web"===t?e=(0,d.jsx)(p.Public,{}):"warning"===t?e=(0,d.jsx)(p.Warning,{}):"error"===t?e=(0,d.jsx)(p.Error,{}):"info"===t?e=(0,d.jsx)(p.Info,{}):"search"===t?e=(0,d.jsx)(p.Search,{}):"book"===t?e=(0,d.jsx)(p.MenuBook,{}):"help"===t?e=(0,d.jsx)(p.Help,{}):"upload"===t?e=(0,d.jsx)(p.UploadFile,{}):"edit"===t?e=(0,d.jsx)(p.Edit,{}):"user"===t?e=(0,d.jsx)(p.Person,{}):"group"===t?e=(0,d.jsx)(p.Group,{}):"delete"===t?e=(0,d.jsx)(p.Delete,{}):"refresh"===t?e=(0,d.jsx)(p.Refresh,{}):"add"===t?e=(0,d.jsx)(p.Add,{}):"unpair"===t?e=(0,d.jsx)(p.LinkOff,{}):"pair"===t?e=(0,d.jsx)(p.Link,{}):"save"===t?e=(0,d.jsx)(p.Save,{}):"open"===t?e=(0,d.jsx)(p.OpenInNew,{}):t&&((t.endsWith(".png")||t.endsWith(".svg")||t.endsWith(".jpg"))&&(t.startsWith("http://")||t.startsWith("https://")||(t=`./adapter/${this.props.oContext.adapterName}/${t}`)),e=(0,d.jsx)(c.Icon,{src:t,style:{width:22,height:22}})),e}onChangeAsync(t,e){return new Promise((s=>{const i=this.onChange(t,e,s);i instanceof Promise&&i.catch((t=>console.error(`Cannot set value: ${t}`)))}))}onChange(t,e,s){const i=JSON.parse(JSON.stringify(this.props.data));if(g.setValue(i,t,e),this.props.schema.confirm&&this.execute(this.props.schema.confirm.condition,!1,i,this.props.arrayIndex,this.props.globalData))return new Promise((i=>{this.setState({confirmDialog:!0,confirmNewValue:e,confirmAttr:t,confirmData:null},(()=>{"function"===typeof s?s():i()}))}));if(this.props.schema.confirmDependsOn)for(let a=0;a<this.props.schema.confirmDependsOn.length;a++){const o=this.props.schema.confirmDependsOn[a];if(o.confirm){const a=g.getValue(i,o.attr);if(this.execute(o.confirm.condition,!1,i,this.props.arrayIndex,this.props.globalData))return new Promise((i=>{this.setState({confirmDialog:!0,confirmNewValue:e,confirmAttr:t,confirmDepNewValue:a,confirmDepAttr:o.attr,confirmData:o.confirm},(()=>{"function"===typeof s?s():i()}))}))}}const o=[];if(this.props.schema.onChangeDependsOn)for(let a=0;a<this.props.schema.onChangeDependsOn.length;a++){const t=this.props.schema.onChangeDependsOn[a];if(t.onChange){const e=g.getValue(i,t.attr);let s;s=this.props.custom?this.executeCustom(t.onChange.calculateFunc,i,this.props.customObj,this.props.oContext.instanceObj,this.props.arrayIndex,this.props.globalData):this.execute(t.onChange.calculateFunc,e,i,this.props.arrayIndex,this.props.globalData),s!==e&&(g.setValue(i,t.attr,s),o.push(t.attr))}}if(this.props.schema.hiddenDependsOn)for(let a=0;a<this.props.schema.hiddenDependsOn.length;a++){const t=this.props.schema.hiddenDependsOn[a];t.hidden&&o.push(t.attr)}if(this.props.schema.labelDependsOn)for(let a=0;a<this.props.schema.labelDependsOn.length;a++){const t=this.props.schema.labelDependsOn[a];t.hidden&&o.push(t.attr)}if(this.props.schema.helpDependsOn)for(let a=0;a<this.props.schema.helpDependsOn.length;a++){const t=this.props.schema.helpDependsOn[a];t.hidden&&o.push(t.attr)}if(this.props.schema.onChange&&!this.props.schema.onChange.ignoreOwnChanges){const t=g.getValue(i,this.props.attr),e=this.props.custom?this.executeCustom(this.props.schema.onChange.calculateFunc,i,this.props.customObj,this.props.oContext.instanceObj,this.props.arrayIndex,this.props.globalData):this.execute(this.props.schema.onChange.calculateFunc,t,i,this.props.arrayIndex,this.props.globalData);e!==t&&g.setValue(i,this.props.attr,e)}return this.props.custom?(this.props.onChange(t,e,(()=>s&&s())),null!==o&&void 0!==o&&o.length&&o.forEach(((t,e)=>setTimeout((()=>this.props.onChange(t,g.getValue(i,t))),50*e)))):this.props.onChange(i,void 0,(()=>{o.length&&this.props.oContext.forceUpdate(o,i),s&&s()})),Promise.resolve()}execute(t,e,s,i,o){let a;if(m(t))a=t.func;else{if("string"!==typeof t)return t;a=t}if(!a)return e;try{return new Function("data","originalData","_system","_alive","_common","_socket","_instance","arrayIndex","globalData","_changed",a.includes("return")?a:`return ${a}`)(s||this.props.data,this.props.originalData,this.props.oContext.systemConfig,this.props.alive,this.props.common,this.props.oContext.socket,this.props.oContext.instance,i,o,this.props.changed)}catch(n){return console.error(`Cannot execute ${JSON.stringify(t)}: ${n}`),e}}executeCustom(t,e,s,i,o,a){let n;if(m(t))n=t.func;else{if("string"!==typeof t)return t;n=t}if(!n)return null;try{return new Function("data","originalData","_system","instanceObj","customObj","_socket","arrayIndex","globalData","_changed",n.includes("return")?n:`return ${n}`)(e||this.props.data,this.props.originalData,this.props.oContext.systemConfig,i,s,this.props.oContext.socket,o,a,this.props.changed)}catch(r){return console.error(`Cannot execute ${n}: ${r}`),null}}calculate(t){let e,s,i,o;return this.props.custom?(e=!!t.validator&&!this.executeCustom(t.validator,this.props.data,this.props.customObj,this.props.oContext.instanceObj,this.props.arrayIndex,this.props.globalData),s=!0===t.disabled||!!t.disabled&&this.executeCustom(t.disabled,this.props.data,this.props.customObj,this.props.oContext.instanceObj,this.props.arrayIndex,this.props.globalData),i=!0===t.hidden||!!t.hidden&&this.executeCustom(t.hidden,this.props.data,this.props.customObj,this.props.oContext.instanceObj,this.props.arrayIndex,this.props.globalData),o=t.defaultFunc?this.executeCustom(t.defaultFunc,this.props.data,this.props.customObj,this.props.oContext.instanceObj,this.props.arrayIndex,this.props.globalData):t.default):(e=!!t.validator&&!this.execute(t.validator,!1,this.props.data,this.props.arrayIndex,this.props.globalData),s=!0===t.disabled||!!t.disabled&&this.execute(t.disabled,!1,this.props.data,this.props.arrayIndex,this.props.globalData),i=!0===t.hidden||!!t.hidden&&this.execute(t.hidden,!1,this.props.data,this.props.arrayIndex,this.props.globalData),o=t.defaultFunc?this.execute(t.defaultFunc,t.default,this.props.data,this.props.arrayIndex,this.props.globalData):t.default),{error:e,disabled:s,hidden:i,defaultValue:o}}onError(t,e){e?this.isError[t]=e:delete this.isError[t],this.props.onError&&this.props.onError(t,e)}renderItem(t,e,s){return this.getText(this.props.schema.label)||this.getText(this.props.schema.text)}renderHelp(t,e,s){return e?(0,d.jsx)("a",{href:e,target:"_blank",rel:"noreferrer",style:{color:"dark"===this.props.oContext.themeType?"#a147ff":"#5b238f",textDecoration:"underline"},children:this.getText(t,s)}):(t=this.getText(t,s)||"")&&(t.includes("<a ")||t.includes("<br")||t.includes("<b>")||t.includes("<i>"))?c.Utils.renderTextWithA(t):t}static escapeString(t,e){return"string"!==typeof t?"":t=(t=t.replace(/`/g,"\\`")).replace(/\${([^}]+)}/g,((t,s)=>{if(s&&"string"===typeof s&&s.startsWith("data.")){const t=g.getValue(e,s.replace(/^data\./,""));if("string"===typeof t&&t.includes('"'))return`\${${s}.replace(/"/g, '\\\\"')}`}return t}))}getPattern(t,e,s){if(e=e||this.props.data,!t)return"";let i;"object"===typeof t?t.func?i=t.func:(console.log(`Object must be stringified: ${JSON.stringify(t)}`),i=JSON.stringify(t)):i=t;try{if(this.props.custom){return new Function("data","originalData","arrayIndex","globalData","_system","instanceObj","customObj","_socket","_changed",`return \`${g.escapeString(i,e)}\``)(e,this.props.originalData,this.props.arrayIndex,this.props.globalData,this.props.oContext.systemConfig,this.props.oContext.instanceObj,this.props.customObj,this.props.oContext.socket,this.props.changed)}const t=new Function("data","originalData","arrayIndex","globalData","_system","_alive","_common","_socket","_changed",`return \`${g.escapeString(i,e)}\``)(e,this.props.originalData,this.props.arrayIndex,this.props.globalData,this.props.oContext.systemConfig,this.props.alive,this.props.common,this.props.oContext.socket,this.props.changed);return s?t:c.I18n.t(t)}catch(o){return console.error(`Cannot execute ${i}: ${o}`),i}}render(){const t=this.props.schema;if(!t)return null;if(!1===this.props.oContext.expertMode&&t.expertMode)return null;this.props.alive&&!1===this.defaultSendToDone&&(this.sendToTimeout=setTimeout((()=>{this.sendToTimeout=null,this.sendTo()}),200));const{error:e,disabled:s,hidden:i,defaultValue:o}=this.calculate(t);if(i){if(Object.keys(this.isError).length&&(setTimeout((t=>Object.keys(t).forEach((t=>this.props.onError(t)))),100,JSON.parse(JSON.stringify(this.isError))),this.isError={}),t.hideOnlyControl){const e=(0,d.jsx)(h.Grid2,{size:{xs:t.xs||u,sm:t.sm||void 0,md:t.md||void 0,lg:t.lg||void 0,xl:t.xl||void 0},style:{marginBottom:0,textAlign:"left",...t.style,..."dark"===this.props.oContext.themeType?t.darkStyle:{}}});return t.newLine?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{style:{flexBasis:"100%",height:0}}),e]}):e}return null}t.validatorNoSaveOnError&&(e&&!Object.keys(this.isError).length?(this.isError={[this.props.attr]:!t.validatorErrorText||c.I18n.t(t.validatorErrorText)},setTimeout((t=>Object.keys(t).forEach((e=>this.props.onError(e,t[e])))),100,JSON.parse(JSON.stringify(this.isError)))):!e&&Object.keys(this.isError).length&&(setTimeout((t=>Object.keys(t).forEach((t=>this.props.onError(t)))),100,JSON.parse(JSON.stringify(this.isError))),this.isError={}));const a=this.renderItem(e,s||this.props.commandRunning||this.props.disabled,o);if(this.noPlaceRequired)return a;const n=(0,d.jsx)(h.Grid2,{title:this.getText(t.tooltip),size:{xs:t.xs||12,sm:t.sm||void 0,md:t.md||void 0,lg:t.lg||void 0,xl:t.xl||void 0},style:{marginBottom:0,textAlign:"left",width:"divider"===t.type||"header"===t.type?t.width||"100%":void 0,...t.style,..."dark"===this.props.oContext.themeType?t.darkStyle:{}},children:this.props.schema.defaultSendTo&&this.props.schema.button?(0,d.jsxs)(h.Grid2,{container:!0,style:{width:"100%"},children:[(0,d.jsx)(h.Grid2,{flex:1,children:a}),(0,d.jsx)(h.Grid2,{children:(0,d.jsx)(h.Button,{disabled:s,variant:"outlined",onClick:()=>this.sendTo(),title:this.props.schema.buttonTooltip?this.getText(this.props.schema.buttonTooltip,this.props.schema.buttonTooltipNoTranslation):c.I18n.t("ra_Request data by instance"),children:this.getText(this.props.schema.button)})})]}):a});return t.newLine?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{style:{flexBasis:"100%",height:0}}),this.renderDialogConfirm(),n]}):this.state.confirmDialog?(0,d.jsxs)(d.Fragment,{children:[this.renderDialogConfirm(),n]}):n}}g.DIFFERENT_VALUE="__different__",g.DIFFERENT_LABEL="ra___different__",g.NONE_VALUE="",g.NONE_LABEL="ra_none";const x={fullWidth:{width:"100%"},accordionSummary:t=>({backgroundColor:"dark"===t.palette.mode?"rgba(255, 255, 255, 0.08)":"rgba(0, 0, 0, 0.08)"}),accordionTitle:{},toolbar:t=>({backgroundColor:"dark"===t.palette.mode?"rgba(255, 255, 255, 0.08)":"rgba(0, 0, 0, 0.08)",borderRadius:"3px"}),tooltip:{pointerEvents:"none"}};const v=class extends g{constructor(t){super(t),this.typingTimer=null,this.onDelete=t=>()=>{const e=JSON.parse(JSON.stringify(this.state.value));e.splice(t,1),this.setState({value:e,iteration:this.state.iteration+1e4},(()=>this.onChangeWrapper(e)))},this.onClone=t=>()=>{const e=JSON.parse(JSON.stringify(this.state.value)),s=JSON.parse(JSON.stringify(e[t]));if("string"===typeof this.props.schema.clone&&"string"===typeof s[this.props.schema.clone]){let t=1,i=s[this.props.schema.clone];const o=i.match(/(\d+)$/);for(o?(i=i.replace(o[0],""),t=parseInt(o[0],10)+1):i+="_";e.find((e=>e[this.props.schema.clone]===i+t.toString()));)t++;s[this.props.schema.clone]=`${s[this.props.schema.clone]}_${t}`}e.splice(t,0,s),this.setState({value:e,activeIndex:-1,iteration:this.state.iteration+1e4},(()=>this.onChangeWrapper(e)))},this.onChangeWrapper=t=>{this.typingTimer&&clearTimeout(this.typingTimer),this.typingTimer=setTimeout((t=>{this.typingTimer=null;const e=this.onChange(this.props.attr,t);e instanceof Promise&&e.catch((t=>this.onError(t)))}),300,t)},this.onAdd=()=>{const{schema:t}=this.props,e=JSON.parse(JSON.stringify(this.state.value)),s=t.items&&t.items.reduce(((t,s)=>{let i;return i=s.defaultFunc?this.props.custom?s.defaultFunc?this.executeCustom(s.defaultFunc,this.props.data,this.props.customObj,this.props.oContext.instanceObj,e.length,this.props.data):this.props.schema.default:s.defaultFunc?this.execute(s.defaultFunc,this.props.schema.default,this.props.data,e.length,this.props.data):this.props.schema.default:void 0===s.default?null:s.default,t[s.attr]=i,t}),{});e.push(s),this.setState({value:e,activeIndex:e.length-1},(()=>this.onChangeWrapper(e)))},this.props.schema.items=this.props.schema.items||[]}componentDidMount(){super.componentDidMount();let t=g.getValue(this.props.data,this.props.attr)||[];Array.isArray(t)||(t=[]),this.setState({value:t,activeIndex:-1,iteration:0})}componentWillUnmount(){this.typingTimer&&(clearTimeout(this.typingTimer),this.typingTimer=null),super.componentWillUnmount()}itemAccordion(t,e){const{value:s}=this.state,{schema:i}=this.props,o={type:"panel",items:i.items.reduce(((t,e)=>(t[e.attr]=e,t)),{}),style:{marginLeft:"-8px",marginTop:"10px",marginBottom:"10px"}};return(0,d.jsx)(Ae,{oContext:this.props.oContext,index:e+this.state.iteration,arrayIndex:e,changed:this.props.changed,globalData:this.props.data,common:this.props.common,alive:this.props.alive,themeName:this.props.themeName,data:t,custom:!0,schema:o,originalData:this.props.originalData,onChange:(t,i)=>{const o=JSON.parse(JSON.stringify(s));o[e][t]=i,this.setState({value:o},(()=>this.onChangeWrapper(o)))},onError:(t,e)=>this.onError(t,e),table:this.props.table})}onMoveUp(t){const e=JSON.parse(JSON.stringify(this.state.value)),s=e[t];e.splice(t,1),e.splice(t-1,0,s);const i=this.state.activeIndex-1;this.setState({value:e,activeIndex:i,iteration:this.state.iteration+1e4},(()=>this.onChangeWrapper(e)))}onMoveDown(t){const e=JSON.parse(JSON.stringify(this.state.value)),s=e[t];e.splice(t,1),e.splice(t+1,0,s);const i=this.state.activeIndex+1;this.setState({value:e,activeIndex:i,iteration:this.state.iteration+1e4},(()=>this.onChangeWrapper(e)))}renderItem(){const{schema:t}=this.props,{value:e}=this.state;return e?(0,d.jsxs)(h.Paper,{children:[t.label||!t.noDelete?(0,d.jsxs)(h.Toolbar,{variant:"dense",children:[t.label?(0,d.jsx)(h.Typography,{variant:"h6",id:"tableTitle",component:"div",children:this.getText(t.label)}):null,t.noDelete?null:(0,d.jsx)(h.IconButton,{size:"small",color:"primary",onClick:this.onAdd,children:(0,d.jsx)(p.Add,{})})]}):null,e.map(((s,i)=>(0,d.jsxs)(h.Accordion,{expanded:this.state.activeIndex===i,onChange:(t,e)=>this.setState({activeIndex:e?i:-1}),children:[(0,d.jsx)(h.AccordionSummary,{expandIcon:(0,d.jsx)(p.ExpandMore,{}),sx:c.Utils.getStyle(this.props.oContext.theme,x.fullWidth,x.accordionSummary),children:(0,d.jsx)(h.Typography,{style:x.accordionTitle,children:s[t.titleAttr]})}),(0,d.jsxs)(h.AccordionDetails,{style:{...t.style,...this.props.oContext.themeType?t.darkStyle:void 0},children:[this.itemAccordion(e[i],i),(0,d.jsxs)(h.Toolbar,{sx:x.toolbar,children:[i?(0,d.jsx)(h.Tooltip,{title:c.I18n.t("ra_Move up"),slotProps:{popper:{sx:x.tooltip}},children:(0,d.jsx)(h.IconButton,{size:"small",onClick:()=>this.onMoveUp(i),children:(0,d.jsx)(p.ArrowUpward,{})})}):(0,d.jsx)("div",{style:x.buttonEmpty}),i<e.length-1?(0,d.jsx)(h.Tooltip,{title:c.I18n.t("ra_Move down"),slotProps:{popper:{sx:x.tooltip}},children:(0,d.jsx)(h.IconButton,{size:"small",onClick:()=>this.onMoveDown(i),children:(0,d.jsx)(p.ArrowDownward,{})})}):(0,d.jsx)("div",{style:x.buttonEmpty}),t.noDelete?null:(0,d.jsx)(h.Tooltip,{title:c.I18n.t("ra_Delete current row"),slotProps:{popper:{sx:x.tooltip}},children:(0,d.jsx)(h.IconButton,{size:"small",onClick:this.onDelete(i),children:(0,d.jsx)(p.Delete,{})})}),t.clone?(0,d.jsx)(h.Tooltip,{title:c.I18n.t("ra_Clone current row"),slotProps:{popper:{sx:x.tooltip}},children:(0,d.jsx)(h.IconButton,{size:"small",onClick:this.onClone(i),children:(0,d.jsx)(p.ContentCopy,{})})}):null]})]})]},`${s}_${i}`))),!t.noDelete&&e.length>0?(0,d.jsx)(h.Toolbar,{variant:"dense",sx:x.rootTool,children:(0,d.jsx)(h.IconButton,{size:"small",color:"primary",onClick:this.onAdd,children:(0,d.jsx)(p.Add,{})})}):null,t.help?(0,d.jsx)(h.FormHelperText,{children:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)}):null]}):null}},f={width:"100%"},y={color:"#a30000"};const b=class extends g{componentDidMount(){super.componentDidMount();const t=this.getInstance();this.props.oContext.socket.getState(`${t}.alive`).then((e=>this.setState({alive:!(!e||!e.val),instance:t})))}getInstance(){let t=this.props.schema.instance||`${this.props.oContext.adapterName}.${this.props.oContext.instance}`;return t.includes("${")&&(t=this.getPattern(t,null,!0)),t&&!t.startsWith("system.adapter.")&&(t=`system.adapter.${t}`),t}renderItem(){if(this.getInstance()!==this.state.instance&&setTimeout((()=>{const t=this.getInstance();t?this.props.oContext.socket.getState(`${t}.alive`).then((e=>this.setState({alive:!(!e||!e.val),instance:t}))):this.setState({alive:null,instance:t})}),200),!1!==this.state.alive&&!0!==this.state.alive)return null;const t=this.state.instance.replace(/^system.adapter./,"");return(0,d.jsx)("div",{style:{...f,...this.state.alive?void 0:y},children:this.state.alive?void 0!==this.props.schema.textAlive?this.props.schema.textAlive?c.I18n.t(this.props.schema.textAlive,t):"":c.I18n.t("ra_Instance %s is alive",t):void 0!==this.props.schema.textNotAlive?this.props.schema.textNotAlive?c.I18n.t(this.props.schema.textNotAlive,t):"":c.I18n.t("ra_Instance %s is not alive",t)})}};const C=class extends g{componentDidMount(){super.componentDidMount();const t=g.getValue(this.props.data,this.props.attr),e=this.props.schema.options.map((t=>"string"===typeof t?{label:t,value:t}:JSON.parse(JSON.stringify(t))));Array.isArray(t)?(e.unshift({label:c.I18n.t(g.DIFFERENT_LABEL),value:g.DIFFERENT_VALUE}),this.setState({value:g.DIFFERENT_VALUE,selectOptions:e})):this.setState({value:t,selectOptions:e})}renderItem(t,e){if(!this.state.selectOptions)return null;let s;const i=JSON.parse(JSON.stringify(this.state.selectOptions));return Array.isArray(this.state.value)||this.state.value===g.DIFFERENT_VALUE?([...this.state.value].filter((t=>!i.find((e=>"object"===typeof e?e.value===t:e===t)))).forEach((t=>i.push({label:t.toString(),value:t}))),s={label:c.I18n.t(g.DIFFERENT_LABEL),value:g.DIFFERENT_VALUE},i.unshift(s)):(s=null!==this.state.value&&void 0!==this.state.value&&i.find((t=>"object"===typeof t?t.value==this.state.value:t==this.state.value)),null!==this.state.value&&void 0!==this.state.value&&!s&&this.props.schema.freeSolo&&(s={value:this.state.value,label:this.state.value},i.push(s))),(0,d.jsx)(h.Autocomplete,{fullWidth:!0,freeSolo:!!this.props.schema.freeSolo,value:s,options:i,isOptionEqualToValue:(t,e)=>t.value===e.value,filterOptions:(t,e)=>{const s=t.filter((t=>""===e.inputValue||(t.label.toLowerCase().includes(e.inputValue.toLowerCase())||t.value.toLowerCase().includes(e.inputValue.toLowerCase()))));return this.props.schema.freeSolo&&""!==e.inputValue&&s.push({label:e.inputValue,value:e.inputValue}),s},onInputChange:t=>{if(!t||!this.props.schema.freeSolo)return;const e=t.target.value;e!==this.state.value&&this.setState({value:e},(()=>this.onChange(this.props.attr,e)))},onChange:(t,e)=>{const s="object"===typeof e?e?e.value:"":e;s!==this.state.value&&this.setState({value:s},(()=>this.onChange(this.props.attr,s)))},getOptionLabel:t=>{var e;return"object"===typeof t&&null!==(e=null===t||void 0===t?void 0:t.label)&&void 0!==e?e:""},renderInput:s=>(0,d.jsx)(h.TextField,{variant:"standard",...s,error:!!t,placeholder:this.getText(this.props.schema.placeholder),label:this.getText(this.props.schema.label),helperText:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation),disabled:e})})}};const j=class extends g{constructor(){super(...arguments),this.initialized=!1,this.localContext=void 0}askInstance(){const t=g.getValue(this.props.data,this.props.attr),e=this.props.schema.options?this.props.schema.options.map((t=>"string"===typeof t?{label:t,value:t}:JSON.parse(JSON.stringify(t)))):[];if(this.props.alive){let s=this.props.schema.data;if(void 0===s&&this.props.schema.jsonData){const t=this.getPattern(this.props.schema.jsonData,null,!0);try{"string"===typeof t&&(s=JSON.parse(t))}catch{console.error(`Cannot parse json data: ${JSON.stringify(s)}`)}}void 0===s&&(s=null),this.props.oContext.socket.sendTo(`${this.props.oContext.adapterName}.${this.props.oContext.instance}`,this.props.schema.command||"send",s).then((s=>{s&&Array.isArray(s)&&s.forEach((t=>e.push("string"===typeof t?{label:t,value:t}:JSON.parse(JSON.stringify(t))))),Array.isArray(t)?(e.unshift({label:c.I18n.t(g.DIFFERENT_LABEL),value:g.DIFFERENT_VALUE}),this.setState({value:g.DIFFERENT_VALUE,selectOptions:e})):this.setState({value:t,selectOptions:e})}))}else Array.isArray(t)?(e.unshift({label:c.I18n.t(g.DIFFERENT_LABEL),value:g.DIFFERENT_VALUE}),this.setState({value:g.DIFFERENT_VALUE,selectOptions:e})):this.setState({value:t,selectOptions:e})}getContext(){const t={};return Array.isArray(this.props.schema.alsoDependsOn)&&this.props.schema.alsoDependsOn.forEach((e=>t[e]=g.getValue(this.props.data,e))),JSON.stringify(t)}renderItem(t,e){if(this.props.alive){const t=this.getContext();t===this.localContext&&this.initialized||(this.localContext=t,setTimeout((()=>this.askInstance()),this.initialized?300:50),this.initialized=!0)}let s;const i=this.state.selectOptions?JSON.parse(JSON.stringify(this.state.selectOptions)):[];return Array.isArray(this.state.value)||this.state.value===g.DIFFERENT_LABEL?([...this.state.value].filter((t=>!i.find((e=>e.value===t)))).forEach((t=>i.push({label:t.toString(),value:t}))),s={label:c.I18n.t(g.DIFFERENT_LABEL),value:g.DIFFERENT_VALUE},i.unshift(s)):(s=null!==this.state.value&&void 0!==this.state.value&&i.find((t=>t.value==this.state.value)),null!==this.state.value&&void 0!==this.state.value&&!s&&this.props.schema.freeSolo&&(s={value:this.state.value,label:this.state.value},i.push(s)),s=s||null),i.length?(0,d.jsx)(h.Autocomplete,{value:s,fullWidth:!0,freeSolo:!!this.props.schema.freeSolo,options:i,isOptionEqualToValue:(t,e)=>t.value===e.value,filterOptions:(t,e)=>{const s=t.filter((t=>""===e.inputValue||(t.label.toLowerCase().includes(e.inputValue.toLowerCase())||t.value.toLowerCase().includes(e.inputValue.toLowerCase()))));return this.props.schema.freeSolo&&""!==e.inputValue&&s.push({label:e.inputValue,value:e.inputValue}),s},getOptionLabel:t=>{var e;return null!==(e=null===t||void 0===t?void 0:t.label)&&void 0!==e?e:""},onInputChange:t=>{if(!t||!this.props.schema.freeSolo)return;const e=t.target.value;e!==this.state.value&&this.setState({value:e},(()=>this.onChange(this.props.attr,e)))},onChange:(t,e)=>{const s="object"===typeof e?e?e.value:"":e;s!==this.state.value&&this.setState({value:s},(()=>this.onChange(this.props.attr,s)))},renderInput:s=>(0,d.jsx)(h.TextField,{variant:"standard",...s,error:!!t,placeholder:this.getText(this.props.schema.placeholder),label:this.getText(this.props.schema.label),helperText:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation),disabled:e})}):(0,d.jsx)(h.TextField,{variant:"standard",fullWidth:!0,value:null===this.state.value||void 0===this.state.value?"":this.state.value,error:!!t,disabled:e,slotProps:{htmlInput:{maxLength:this.props.schema.maxLength||this.props.schema.max||void 0}},onChange:t=>{const e=t.target.value;this.setState({value:e},(()=>this.onChange(this.props.attr,(e||"").trim())))},placeholder:this.getText(this.props.schema.placeholder),label:this.getText(this.props.schema.label),helperText:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)})}},w={fullWidth:{width:"100%"},flex:{display:"flex"},button:{height:48,marginLeft:4,minWidth:48}};const I=class extends g{componentDidMount(){super.componentDidMount();const{data:t,attr:e}=this.props,s=g.getValue(t,e)||"";this.setState({value:s,showDialog:!1})}renderItem(t,e){const{schema:s,attr:i}=this.props,{value:o,showDialog:a}=this.state;return(0,d.jsxs)(h.FormControl,{style:w.fullWidth,variant:"standard",children:[s.label?(0,d.jsx)(h.InputLabel,{shrink:!0,children:this.getText(s.label)}):null,(0,d.jsxs)("div",{style:w.flex,children:[(0,d.jsx)(h.TextField,{variant:"standard",fullWidth:!0,value:null!==o&&void 0!==o?o:"",error:!!t,disabled:e,placeholder:this.getText(s.placeholder),label:this.getText(s.label),helperText:this.renderHelp(s.help,s.helpLink,s.noTranslation),onChange:t=>{const e=t.target.value;this.setState({value:e},(()=>this.onChange(i,e)))}}),(0,d.jsx)(h.Button,{color:"grey",disabled:e,style:w.button,size:"small",variant:"outlined",onClick:()=>this.setState({showDialog:!0}),children:"..."})]}),a?(0,d.jsx)(c.DialogCron,{title:c.I18n.t("ra_Define schedule"),simple:s.simple,complex:s.complex,cron:o,onClose:()=>this.setState({showDialog:!1}),cancel:c.I18n.t("ra_Cancel"),ok:c.I18n.t("ra_Ok"),theme:this.props.oContext.theme,onOk:t=>this.setState({showDialog:!1,value:t},(()=>this.onChange(i,t)))}):null]})}};const S=class extends g{async componentDidMount(){super.componentDidMount();const t=g.getValue(this.props.data,this.props.attr),e=(await this.props.oContext.socket.getCertificates()).filter((t=>{const e=this.props.attr.toLowerCase();return!!e.includes(t.type)||(!("public"!==t.type||!e.includes("cert"))||(!("private"!==t.type||!e.includes("priv")&&!e.includes("key"))||!("chained"!==t.type||!e.includes("chain")&&!e.includes("ca"))))})).map((t=>({label:t.name,value:t.name})));e.unshift({label:c.I18n.t(g.NONE_LABEL),value:g.NONE_VALUE}),this.setState({value:t,selectOptions:e})}renderItem(t,e){var s,i;if(!this.state.selectOptions)return null;const o=null===(s=this.state.selectOptions)||void 0===s?void 0:s.find((t=>t.value===this.state.value));return(0,d.jsxs)(h.FormControl,{style:{width:"100%"},variant:"standard",children:[this.props.schema.label?(0,d.jsx)(h.InputLabel,{shrink:!0,children:this.getText(this.props.schema.label)}):null,(0,d.jsx)(h.Select,{variant:"standard",error:!!t,displayEmpty:!0,disabled:!!e,value:this.state.value,renderValue:()=>this.getText(null===o||void 0===o?void 0:o.label,!1!==this.props.schema.noTranslation),onChange:t=>this.setState({value:t.target.value},(()=>this.onChange(this.props.attr,this.state.value))),children:null===(i=this.state.selectOptions)||void 0===i?void 0:i.map((t=>(0,d.jsx)(h.MenuItem,{value:t.value,style:t.value===g.NONE_VALUE?{opacity:.5}:{},children:this.getText(t.label,!1!==this.props.schema.noTranslation)},t.value)))}),this.props.schema.help?(0,d.jsx)(h.FormHelperText,{children:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)}):null]})}},T={fullWidth:{width:"100%"},leWidth:{width:620,marginBottom:10},certWidth:{width:200,marginRight:10}};const D=class extends g{async componentDidMount(){var t;super.componentDidMount();const e=await this.props.oContext.socket.getCertificates(),s=[],i=[],o=[];let a=[];const n=await this.props.oContext.socket.getObject("system.certificates");a=null!==n&&void 0!==n&&null!==(t=n.native)&&void 0!==t&&t.collections?Object.keys(n.native.collections):null,e.forEach((t=>{"public"===t.type?s.push({label:t.name,value:t.name}):"private"===t.type?i.push({label:t.name,value:t.name}):("chained"===t.type||(s.push({label:t.name,value:t.name}),i.push({label:t.name,value:t.name})),o.push({label:t.name,value:t.name}))})),s.unshift({label:c.I18n.t(g.NONE_LABEL),value:g.NONE_VALUE}),i.unshift({label:c.I18n.t(g.NONE_LABEL),value:g.NONE_VALUE}),o.unshift({label:c.I18n.t(g.NONE_LABEL),value:g.NONE_VALUE}),this.setState({certsPublicOptions:s,certsChainOptions:o,certsPrivateOptions:i,collectionsOptions:a})}renderItem(t,e){var s,i,o,a,n,r,l;if(!this.state.certsPublicOptions||!this.state.certsPrivateOptions||!this.state.certsChainOptions)return null;const p=(g.getValue(this.props.data,this.props.schema.leCollectionName||"leCollection")||"false").toString(),u=g.getValue(this.props.data,this.props.schema.certPublicName||"certPublic"),m=g.getValue(this.props.data,this.props.schema.certPrivateName||"certPrivate"),x=g.getValue(this.props.data,this.props.schema.certChainedName||"certChained"),v=null===(s=this.state.certsPublicOptions)||void 0===s?void 0:s.find((t=>t.value===u)),f=null===(i=this.state.certsPrivateOptions)||void 0===i?void 0:i.find((t=>t.value===m)),y=null===(o=this.state.certsChainOptions)||void 0===o?void 0:o.find((t=>t.value===x));return(0,d.jsxs)("div",{style:T.fullWidth,children:[this.state.collectionsOptions?(0,d.jsxs)(h.FormControl,{style:T.leWidth,variant:"standard",children:[(0,d.jsx)(h.InputLabel,{shrink:!0,children:"Let's encrypt"}),(0,d.jsxs)(h.Select,{variant:"standard",error:!!t,displayEmpty:!0,disabled:!!e,value:p,onChange:t=>this.onChange(this.props.schema.leCollectionName||"leCollection","false"!==t.target.value&&("true"===t.target.value||t.target.value)),children:[(0,d.jsx)(h.MenuItem,{value:"false",style:{fontWeight:"bold"},children:c.I18n.t("ra_Do not use let's encrypt")},"_false"),(0,d.jsx)(h.MenuItem,{value:"true",style:{fontWeight:"bold"},children:c.I18n.t("ra_Use all available let's encrypt certificates")},"_true"),null===(a=this.state.collectionsOptions)||void 0===a?void 0:a.map((t=>(0,d.jsx)(h.MenuItem,{value:t,children:t},t)))]})]}):null,this.state.collectionsOptions?(0,d.jsx)("br",{}):null,this.state.collectionsOptions&&"false"!==p?(0,d.jsx)("div",{children:c.I18n.t("ra_Fallback custom certificates")}):null,(0,d.jsxs)(h.FormControl,{style:T.certWidth,variant:"standard",children:[(0,d.jsx)(h.InputLabel,{shrink:!0,children:c.I18n.t("ra_Public certificate")}),(0,d.jsx)(h.Select,{variant:"standard",error:!!t,displayEmpty:!0,disabled:!!e,value:u||"",renderValue:()=>this.getText(null===v||void 0===v?void 0:v.label),onChange:t=>this.onChange(this.props.schema.certPublicName||"certPublic",t.target.value),children:null===(n=this.state.certsPublicOptions)||void 0===n?void 0:n.map(((t,e)=>(0,d.jsx)(h.MenuItem,{value:t.value,style:t.value===g.NONE_VALUE?{opacity:.5}:{},children:this.getText(t.label)},`${t.value}_${e}`)))})]}),(0,d.jsxs)(h.FormControl,{style:T.certWidth,variant:"standard",children:[(0,d.jsx)(h.InputLabel,{shrink:!0,children:c.I18n.t("ra_Private certificate")}),(0,d.jsx)(h.Select,{variant:"standard",error:!!t,displayEmpty:!0,disabled:!!e,value:m||"",renderValue:()=>this.getText(null===f||void 0===f?void 0:f.label),onChange:t=>this.onChange(this.props.schema.certPrivateName||"certPrivate",t.target.value),children:null===(r=this.state.certsPrivateOptions)||void 0===r?void 0:r.map(((t,e)=>(0,d.jsx)(h.MenuItem,{value:t.value,style:t.value===g.NONE_VALUE?{opacity:.5}:{},children:this.getText(t.label)},`${t.value}_${e}`)))})]}),(0,d.jsxs)(h.FormControl,{style:T.certWidth,variant:"standard",children:[(0,d.jsx)(h.InputLabel,{shrink:!0,children:c.I18n.t("ra_Chained certificate")}),(0,d.jsx)(h.Select,{variant:"standard",error:!!t,displayEmpty:!0,disabled:!!e,value:x||"",renderValue:()=>this.getText(null===y||void 0===y?void 0:y.label),onChange:t=>this.onChange(this.props.schema.certChainedName||"certChained",t.target.value),children:null===(l=this.state.certsChainOptions)||void 0===l?void 0:l.map(((t,e)=>(0,d.jsx)(h.MenuItem,{value:t.value,style:t.value===g.NONE_VALUE?{opacity:.5}:{},children:this.getText(t.label)},`${t.value}_${e}`)))})]})]})}};const k=class extends g{async componentDidMount(){var t;let e;super.componentDidMount();const s=await this.props.oContext.socket.getObject("system.certificates");e=null!==s&&void 0!==s&&null!==(t=s.native)&&void 0!==t&&t.collections?Object.keys(s.native.collections):[],this.setState({collectionsOptions:e})}renderItem(t,e){var s;if(!this.state.collectionsOptions)return null;const i=(g.getValue(this.props.data,this.props.schema.leCollectionName||"leCollection")||"false").toString();return(0,d.jsxs)(h.FormControl,{style:{width:"100%"},variant:"standard",children:[this.props.schema.label?(0,d.jsx)(h.InputLabel,{shrink:!0,children:this.getText(this.props.schema.label)}):null,(0,d.jsxs)(h.Select,{variant:"standard",error:!!t,displayEmpty:!0,disabled:!!e,value:i,onChange:t=>this.onChange(this.props.schema.leCollectionName||"leCollection","false"!==t.target.value&&("true"===t.target.value||t.target.value)),children:[(0,d.jsx)(h.MenuItem,{value:"false",style:{fontWeight:"bold"},children:c.I18n.t("ra_Do not use let's encrypt")},"_false"),(0,d.jsx)(h.MenuItem,{value:"true",style:{fontWeight:"bold"},children:c.I18n.t("ra_Use all available let's encrypt certificates")},"_true"),null===(s=this.state.collectionsOptions)||void 0===s?void 0:s.map((t=>(0,d.jsx)(h.MenuItem,{value:t,children:t},t)))]}),this.props.schema.help?(0,d.jsx)(h.FormHelperText,{children:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)}):null]})}},O={fullWidth:{width:"100%"},icon:{width:24,height:24,marginRight:4},licLabel:{fontWeight:"bold",minWidth:100,marginRight:10,textTransform:"capitalize",display:"inline-block"},licValue:{fontWeight:"normal"},errorTitle:t=>({color:"dark"===t.palette.mode?"#e39191":"#b62020"}),okTitle:t=>({color:"dark"===t.palette.mode?"#6fd56f":"#007c00"}),errorText:t=>({color:"dark"===t.palette.mode?"#e39191":"#b62020",mb:"30px"})};class _ extends g{componentDidMount(){super.componentDidMount(),this.setState({_error:"",running:!1,showLicenseData:null,foundSuitableLicense:!1,licenseOfflineCheck:!1,result:null,allLicenses:null,askForUpdate:!1,showLinkToProfile:!1})}renderErrorDialog(){if(this.state._error&&!this.state.showLicenseData){let t=this.state._error;return this.state.allLicenses&&(t=[(0,d.jsx)("div",{children:t},"error")],t.push((0,d.jsx)(h.Button,{variant:"contained",onClick:()=>window.open("https://iobroker.net/www/account/licenses","_blank"),children:c.I18n.t("iobroker.net")},"button")),this.state.allLicenses.length?t.push((0,d.jsx)(h.TableContainer,{children:(0,d.jsxs)(h.Table,{size:"small",children:[(0,d.jsx)(h.TableHead,{children:(0,d.jsxs)(h.TableRow,{children:[(0,d.jsx)(h.TableCell,{children:c.I18n.t("ra_Product")}),(0,d.jsx)(h.TableCell,{children:c.I18n.t("ra_Version")}),(0,d.jsx)(h.TableCell,{children:"UUID"}),(0,d.jsx)(h.TableCell,{children:c.I18n.t("ra_ValidTill")}),(0,d.jsx)(h.TableCell,{children:c.I18n.t("ra_Commercial")}),(0,d.jsx)(h.TableCell,{children:"ID"})]})}),(0,d.jsx)(h.TableBody,{children:this.state.allLicenses.map((t=>(0,d.jsxs)(h.TableRow,{children:[(0,d.jsx)(h.TableCell,{sx:t.validName?null:O.errorText,children:t.license.product}),(0,d.jsx)(h.TableCell,{sx:t.validVersion?null:O.errorText,children:t.license.version}),(0,d.jsx)(h.TableCell,{sx:t.validUuid?null:O.errorText,children:t.license.uuid||"--"}),(0,d.jsx)(h.TableCell,{sx:t.validTill?null:O.errorText,children:t.license.validTill&&"0000-00-00 00:00:00"!==t.license.validTill?new Date(t.license.validTill).toLocaleDateString():"--"}),(0,d.jsx)(h.TableCell,{children:"free"!==t.license.invoice?"MANUALLY_CREATED"===t.license.invoice?"\u2713":t.license.invoice:"-"}),(0,d.jsx)(h.TableCell,{children:t.id})]},t.id)))})]})},"table")):(t.push((0,d.jsx)("div",{children:c.I18n.t("ra_No one license found in license manager")},"text1")),t.push((0,d.jsx)("div",{children:c.I18n.t("ra_Please create license")},"text2")))),(0,d.jsxs)(h.Dialog,{open:!0,maxWidth:"xl",fullWidth:void 0===this.props.fullWidth||this.props.fullWidth,onClick:()=>this.setState({_error:"",allLicenses:null}),children:[(0,d.jsx)(h.DialogTitle,{children:c.I18n.t("ra_Error")}),(0,d.jsx)(h.DialogContent,{children:(0,d.jsx)(h.DialogContentText,{children:t})}),(0,d.jsx)(h.DialogActions,{children:(0,d.jsx)(h.Button,{variant:"contained",onClick:()=>this.setState({_error:"",allLicenses:null}),color:"primary",autoFocus:!0,startIcon:(0,d.jsx)(p.Check,{}),children:c.I18n.t("ra_Ok")})})]})}return null}renderMessageDialog(){if(this.state.showLicenseData){const t=[],e=this.state.showLicenseData;return Object.keys(e).forEach((s=>{if(null!==e[s]&&void 0!==e[s])if("object"===typeof e[s]){const i=e[s];Object.keys(i).forEach((e=>{null!==i[e]&&void 0!==i[e]&&("object"===typeof i[e]?t.push((0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{style:O.licLabel,children:[e,":"]}),JSON.stringify(i[e],null,2)]},e)):t.push((0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{style:O.licLabel,children:[s," -",e,":"]}),i[e].toString()]},e)))}))}else t.push((0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{style:O.licLabel,children:[s.replace(/_/g," "),":"]}),e[s].toString()]},s))})),t.push((0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{style:O.licLabel,children:[c.I18n.t("ra_Checked"),":"]}),this.state.licenseOfflineCheck?c.I18n.t("ra_locally"):c.I18n.t("ra_via internet")]},"checked")),(0,d.jsxs)(h.Dialog,{open:!0,onClose:()=>this.setState({showLicenseData:null}),children:[(0,d.jsx)(h.DialogTitle,{children:(0,d.jsx)(h.Box,{component:"span",sx:this.state.result?O.okTitle:O.errorTitle,children:c.I18n.t("ra_License %s",this.state.result?"OK":"INVALID")})}),(0,d.jsxs)(h.DialogContent,{children:[this.state.showLinkToProfile?(0,d.jsx)(h.Button,{variant:"contained",onClick:()=>window.open("https://iobroker.net/www/account/licenses","_blank"),children:"https://iobroker.net"}):null,this.state._error?(0,d.jsx)(h.Box,{component:"div",sx:O.errorText,children:this.state._error}):null,t]}),(0,d.jsx)(h.DialogActions,{children:(0,d.jsx)(h.Button,{onClick:()=>this.setState({showLicenseData:null,_error:""}),color:"primary",variant:"contained",children:c.I18n.t("ra_Close")})})]})}return null}static parseJwt(t){const e=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),s=decodeURIComponent(atob(e).split("").map((t=>`%${`00${t.charCodeAt(0).toString(16)}`.slice(-2)}`)).join(""));try{return JSON.parse(s)}catch{return null}}static isVersionValid(t,e,s,i){if(!e||!t)return!0;let o=!0;const[a]=t.split(".");return e.startsWith(">=")?o=parseInt(a,10)>=parseInt(e.substring(2,10)):e.startsWith("<=")?o=parseInt(a,10)<=parseInt(e.substring(2,10)):e.startsWith(">")?o=parseInt(a,10)>parseInt(e.substring(1,10)):e.startsWith("<")?o=parseInt(a,10)<parseInt(e.substring(1,10)):e.startsWith("=")?o=parseInt(a,10)===parseInt(e.substring(1,10)):e.startsWith("==")?o=parseInt(a,10)===parseInt(e.substring(2,10)):e.startsWith("===")&&(o=parseInt(a,10)===parseInt(e.substring(3,10))),!0}async findInLicenseManager(t){var e,s;const i=await this.props.oContext.socket.getObject("system.licenses"),o=[];if(null!==i&&void 0!==i&&null!==(e=i.native)&&void 0!==e&&null!==(s=e.licenses)&&void 0!==s&&s.length){let e=null;const s=Date.now();let r,l;if(this.props.schema.uuid){var a;const t=await this.props.oContext.socket.getObject("system.meta.uuid");r=null===t||void 0===t||null===(a=t.native)||void 0===a?void 0:a.uuid}if(this.props.schema.version){var n;const e=await this.props.oContext.socket.getObject(`system.adapter.${t}`);l=null===e||void 0===e||null===(n=e.common)||void 0===n?void 0:n.version}i.native.licenses.forEach((i=>{const a=!i.validTill||"0000-00-00 00:00:00"===i.validTill||new Date(i.validTill).getTime()>s,n=(i.product||"").split("."),h=n[1]===t||"vis-2"===t&&"vis"===n[1],p=!r||!i.uuid||i.uuid===r,c=_.isVersionValid(l,i.version,i.invoice,t);(!e||"free"!==i.invoice)&&a&&h&&p&&c&&(e=i),o.push({id:i.id,validName:h,validUuid:p,validVersion:c,validTill:a,license:i})})),e&&(o.find((t=>t.id===e.id)).used=!0)}return o}async checkLicense(t,e){let s,i;if(this.props.schema.uuid){var o;const t=await this.props.oContext.socket.getObject("system.meta.uuid");s=null===t||void 0===t||null===(o=t.native)||void 0===o?void 0:o.uuid}if(this.props.schema.version){var a;const t=await this.props.oContext.socket.getObject(`system.adapter.${e}`);i=null===t||void 0===t||null===(a=t.common)||void 0===a?void 0:a.version}const n=new AbortController;let r=setTimeout((()=>{r=null,n.abort()}),5e3);try{var l;const o=await window.fetch("https://iobroker.net/api/v1/public/cert/",{method:"POST",body:JSON.stringify({json:t,uuid:s}),headers:{"Content-Type":"text/plain"},signal:n.signal});r&&clearTimeout(r);const a=await o.text();let h;try{h=JSON.parse(a)}catch{}if(null===(l=h)||void 0===l||!l.error){let o=null;try{o=_.parseJwt(t)}catch{}if(h){const t=h.validTill||h.valid_till;if(t&&"0000-00-00 00:00:00"!==t&&new Date(t).getTime()<Date.now())return this.setState({_error:c.I18n.t("ra_License expired on %s",new Date(t).toLocaleString()),licenseOfflineCheck:!1,showLicenseData:o,result:!1,running:!1});const a=(h.name||"").split(".");return a[1]===e||"vis"===a[1]&&"vis-2"===e?s&&!h.uuid&&"vis-2"===e?this.setState({_error:c.I18n.t("ra_License must be converted",h.uuid),showLinkToProfile:!0,licenseOfflineCheck:!1,showLicenseData:o,result:!1,running:!1}):s&&h.uuid&&h.uuid!==s?this.setState({_error:c.I18n.t('ra_Serial number (UUID) "%s" in license is for other device.',h.uuid),licenseOfflineCheck:!1,showLicenseData:o,result:!1,running:!1}):_.isVersionValid(i,h.version,h.invoice,e)?this.setState({licenseOfflineCheck:!1,showLicenseData:o,result:!0,running:!1}):this.setState({_error:c.I18n.t("ra_License is for version %s, but required version is %s",h.version,this.props.schema.version),licenseOfflineCheck:!1,showLicenseData:o,result:!1,running:!1}):this.setState({_error:c.I18n.t('ra_License for other product "%s"',h.name),licenseOfflineCheck:!1,showLicenseData:o,result:!1,running:!1})}throw new Error("ra_Invalid answer from server")}try{const e=_.parseJwt(t),s=c.I18n.t(`ra_${e.error||h.error||"Unknown error"}`).replace(/^ra_/,"");return this.setState({_error:s,licenseOfflineCheck:!1,showLicenseData:e,result:!1,running:!1})}catch{return console.log("Cannot parse license"),this.setState({_error:h.error,result:!1,running:!1})}}catch(p){var h;if(404===(null===p||void 0===p||null===(h=p.response)||void 0===h?void 0:h.status))return this.setState({_error:c.I18n.t("ra_License does not exist"),result:!1,running:!1});try{const o=_.parseJwt(t),a=(o.name||"").split(".");return o.valid_till&&"0000-00-00 00:00:00"!==o.valid_till&&new Date(o.valid_till).getTime()<Date.now()?this.setState({_error:c.I18n.t("ra_License expired on %s",new Date(o.valid_till).toLocaleString()),showLicenseData:o,licenseOfflineCheck:!0,running:!1,result:!1}):a[1]===e?s&&o.uuid&&o.uuid!==s?this.setState({_error:c.I18n.t('ra_Serial number (UUID) "%s" in license is for other device.',o.uuid),showLicenseData:o,licenseOfflineCheck:!0,result:!1,running:!1}):_.isVersionValid(i,o.version,o.invoice,e)?this.setState({running:!1,result:!0,licenseOfflineCheck:!0,showLicenseData:o}):this.setState({_error:c.I18n.t("ra_License is for version %s, but required version is %s",o.version,this.props.schema.version),licenseOfflineCheck:!0,showLicenseData:o,result:!1,running:!1}):this.setState({_error:c.I18n.t('ra_License for other product "%s"',o.name),licenseOfflineCheck:!0,showLicenseData:o,result:!1,running:!1})}catch{return this.setState({_error:c.I18n.t("ra_Cannot decode license"),result:!1,licenseOfflineCheck:!0,running:!1})}}}renderAskForUpdate(){return this.state.askForUpdate?(0,d.jsx)(c.DialogConfirm,{text:c.I18n.t("ra_License not found in license manager. Do you want to read licenses from iobroker.net?"),ok:c.I18n.t("ra_Yes"),onClose:async t=>{if(t){this.setState({askForUpdate:!1});try{await this.props.oContext.socket.updateLicenses(null,null)}catch(e){return void window.alert(c.I18n.t("ra_Cannot read licenses: %s",e))}await this._onClick(!0)}else this.setState({askForUpdate:!1,running:!1})}}):null}async _onClick(t){const e="vis-2"===this.props.oContext.adapterName?"vis":this.props.oContext.adapterName;let s,i;if(this.setState({running:!0}),this.props.data.useLicenseManager){if(i=await this.findInLicenseManager(e),s=i.find((t=>t.used)),s&&(s=s.license.json),!s&&!t)return void this.setState({askForUpdate:!0})}else s=this.props.data.license;s?await this.checkLicense(s,e):this.props.data.useLicenseManager?this.setState({_error:c.I18n.t("ra_Suitable license not found in license manager"),result:!1,running:!1,allLicenses:i}):this.setState({_error:c.I18n.t("ra_Please enter the license"),result:!1,running:!1})}renderItem(){return(0,d.jsxs)("div",{style:O.fullWidth,children:[(0,d.jsxs)(h.Button,{variant:this.props.schema.variant||"outlined",color:this.props.schema.color||"primary",style:O.fullWidth,disabled:!this.props.data.license&&!this.props.data.useLicenseManager||this.state.running,startIcon:(0,d.jsx)(p.Send,{}),onClick:()=>this._onClick(),children:[this.state.running?(0,d.jsx)(h.CircularProgress,{size:20,style:{marginRight:8}}):null,this.getText(this.props.schema.label||"ra_Check license",this.props.schema.noTranslation)]}),this.renderMessageDialog(),this.renderErrorDialog(),this.renderAskForUpdate()]})}}const F=_;const N=class extends g{renderItem(t,e){const s=g.getValue(this.props.data,this.props.attr),i=Array.isArray(s);return(0,d.jsxs)(h.FormControl,{style:{width:"100%"},variant:"standard",children:[(0,d.jsx)(h.FormControlLabel,{onClick:t=>{if(t.preventDefault(),t.stopPropagation(),!e){const t=this.onChange(this.props.attr,!s);t instanceof Promise&&t.catch((t=>console.error(`Cannot set value: ${t}`)))}},control:(0,d.jsx)(h.Checkbox,{indeterminate:i,checked:!!s,onChange:t=>{let e;e=i?this.onChange(this.props.attr,!0):this.onChange(this.props.attr,t.target.checked),e instanceof Promise&&e.catch((t=>console.error(`Cannot set value: ${t}`)))},disabled:e||this.props.schema.readOnly}),label:this.getText(this.props.schema.label)}),(0,d.jsx)(h.FormHelperText,{style:{color:"red"},children:t?this.props.schema.validatorErrorText?c.I18n.t(this.props.schema.validatorErrorText):c.I18n.t("ra_Error"):null}),this.props.schema.help?(0,d.jsx)(h.FormHelperText,{children:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)}):null]})}};var E=s(32619),$=s.n(E),L=s(99072),A=s(23106);const V={standard:h.Input,filled:L.A,outlined:h.OutlinedInput},P=t=>{const e="light"===t.palette.mode,s=e?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)";return{root:{},inputRoot:{display:"inline-flex",flexWrap:"wrap",flex:1,marginTop:0,minWidth:70,"&.mui-variant-outlined,&.mui-variant-filled":{boxSizing:"border-box"},"&.mui-variant-outlined":{paddingTop:"14px"},"&.mui-variant-filled":{paddingTop:"28px"}},input:{display:"inline-block",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",appearance:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",float:"left",flex:1},chipContainer:{display:"flex",flexFlow:"row wrap",alignItems:"center",cursor:"text",marginBottom:"-2px",minHeight:40},outlined:{"& input":{height:16,paddingTop:"4px",paddingBottom:"12px",marginTop:"4px",marginBottom:"4px"}},standard:{marginTop:"18px"},filled:{"& input":{height:22,marginBottom:"4px",marginTop:"4px",paddingTop:0},"$marginDense & input":{height:26}},labeled:{},label:{top:4,"&$outlined&:not($labelShrink)":{top:2,"$marginDense &":{top:5}},"&$filled&:not($labelShrink)":{top:15,"$marginDense &":{top:20}}},labelShrink:{top:0},helperText:{marginBottom:-20},focused:{},disabled:{},underline:{"&:after":{borderBottom:`2px solid ${t.palette.primary[e?"dark":"light"]}`,left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),pointerEvents:"none"},"&$focused:after":{transform:"scaleX(1)"},"&$error:after":{borderBottomColor:t.palette.error.main,transform:"scaleX(1)"},"&:before":{borderBottom:`1px solid ${s}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:t.transitions.create("border-bottom-color",{duration:t.transitions.duration.shorter}),pointerEvents:"none"},"&:hover:not($disabled):not($focused):not($error):before":{borderBottom:`2px solid ${t.palette.text.primary}`,"@media (hover: none)":{borderBottom:`1px solid ${s}`}},"&$disabled:before":{borderBottomStyle:"dotted"}},error:{"&:after":{backgroundColor:t.palette.error.main,transform:"scaleX(1)"}},chip:{margin:"0 8px 8px 0",float:"left"},marginDense:{}}},W=8,U=46,B=37,R=39,M=(t,e)=>{let{value:s,isFocused:i,isDisabled:o,isReadOnly:a,handleClick:n,handleDelete:r,style:l}=t;return(0,d.jsx)(h.Chip,{style:{...l,pointerEvents:o||a?"none":void 0,backgroundColor:i?A.A[300]:void 0},onClick:n,onDelete:r,label:s},e)};class J extends o().Component{constructor(t){super(t),this.labelRef=void 0,this.labelNode=null,this.input=void 0,this.newChipKeyCodes=void 0,this.newChipKeys=void 0,this.actualInput=null,this.inputBlurTimeout=null,this._keyPressed=void 0,this._preventChipCreation=void 0,this.styles={},this.styleTheme=null,this.focus=()=>{var t;null===(t=this.actualInput)||void 0===t||t.focus(),this.state.focusedChip&&this.setState({focusedChip:null})},this.handleInputBlur=t=>{this.props.onBlur&&this.props.onBlur(t),this.setState({isFocused:!1}),this.state.focusedChip&&this.setState({focusedChip:null});const e=t.target.value;let s;switch(this.props.blurBehavior||"clear"){case"add-or-clear":s={clearInputOnFail:!0};case"add":if(this.props.delayBeforeAdd){const t=(this.props.value||this.state.chips).length;this.inputBlurTimeout=setTimeout((()=>{const i=(this.props.value||this.state.chips).length;t===i?this.handleAddChip(e,s):this.clearInput()}),150)}else this.handleAddChip(e,s);break;case"clear":this.clearInput()}},this.handleInputFocus=t=>{this.setState({isFocused:!0}),this.props.onFocus&&this.props.onFocus(t)},this.handleKeyDown=t=>{const{focusedChip:e}=this.state;if(this._keyPressed=!1,this._preventChipCreation=!1,this.props.onKeyDown&&(this.props.onKeyDown(t),t.isDefaultPrevented()))return;const s=this.props.value||this.state.chips;if(this.newChipKeyCodes.includes(t.keyCode)||this.newChipKeys.includes(t.key)){!1!==this.handleAddChip(t.target.value)&&t.preventDefault()}else switch(t.keyCode){case W:""===t.target.value&&(e?(this.handleDeleteChip(s[e],e),e&&this.setState({focusedChip:e-1})):this.setState({focusedChip:s.length-1}));break;case U:""===t.target.value&&e&&(this.handleDeleteChip(s[e],e),e<=s.length-1&&this.setState({focusedChip:e}));break;case B:null===e&&""===t.target.value&&s.length?this.setState({focusedChip:s.length-1}):null!==e&&e>0&&this.setState({focusedChip:e-1});break;case R:null!==e&&e<s.length-1?this.setState({focusedChip:e+1}):this.setState({focusedChip:null});break;default:this.setState({focusedChip:null})}},this.handleKeyUp=t=>{!this._preventChipCreation&&(this.newChipKeyCodes.includes(t.keyCode)||this.newChipKeys.includes(t.key))&&this._keyPressed?this.clearInput():this.updateInput(t.target.value),this.props.onKeyUp&&this.props.onKeyUp(t)},this.handleUpdateInput=t=>{null!==this.props.inputValue&&void 0!==this.props.inputValue||this.updateInput(t.target.value),this.props.onUpdateInput&&this.props.onUpdateInput(t)},this.setActualInputRef=t=>{this.actualInput=t,this.props.inputRef&&this.props.inputRef(t)},this.state={chips:t.defaultValue||[],focusedChip:null,inputValue:"",isFocused:!1,chipsUpdated:!1,prevPropsValue:[],variant:this.props.variant||"standard"},this.newChipKeyCodes=t.newChipKeyCodes||[13],this.newChipKeys=t.newChipKeys||["Enter"],this.labelRef=o().createRef(),this.input=o().createRef()}componentDidMount(){"outlined"===this.state.variant&&(this.labelNode=$().findDOMNode(this.labelRef.current),this.forceUpdate())}componentWillUnmount(){this.inputBlurTimeout&&clearTimeout(this.inputBlurTimeout)}static getDerivedStateFromProps(t,e){let s=null;return t.value&&t.value.length!==e.prevPropsValue.length&&(s={prevPropsValue:t.value},t.clearInputValueOnChange&&(s.inputValue="")),t.clearInputValueOnChange&&t.value&&t.value.length!==e.prevPropsValue.length&&(s={prevPropsValue:t.value,inputValue:""}),t.disabled&&(s={...s,focusedChip:null}),!e.chipsUpdated&&t.defaultValue&&(s={...s,chips:t.defaultValue}),s}handleAddChip(t,e){if(this.props.onBeforeAdd&&!this.props.onBeforeAdd(t))return this._preventChipCreation=!0,e&&e.clearInputOnFail&&this.clearInput(),!1;this.clearInput();const s=this.props.value||this.state.chips;return!!t.trim().length&&(!this.props.allowDuplicates&&s.includes(t)||(this.props.value&&this.props.onAdd?this.props.onAdd(t):this.updateChips([...this.state.chips,t])),!0)}handleDeleteChip(t,e){if(this.props.value)this.props.onDelete&&this.props.onDelete(t,e);else{const t=this.state.chips.slice();if(t.splice(e,1)){let s=this.state.focusedChip;this.state.focusedChip===e?s=null:this.state.focusedChip>e&&(s=this.state.focusedChip-1),this.updateChips(t,{focusedChip:s})}}}updateChips(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.setState({chips:t,chipsUpdated:!0,...e}),this.props.onChange&&this.props.onChange(t)}clearInput(){this.updateInput("")}updateInput(t){this.setState({inputValue:t})}render(){const{alwaysShowPlaceholder:t,chipRenderer:e=M,className:s,disabled:i,disableUnderline:o,error:a,FormHelperTextProps:n,fullWidth:r,fullWidthInput:l,helperText:p,id:u,InputProps:m={},InputLabelProps:g={},inputValue:x,label:v,placeholder:f,readOnly:y,required:b,rootRef:C,value:j,margin:w}=this.props,I=this.state.variant;this.styleTheme!==this.props.theme.palette.mode&&(this.styleTheme=this.props.theme.palette.mode,this.styles=c.Utils.getStyle(this.props.theme,P));let S=j||this.state.chips||[];Array.isArray(S)||(S=(S||"").toString().split(/[,\s]+/).map((t=>t.trim())));const T=null!==x&&void 0!==x?x:this.state.inputValue,D=(this.props.value||T).length||T.length,k="boolean"===typeof g.shrink?g.shrink:null!==v&&(D||this.state.isFocused||S.length),O=S.map(((t,s)=>e({value:t,isDisabled:!!i,isReadOnly:y,isFocused:this.state.focusedChip===s,handleClick:()=>this.setState({focusedChip:s}),handleDelete:()=>this.handleDeleteChip(t,s),style:this.styles.chip},s.toString()))),_={};"outlined"===I&&(_.notched=!!k,_.labelWidth=k&&this.labelNode&&this.labelNode.offsetWidth||0),"standard"!==I?_.startAdornment=O:m.disableUnderline=!0;const F=V[I];return(0,d.jsxs)(h.FormControl,{ref:C,fullWidth:r,className:s,sx:{...this.styles.root,..."dense"===w?this.styles.marginDense:{}},error:a,required:S.length>0?void 0:b,onClick:this.focus,disabled:i,variant:I,component:"div",margin:w,children:[v&&(0,d.jsx)(h.InputLabel,{htmlFor:u,sx:{"&.MuiInputLabel-root":this.styles.label,"&.MuiInputLabel-shrink":this.styles.labelShrink},shrink:!!k,focused:this.state.isFocused,variant:I,ref:this.labelRef,required:b,component:"label",...g,children:v}),(0,d.jsxs)(h.Box,{component:"div",id:"input-chip-container",sx:{...this.styles[I],...this.styles.chipContainer,...this.state.isFocused?this.styles.focused:void 0,...o||"standard"!==I?void 0:this.styles.underline,...i?this.styles.disabled:void 0,...v?this.styles.labeled:void 0,...a?this.styles.error:void 0},children:["standard"===I&&O,(0,d.jsx)(F,{ref:this.input,className:`mui-variant-${this.styles[I]} ${v?"mui-chip-with-label":"mui-chip-no-label"}`,sx:{"&.MuiInputBase-input":{...this.styles.input,...this.styles[I]},"&.MuiInputBase-root":{...this.styles.inputRoot}},id:u,value:T,onChange:this.handleUpdateInput,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onFocus:this.handleInputFocus,onBlur:this.handleInputBlur,inputRef:this.setActualInputRef,disabled:i,fullWidth:l,placeholder:!D&&(k||null===v||void 0===v)||t?f:null,readOnly:y,...m,..._})]}),p&&(0,d.jsx)(h.FormHelperText,{...n,className:null===n||void 0===n?void 0:n.className,style:this.styles.helperText,children:p})]})}}const z=J;const H=class extends g{componentDidMount(){super.componentDidMount();const{data:t,attr:e}=this.props,s=g.getValue(t,e);if(this.props.schema.delimiter&&"string"===typeof s){const t=s.split(this.props.schema.delimiter).map((t=>t.trim())).filter((t=>t));this.setState({value:t})}else this.setState({value:s||[]})}renderItem(t,e){const{attr:s,schema:i}=this.props,{value:o}=this.state;return(0,d.jsxs)(h.FormControl,{fullWidth:!0,variant:"standard",children:[(0,d.jsx)(z,{value:o,disabled:!!e,label:this.getText(i.label),error:!!t,onAdd:t=>{const e=JSON.parse(JSON.stringify(o));e.push(t),this.setState({value:e},(()=>{let t;t=this.props.schema.delimiter?this.onChange(s,e.join(`${this.props.schema.delimiter} `)):this.onChange(s,e),t instanceof Promise&&t.catch((t=>console.error(t)))}))},theme:this.props.oContext.theme,onDelete:(t,e)=>{const i=JSON.parse(JSON.stringify(o));i.splice(e,1),this.setState({value:i},(()=>{let t;t=this.props.schema.delimiter?this.onChange(s,i.join(`${this.props.schema.delimiter} `)):this.onChange(s,i),t instanceof Promise&&t.catch((t=>console.error(t)))}))}}),this.props.schema.help?(0,d.jsx)(h.FormHelperText,{children:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)}):null]})}};var q=s(4554);const K=class extends g{renderColorDialog(){return!!this.state.showColorDialog&&(0,d.jsx)(h.Dialog,{onClose:()=>this.setState({showColorDialog:!1}),open:this.state.showColorDialog,children:(0,d.jsx)(q.xk,{color:this.state.colorDialogValue,onChange:t=>this.setState({colorDialogValue:t.hex},(()=>this.onChange(this.props.attr,this.state.colorDialogValue)))})})}renderItem(t,e){const s=g.getValue(this.props.data,this.props.attr);let i=c.Utils.isUseBright(s,null);return null===i&&(i=void 0),(0,d.jsxs)(d.Fragment,{children:[this.renderColorDialog(),(0,d.jsx)(h.TextField,{variant:"standard",disabled:!!e,style:{minWidth:100,width:"calc(100% - 8px)"},label:this.getText(this.props.schema.label),value:s||"",onClick:()=>!this.props.schema.readOnly&&this.setState({showColorDialog:!0,colorDialogValue:s||""}),onChange:t=>{const e=t.target.value,s=this.onChange(this.props.attr,e);s instanceof Promise&&s.catch((t=>console.error(`Cannot set value: ${t}`)))},slotProps:{htmlInput:{style:{backgroundColor:s,color:i?"#FFF":"#000"},readOnly:this.props.schema.readOnly||!1},input:{endAdornment:this.props.schema.readOnly||!s||this.props.schema.noClearButton?void 0:(0,d.jsx)(h.IconButton,{size:"small",onClick:t=>{t.stopPropagation();const e=this.onChange(this.props.attr,"");e instanceof Promise&&e.catch((t=>console.error(`Cannot set value: ${t}`)))},children:(0,d.jsx)(p.Close,{})})},inputLabel:{shrink:!0}}})]})}},G={width:{width:"calc(100% - 85px)"},width50:{width:120,marginRight:5}};const Y=class extends g{componentDidMount(){super.componentDidMount();const t=g.getValue(this.props.data,this.props.attr);this.setState({value:t});const e={};if(this.props.schema.useSystemName&&(e.useSystem=!!g.getValue(this.props.data,this.props.schema.useSystemName)),this.props.schema.longitudeName&&this.props.schema.latitudeName)e.longitude=g.getValue(this.props.data,this.props.schema.longitudeName),e.latitude=g.getValue(this.props.data,this.props.schema.latitudeName),e.longitude||e.latitude||!this.props.schema.autoInit||setTimeout((()=>this.getCoordinates()),300);else{!g.getValue(this.props.data,this.props.attr)&&this.props.schema.autoInit&&setTimeout((()=>this.getCoordinates()),300)}Object.keys(e).length&&setTimeout((()=>this.setState(e)),50)}async getSystemCoordinates(){const t=await this.props.oContext.socket.getCompactSystemConfig();if(null!==t&&void 0!==t&&t.common&&(t.common.longitude||t.common.latitude))if(window.alert(c.I18n.t("ra_Used system settings")),this.props.schema.longitudeName&&this.props.schema.latitudeName)this.setState({longitude:t.common.longitude,latitude:t.common.latitude},(async()=>{await this.onChange(this.props.schema.longitudeName,t.common.longitude),await this.onChange(this.props.schema.latitudeName,t.common.latitude)}));else{const e=t.common.latitude+(this.props.schema.divider||",")+t.common.longitude;this.setState({value:e},(()=>{const t=this.onChange(this.props.attr,e);t instanceof Promise&&t.catch((t=>console.error(`Cannot set value: ${t}`)))}))}else window.alert(c.I18n.t("ra_Cannot determine position: System settings are empty and GPS detection is disabled in browser"))}getCoordinates(){navigator.geolocation?navigator.geolocation.getCurrentPosition((async t=>{if(null!==t&&void 0!==t&&t.coords)if(this.props.schema.longitudeName&&this.props.schema.latitudeName)this.setState({longitude:t.coords.longitude,latitude:t.coords.latitude},(async()=>{await this.onChange(this.props.schema.longitudeName,t.coords.longitude||""),await this.onChange(this.props.schema.latitudeName,t.coords.latitude||"")}));else{const e=t.coords.latitude+(this.props.schema.divider||",")+t.coords.longitude;this.setState({value:e},(()=>{const t=this.onChange(this.props.attr,e);t instanceof Promise&&t.catch((t=>console.error(`Cannot set value: ${t}`)))}))}else await this.getSystemCoordinates()}),(async t=>{console.error(`Cannot determine coordinates from browser: ${t.message}`),await this.getSystemCoordinates()})):this.getSystemCoordinates().catch((t=>{console.error(`Cannot determine coordinates: ${t}`)}))}renderItem(t,e){var s,i;return(0,d.jsxs)(d.Fragment,{children:[this.props.schema.useSystemName?(0,d.jsx)(h.FormControlLabel,{control:(0,d.jsx)(h.Checkbox,{checked:!!this.state.useSystem,onChange:t=>{const e=t.target.checked;e&&this.getSystemCoordinates().catch((t=>console.error(`Cannot determine coordinates: ${t}`))),this.setState({useSystem:e},(()=>this.onChange(this.props.schema.useSystemName,e)))}}),label:c.I18n.t("ra_Use system settings for position")}):null,this.props.schema.longitudeName&&this.props.schema.latitudeName?(0,d.jsx)(h.TextField,{variant:"standard",style:G.width50,value:null!==(s=this.state.longitude)&&void 0!==s?s:"",error:!!t,disabled:this.state.useSystem||!!e,onChange:t=>{const e=t.target.value;this.setState({longitude:e},(()=>{const t=this.onChange(this.props.schema.longitudeName,(e||"").trim());t instanceof Promise&&t.catch((t=>console.error(`Cannot set value: ${t}`)))}))},label:c.I18n.t("ra_Longitude")}):null,this.props.schema.longitudeName&&this.props.schema.latitudeName?(0,d.jsx)(h.TextField,{variant:"standard",style:G.width50,value:null!==(i=this.state.latitude)&&void 0!==i?i:"",error:!!t,disabled:this.state.useSystem||!!e,onChange:t=>{const e=t.target.value;this.setState({latitude:e},(()=>this.onChange(this.props.schema.latitudeName,(e||"").trim())))},label:c.I18n.t("ra_Latitude")}):null,this.props.schema.longitudeName&&this.props.schema.latitudeName?null:(0,d.jsx)(h.TextField,{variant:"standard",style:G.width,value:null===this.state.value||void 0===this.state.value?"":this.state.value,error:!!t,disabled:!!e,slotProps:{htmlInput:{maxLength:this.props.schema.maxLength||this.props.schema.max||void 0,readOnly:this.state.useSystem}},onChange:t=>{const e=t.target.value;this.setState({value:e},(()=>this.onChange(this.props.attr,(e||"").trim())))},placeholder:this.getText(this.props.schema.placeholder),label:this.getText(this.props.schema.label),helperText:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)}),this.state.useSystem?null:(0,d.jsx)(h.Fab,{size:"small",onClick:()=>this.getCoordinates(),title:c.I18n.t("ra_Take browser position"),style:{marginRight:4},children:(0,d.jsx)(p.LocationOn,{})}),this.state.useSystem?null:(0,d.jsx)(h.Fab,{size:"small",onClick:()=>this.getSystemCoordinates(),title:c.I18n.t("ra_Take position from system settings"),children:(0,d.jsx)(p.GpsFixed,{})})]})}};function Z(t,e,i,o){return async()=>{const a=await((t,e,i)=>new Promise(((o,a)=>{if(window[t])o(window[t]);else{const n=document.querySelector(`script[data-webpack="${t}"]`),r=async()=>{if(!window[t])return console.error(`Cannot load ${t}`),void a(new Error(`Cannot load ${t}`));window[t].__initialized||(await window[t].init(s.S[e]),window[t].__initialized=!0),o(window[t])};if(n)n.onload=r,n.onerror=a;else if(i){const e=document,s=e.createElement("script");s.type="text/javascript",s.setAttribute("data-webpack",`${t}`),s.async=!0,s.onerror=a,s.onload=r,s.src=i,e.getElementsByTagName("head")[0].appendChild(s)}else a(new Error(`Cannot Find Remote ${t} to inject`))}})))(t,e,o);return(await a.get(i))()}}class Q extends g{constructor(t){super(t),Object.assign(this.state,{Component:null,error:""})}async componentDidMount(){if(!this.props.schema.url)return console.error("URL is empty. Cannot load custom component!"),void this.setState({error:"URL is empty. Cannot load custom component!"});let t;t=this.props.schema.url.startsWith("./")?`${window.location.protocol}//${window.location.host}${this.props.schema.url.replace(/^\./,"")}`:`${window.location.protocol}//${window.location.host}/adapter/${this.props.oContext.adapterName}/${this.props.schema.url}`;const[e,s,...i]=this.props.schema.name.split("/"),o=i.join("/");if(!t)return void console.error('Cannot find URL for custom component! Please define "url" as "custom/customComponents.js" in the schema');if(!e||!s||!o)return void console.error('Invalid format of "name"! Please define "name" as "ConfigCustomBackItUpSet/Components/AdapterExist" in the schema');let a=Q.runningLoads[`${t}!${s}`];if(!(a instanceof Promise)){let i;if(!0===this.props.schema.i18n){const e=t.lastIndexOf("/");let s;s=-1!==e?t.substring(0,e):t;const o=c.I18n.getLanguage(),a=`${s}/i18n/${o}.json`;i=fetch(a).then((t=>t.json())).then((t=>c.I18n.extendTranslations(t,o))).catch((t=>{"en"===o?console.log(`Cannot load i18n "${a}": ${t}`):fetch(`${s}/i18n/en.json`).then((t=>t.json())).then((t=>c.I18n.extendTranslations(t,o))).catch((t=>console.log(`Cannot load i18n "${a}": ${t}`)))}))}else if(this.props.schema.i18n&&"object"===typeof this.props.schema.i18n)try{c.I18n.extendTranslations(this.props.schema.i18n)}catch(n){console.error(`Cannot import i18n: ${n}`)}try{console.log(e,s,o),a=Z(e,"default",`./${s}`,t)(),i instanceof Promise&&(a=Promise.all([a,i]).then((t=>t[0]))),Q.runningLoads[`${t}!${s}`]=a}catch(n){this.setState({error:`Cannot import from ${this.props.schema.url}: ${n}`})}}try{const t=(await a).default;if(null!==t&&void 0!==t&&t[o])this.setState({Component:t[o]});else{const e=Object.keys(t||{});console.error("URL is empty. Cannot load custom component!"),this.setState({error:`Component ${this.props.schema.name} not found in ${this.props.schema.url}. Found: ${e.join(", ")}`})}}catch(n){this.setState({error:`Cannot import from ${this.props.schema.url}: ${n}`})}}render(){const t=this.state.Component;if(!t){const t=this.props.schema||{},e=(0,d.jsx)(h.Grid2,{size:{xs:t.xs||void 0,sm:t.sm||void 0,md:t.md||void 0,lg:t.lg||void 0,xl:t.xl||void 0},style:{marginBottom:0,textAlign:"left",...t.style,..."dark"===this.props.oContext.themeType?t.darkStyle:{}},children:this.state.error?(0,d.jsx)("div",{children:this.state.error}):(0,d.jsx)(h.LinearProgress,{})});return t.newLine?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{style:{flexBasis:"100%",height:0}}),e]}):e}return(0,d.jsx)(t,{...this.props})}}Q.runningLoads={};var X=s(46567);const tt=class extends g{renderItem(){if(!this.props.schema)return null;if(this.props.oContext.DeviceManager){const t=this.props.oContext.DeviceManager;return(0,d.jsx)(t,{uploadImagesToInstance:`${this.props.oContext.adapterName}.${this.props.oContext.instance}`,title:this.getText(this.props.schema.label),socket:this.props.oContext.socket,selectedInstance:`${this.props.oContext.adapterName}.${this.props.oContext.instance}`,themeName:this.props.themeName,themeType:this.props.oContext.themeType,isFloatComma:this.props.oContext.isFloatComma,dateFormat:this.props.oContext.dateFormat})}return(0,d.jsx)("div",{children:"DeviceManager not found"})}};var et=s(51189),st=s.n(et);const it={fullWidth:{width:"100%"},fullWidthOneButton:{width:"calc(100% - 42px)"},fullWidthTwoButtons:{width:"calc(100% - 84px)"},fullWidthThreeButtons:{width:"calc(100% - 126x)"},dropZone:{width:"100%",height:"100%",position:"absolute"},dropZoneEmpty:{},image:{objectFit:"contain",margin:"auto",display:"flex",width:"100%",height:"100%"},uploadDiv:{position:"relative",width:"100%"},uploadDivDragging:{opacity:1,background:"rgba(128,255,128,0.1)"},uploadCenterDiv:{margin:5,border:"3px dashed grey",borderRadius:5,width:"100%",height:"100%",position:"absolute",display:"flex"},uploadCenterIcon:{paddingTop:10,width:48,height:48},uploadCenterText:{fontSize:16},uploadCenterTextAndIcon:{textAlign:"center",position:"absolute",top:0,bottom:0,left:0,right:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},disabledOpacity:{opacity:.3,cursor:"default"},error:{border:"2px solid red"},deleteButton:{},selectedImage:{height:40,width:40,display:"inline-block",marginRight:8}},ot=["jpg","jpeg","svg","png","webp","gif","apng","avif","webp"],at=["mp3","ogg","wav","aac"],nt=["avi","mp4","mov"],rt=["txt","log","html","htm"],lt=["json","js","ts"];class ht extends g{constructor(t){super(t),this.dropzoneRef=void 0,this.imagePrefix=void 0,this.objectID=void 0,this.path=void 0,this.dropzoneRef=o().createRef(),this.imagePrefix=void 0===this.props.oContext.imagePrefix?"./files":this.props.oContext.imagePrefix}componentDidMount(){super.componentDidMount(),this.objectID=(this.props.schema.objectID||"0_userdata.0").replace("%INSTANCE%",(this.props.oContext.instance||0).toString()),this.path=this.props.schema.upload,this.path&&("/"===this.path?this.path="":this.path.endsWith("/")||(this.path=`${this.path}/`)),this.updateFiles().then((()=>{const t=g.getValue(this.props.data,this.props.attr);this.setState({value:t})}))}updateFiles(){return this.readFiles(this.props.schema.pattern).then((t=>this.setState({files:t})))}async readFolder(t,e,s){try{const i=await this.props.oContext.socket.readDir(this.objectID,t.replace(/^\//,"")||null);for(let o=0;o<i.length;o++){const a=i[o];if(a.isDir)await this.readFolder(`${t+a.file}/`,e,s);else{let i=!1;if("*.*"===s&&a.file.includes("."))i=!0;else if(s&&"*"!==s)if(".*"===s&&a.file.startsWith("."))i=!0;else{i=new RegExp(`^${s.replace(/\./g,"\\.").replace(/\*/g,".*")}$`).test(a.file)}else i=!0;i&&e.push({name:t+a.file,size:a.stats?c.Utils.formatBytes(a.stats.size):"--"})}}}catch(i){console.error(`Cannot read "${t}": ${i}`)}return e}async readFiles(t){const e=[];let s;(t=t||this.props.schema.pattern)||(t="**/*.*");const i=t.lastIndexOf("/");if(s=-1===i?t:t.substring(i+1),t.startsWith("**"))await this.readFolder("/",e,s);else{const i=t.lastIndexOf("/");if(-1===i)await this.readFolder("/",e,s);else{const o=t.substring(0,i+1);await this.readFolder(o,e,s)}}return e}onDrop(t){const e=t[0],s=new FileReader,i=this.props.schema.maxSize||2097152;s.onabort=()=>console.log("file reading was aborted"),s.onerror=()=>console.log("file reading has failed"),s.onload=()=>{let t=`image/${e.name.split(".").pop().toLowerCase()}`;if("image/jpg"===t?t="image/jpeg":t.includes("svg")&&(t="image/svg+xml"),e.size>i)return void window.alert(c.I18n.t("File is too big. Max %sk allowed. Try use SVG.",Math.round(i/1024)));const o=`data:${t};base64,${btoa(new Uint8Array(s.result).reduce(((t,e)=>t+String.fromCharCode(e)),""))}`;this.props.oContext.socket.writeFile64(this.objectID,this.path+e.name,o).then((()=>this.updateFiles())).catch((t=>window.alert(`Cannot upload file: ${t}`)))},s.readAsArrayBuffer(e)}renderDeleteDialog(){return this.state.deleteFile?(0,d.jsx)(c.DialogConfirm,{title:c.I18n.t("ra_Are you sure?"),text:c.I18n.t("ra_File will be deleted"),ok:c.I18n.t("ra_Delete"),cancel:c.I18n.t("ra_Cancel"),onClose:t=>{const e=this.state.deleteFile;this.setState({deleteFile:""},(()=>{t&&this.props.oContext.socket.deleteFile(this.objectID,e).then((()=>this.updateFiles())).catch((t=>window.alert(`Cannot delete file: ${t}`)))}))}}):null}static base64ToArrayBuffer(t){const e=window.atob(t),s=e.length,i=new Uint8Array(s);for(let o=0;o<s;o++)i[o]=e.charCodeAt(o);return i.buffer}loadFile(){return this.props.oContext.socket.readFile(this.objectID,this.state.value,!0)}play(){this.loadFile().then((t=>{if("undefined"!==typeof AudioContext){const e=new AudioContext,s=ht.base64ToArrayBuffer(t.file);e.decodeAudioData(s,(t=>{const s=e.createBufferSource();s.buffer=t,s.connect(e.destination),s.start(0)}),(t=>window.alert(`Cannot play: ${t.message}`)))}}))}getFileIcon(t){return null!==t&&void 0!==t&&t.extension?ot.includes(t.extension)?(0,d.jsx)("div",{style:{...it.selectedImage,backgroundImage:`url(${this.imagePrefix}/${this.objectID}/${t.value})`,backgroundSize:"contain",backgroundRepeat:"no-repeat"}}):at.includes(t.extension)?(0,d.jsx)(p.MusicNote,{}):rt.includes(t.extension)?(0,d.jsx)(p.Article,{}):nt.includes(t.extension)?(0,d.jsx)(p.Videocam,{}):lt.includes(t.extension)?(0,d.jsx)(p.Code,{}):null:null}renderItem(t,e){if(!this.state.files)return null;const s=[];this.props.schema.withFolder||this.state.files.forEach((t=>{const e=t.name.lastIndexOf("/");if(-1===e)s.includes("/")||s.push("/");else{const i=t.name.substring(0,e+1);s.includes(i)||s.push(i)}}));const i=this.state.files.map((t=>({value:t.name,label:this.props.schema.withFolder||1!==s.length?`${t.name}${this.props.schema.noSize?"":`(${t.size})`}`:`${t.name.substring(s[0].length)}`,extension:t.name.toLowerCase().split(".").pop()})));this.props.schema.noNone||i.unshift({label:c.I18n.t("ra_none"),value:""});const o=i.find((t=>t.value===this.state.value));let a=0;this.props.schema.upload&&a++,this.props.schema.refresh&&a++;const n=this.state.value&&(this.state.value.endsWith(".mp3")||this.state.value.endsWith(".ogg")||this.state.value.endsWith(".wav"));n&&a++;const r=(0,d.jsxs)("div",{style:it.fullWidth,children:[(0,d.jsxs)(h.FormControl,{variant:"standard",style:{width:`calc(100% - ${42*a}px)`},children:[this.props.schema.label?(0,d.jsx)(h.InputLabel,{children:this.getText(this.props.schema.label)}):null,(0,d.jsx)(h.Select,{variant:"standard",error:!!t,disabled:!!e,value:this.state.value||"_",renderValue:()=>(0,d.jsxs)(d.Fragment,{children:[this.getFileIcon(o),(0,d.jsx)("span",{children:(null===o||void 0===o?void 0:o.label)||""})]}),onChange:t=>{this.setState({value:"_"===t.target.value?"":t.target.value},(()=>this.onChange(this.props.attr,this.state.value)))},children:i.map((t=>(0,d.jsxs)(h.MenuItem,{value:t.value,children:[(0,d.jsx)(h.ListItemIcon,{children:this.getFileIcon(t)}),(0,d.jsx)(h.ListItemText,{children:t.label}),this.props.schema.delete&&o.value?(0,d.jsx)(h.IconButton,{style:it.deleteButton,size:"small",onClick:()=>this.setState({deleteFile:o.value}),children:(0,d.jsx)(p.Delete,{})}):null]},t.value)))}),this.props.schema.help?(0,d.jsx)(h.FormHelperText,{children:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)}):null]}),this.props.schema.refresh&&(0,d.jsx)(h.IconButton,{onClick:()=>this.updateFiles(),children:(0,d.jsx)(p.Refresh,{})}),this.props.schema.upload&&(0,d.jsx)(h.IconButton,{onClick:()=>{var t;return null===(t=this.dropzoneRef.current)||void 0===t?void 0:t.open()},children:(0,d.jsx)(p.UploadFile,{})}),n&&(0,d.jsx)(h.IconButton,{style:{color:"#00FF00"},onClick:()=>this.play(),children:(0,d.jsx)(p.PlayArrow,{})})]});if(!this.props.schema.upload)return(0,d.jsxs)(d.Fragment,{children:[r,this.renderDeleteDialog()]});let l={"*/*":[]};if("image"===this.props.schema.fileTypes?l={"image/*":[".png",".jpg",".svg",".gif",".apng",".avif",".webp"]}:"audio"===this.props.schema.fileTypes?l={"audio/*":[".mp3",".ogg",".wav",".mp4"]}:"text"===this.props.schema.fileTypes&&(l={"text/plain":[".txt"]}),this.props.schema.pattern){const t=this.props.schema.pattern.split("/").pop().toLowerCase().replace(/.*\./,"");l="png"===t||"jpg"===t||"svg"===t||"gif"===t||"apng"===t||"avif"===t||"webp"===t?{"image/*":[".png",".jpg",".svg",".gif",".apng",".avif",".webp"]}:"mp3"===t||"ogg"===t||"wav"===t?{"audio/*":[".mp3",".ogg",".wav",".mp4"]}:"ics"===t?{"text/calendar":[".ics"]}:"txt"===t?{"text/plain":[".txt"]}:"pem"===t?{"text/plain":[".pem"]}:{"*/*":[`.${t}`]}}return(0,d.jsx)(st(),{ref:this.dropzoneRef,multiple:!1,accept:l,noKeyboard:!0,noClick:!0,maxSize:this.props.schema.maxSize||2097152,onDragEnter:()=>{this.setState({uploadFile:"dragging"})},onDragLeave:()=>this.setState({uploadFile:!0}),onDrop:(t,e)=>{this.setState({uploadFile:!1}),t.length?this.onDrop(t):window.alert(e&&e[0]&&e[0].errors&&e[0].errors[0]&&e[0].errors[0].message||c.I18n.t("Cannot upload"))},children:t=>{let{getRootProps:s,getInputProps:i}=t;return(0,d.jsxs)("div",{style:{...it.uploadDiv,..."dragging"===this.state.uploadFile?it.uploadDivDragging:void 0,...e?it.disabledOpacity:void 0},...s(),children:[(0,d.jsx)("input",{...i()}),"dragging"===this.state.uploadFile?(0,d.jsx)("div",{style:{...it.uploadCenterDiv,...this.state.uploadError?it.error:void 0},children:(0,d.jsxs)("div",{style:it.uploadCenterTextAndIcon,children:[(0,d.jsx)(p.UploadFile,{style:it.uploadCenterIcon}),(0,d.jsx)("div",{style:it.uploadCenterText,children:"dragging"===this.state.uploadFile?c.I18n.t("ra_Drop file here"):c.I18n.t("ra_Place your files here or click here to open the browse dialog")})]})}):null,r,this.renderDeleteDialog()]})}})}}const pt=ht,ct={fullWidth:{width:"100%"},fullWidthOneButton:{width:"calc(100% - 69px)",marginRight:4},fullWidthIcon:{width:"calc(100% - 119px)",marginRight:4},selectedImage:{height:40,width:40,display:"inline-block",marginRight:8}},dt=["jpg","jpeg","svg","png","webp","gif","apng","avif","webp"],ut=["mp3","ogg","wav","aac"],mt=["avi","mp4","mov"],gt=["txt","log","html","htm"],xt=["json","js","ts"];const vt=class extends g{constructor(){super(...arguments),this.imagePrefix="../.."}componentDidMount(){super.componentDidMount();const t=g.getValue(this.props.data,this.props.attr);this.imagePrefix=void 0===this.props.oContext.imagePrefix?"./files":this.props.oContext.imagePrefix,this.setState({value:null!==t&&void 0!==t?t:""})}static getDerivedStateFromProps(t,e){const s=g.getValue(t.data,t.attr);return null===s||void 0===s||s.toString().trim()!==(e.value||"").toString().trim()?{value:null!==s&&void 0!==s?s:""}:null}loadFile(){const t=this.state.value.indexOf("/");if(-1!==t){const e=this.state.value.substring(0,t),s=this.state.value.substring(t+1);return this.props.oContext.socket.readFile(e,s,!0)}return Promise.resolve(null)}play(){this.loadFile().then((t=>{if("undefined"!==typeof AudioContext&&null!==t&&void 0!==t&&t.file){const e=new AudioContext,s=pt.base64ToArrayBuffer(t.file);e.decodeAudioData(s,(t=>{const s=e.createBufferSource();s.buffer=t,s.connect(e.destination),s.start(0)}),(t=>window.alert(`Cannot play: ${t.message}`)))}}))}getIcon(){const t=this.state.value.split(".").pop().toLowerCase();return dt.includes(t)?(0,d.jsx)("div",{style:{...ct.selectedImage,backgroundImage:`url(${this.imagePrefix}/${this.state.value})`,backgroundSize:"contain",backgroundRepeat:"no-repeat"}}):ut.includes(t)?(0,d.jsx)(h.IconButton,{style:{color:"#00FF00"},onClick:()=>this.play(),children:(0,d.jsx)(p.PlayArrow,{})}):gt.includes(t)?(0,d.jsx)(p.Article,{}):mt.includes(t)?(0,d.jsx)(p.Videocam,{}):xt.includes(t)?(0,d.jsx)(p.Code,{}):null}renderFileBrowser(){return this.state.showFileBrowser?(0,d.jsx)(c.DialogSelectFile,{imagePrefix:this.props.oContext.imagePrefix,socket:this.props.oContext.socket,selected:this.state.value,onClose:()=>this.setState({showFileBrowser:!1}),onOk:t=>{const e=Array.isArray(t)?t[0]:t;this.setState({value:e},(()=>this.onChange(this.props.attr,!1===this.props.schema.trim?e:(e||"").trim())))},selectOnlyFolders:this.props.schema.selectOnlyFolders,allowUpload:this.props.schema.allowUpload,allowDownload:this.props.schema.allowDownload,allowCreateFolder:this.props.schema.allowCreateFolder,allowView:this.props.schema.allowView,showToolbar:this.props.schema.showToolbar,limitPath:this.props.schema.limitPath,theme:this.props.oContext.theme}):null}renderItem(t,e){const s=this.getIcon();return(0,d.jsxs)("div",{style:ct.fullWidth,children:[s,(0,d.jsx)(h.TextField,{variant:"standard",style:s?ct.fullWidthIcon:ct.fullWidthOneButton,value:null===this.state.value||void 0===this.state.value?"":this.state.value,error:!!t,disabled:!!e,slotProps:{htmlInput:{maxLength:this.props.schema.maxLength||this.props.schema.max||void 0,readOnly:!!this.props.schema.disableEdit}},onChange:t=>{const e=t.target.value;this.setState({value:e},(()=>this.onChange(this.props.attr,!1===this.props.schema.trim?e:(e||"").trim())))},placeholder:this.getText(this.props.schema.placeholder),label:this.getText(this.props.schema.label),helperText:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)}),(0,d.jsx)(h.Button,{disabled:e,variant:"outlined",onClick:()=>this.setState({showFileBrowser:!0}),children:"..."}),this.renderFileBrowser()]})}};const ft=class extends g{componentDidMount(){super.componentDidMount();const t=g.getValue(this.props.data,this.props.attr);this.props.oContext.socket.getEnums("functions").then((e=>{const s=Object.keys(e).map((t=>({value:this.props.schema.short?t.replace("enum.functions.",""):t,label:this.getText(e[t].common.name),obj:e[t]})));!1!==this.props.schema.allowDeactivate&&s.unshift({label:c.I18n.t(g.NONE_LABEL),value:g.NONE_VALUE}),this.setState({value:t,selectOptions:s})}))}renderItem(t,e){if(!this.state.selectOptions)return null;const s=this.state.selectOptions.find((t=>t.value===this.state.value));return(0,d.jsxs)(h.FormControl,{variant:"standard",fullWidth:!0,children:[this.props.schema.label?(0,d.jsx)(h.InputLabel,{children:this.getText(this.props.schema.label)}):null,(0,d.jsx)(h.Select,{variant:"standard",error:!!t,disabled:!!e,value:this.state.value||"_",renderValue:()=>s?s.obj?(0,d.jsx)(c.TextWithIcon,{value:s.obj,themeType:this.props.oContext.themeType,lang:c.I18n.getLanguage()}):s.label:"",onChange:t=>{this.setState({value:"_"===t.target.value?"":t.target.value},(()=>this.onChange(this.props.attr,this.state.value)))},children:this.state.selectOptions.map((t=>(0,d.jsx)(h.MenuItem,{value:t.value,style:t.value===g.DIFFERENT_VALUE?{opacity:.5}:{},children:t.obj?(0,d.jsx)(c.TextWithIcon,{value:t.obj,themeType:this.props.oContext.themeType,lang:c.I18n.getLanguage()}):t.label},t.value)))}),this.props.schema.help?(0,d.jsx)(h.FormHelperText,{children:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)}):null]})}};const yt=class extends g{componentDidMount(){super.componentDidMount(),this.props.oContext.socket.getHostByIp(this.props.common.host).then((t=>{this.props.schema.listenOnAllPorts||(t=t.filter((t=>"0.0.0.0"!==t.address&&"::"!==t.address))),this.props.schema.onlyIp4?t=t.filter((t=>"ipv4"===t.family)):this.props.schema.onlyIp6&&(t=t.filter((t=>"ipv6"===t.family))),this.props.schema.noInternal&&(t=t.filter((t=>!t.internal))),t.forEach((t=>{"0.0.0.0"===t.address?t.name=`[IPv4] 0.0.0.0 - ${c.I18n.t("ra_Listen on all IPs")}`:"::"===t.address&&(t.name=`[IPv6] :: - ${c.I18n.t("ra_Listen on all IPs")}`)})),this.setState({ips:t})})).catch((t=>console.error(t)))}renderItem(t,e){var s,i;const o=g.getValue(this.props.data,this.props.attr),a=null===(s=this.state.ips)||void 0===s?void 0:s.find((t=>t.address===o));return(0,d.jsxs)(h.FormControl,{fullWidth:!0,variant:"standard",children:[this.state.ips&&this.props.schema.label?(0,d.jsx)(h.InputLabel,{children:this.getText(this.props.schema.label)}):null,this.state.ips?(0,d.jsx)(h.Select,{variant:"standard",error:!!t,disabled:!!e,value:o,renderValue:t=>(null===a||void 0===a?void 0:a.name)||t,onChange:t=>this.onChange(this.props.attr,t.target.value),children:null===(i=this.state.ips)||void 0===i?void 0:i.map(((t,e)=>(0,d.jsx)(h.MenuItem,{value:t.address,children:t.name},e)))}):(0,d.jsx)(h.TextField,{fullWidth:!0,variant:"standard",error:!!t,disabled:!!e,value:o,onChange:t=>this.onChange(this.props.attr,t.target.value),label:this.getText(this.props.schema.label)}),this.props.schema.help?(0,d.jsx)(h.FormHelperText,{children:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)}):null]})}};const bt=class extends g{constructor(){super(...arguments),this.initialized=!1,this.localContext=void 0}componentDidMount(){super.componentDidMount(),this.askInstance()}askInstance(){if(this.props.alive){let t=this.props.schema.data;if(void 0===t&&this.props.schema.jsonData){const e=this.getPattern(this.props.schema.jsonData,null,!0);if(e)try{t=JSON.parse(e)}catch{console.error(`Cannot parse json data: ${JSON.stringify(t)}`)}}void 0===t&&(t=null),this.props.oContext.socket.sendTo(`${this.props.oContext.adapterName}.${this.props.oContext.instance}`,this.props.schema.command||"send",t).then((t=>this.setState({image:t||""})))}}getContext(){const t={};return Array.isArray(this.props.schema.alsoDependsOn)&&this.props.schema.alsoDependsOn.forEach((e=>t[e]=g.getValue(this.props.data,e))),JSON.stringify(t)}renderItem(){if(this.props.alive){const t=this.getContext();t===this.localContext&&this.initialized||(this.localContext=t,setTimeout((()=>this.askInstance()),this.initialized?300:50),this.initialized=!0)}return void 0===this.state.image?null:(0,d.jsx)("img",{alt:"dynamic content",src:this.state.image,style:{width:this.props.schema.width||"100%",height:this.props.schema.height}})}};const Ct=class extends g{constructor(t){super(t),this.index=void 0,this.index=Date.now()}componentDidMount(){if(super.componentDidMount(),this.props.schema.base64){const t=g.getValue(this.props.data,this.props.attr);this.setState({value:t})}else this.props.oContext.socket.fileExists(`${this.props.oContext.adapterName}.${this.props.oContext.instance}`,this.props.attr).then((t=>t&&this.loadImage()))}_getUrl(t){t&&(this.index=Date.now());let e=`files/${this.props.oContext.adapterName}.${this.props.oContext.instance}/${this.props.attr}?t=${this.index}`;return"3000"===window.location.port&&(e=`${window.location.protocol}//${window.location.hostname}:8081/${e}`),e}loadImage(){fetch(this._getUrl()).then((t=>t.blob())).then((t=>{const e=new FileReader;e.onload=()=>{this.setState({value:e.result})},e.readAsDataURL(t)})).catch((t=>console.error(t)))}renderItem(t,e){return(0,d.jsxs)(h.FormControl,{fullWidth:!0,variant:"standard",children:[this.props.schema.label?(0,d.jsx)(h.InputLabel,{shrink:!0,children:this.getText(this.props.schema.label)}):null,(0,d.jsx)(c.UploadImage,{error:!!t,disabled:e,accept:this.props.schema.accept,crop:this.props.schema.crop,maxSize:this.props.schema.maxSize||262144,icon:this.state.value||void 0,removeIconFunc:()=>this.setState({value:null},(()=>{if(this.props.schema.base64){const t=this.onChange(this.props.attr,this.state.value);t instanceof Promise&&t.catch((t=>console.error(`Cannot set value: ${t}`)))}else this.props.oContext.socket.deleteFile(`${this.props.oContext.adapterName}.${this.props.oContext.instance}`,this.props.attr).catch((t=>console.error(t)))})),onChange:t=>this.setState({value:t},(()=>{if(this.props.schema.base64){const t=this.onChange(this.props.attr,this.state.value);t instanceof Promise&&t.catch((t=>console.error(`Cannot set value: ${t}`)))}else t.startsWith("data")&&(t=t.split(",")[1]);this.props.oContext.socket.writeFile64(`${this.props.oContext.adapterName}.${this.props.oContext.instance}`,this.props.attr,t).catch((t=>console.error(t)))}))}),this.props.schema.help?(0,d.jsx)(h.FormHelperText,{children:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)}):null]})}},jt={icon:{width:20,height:20,marginRight:4}};const wt=class extends g{constructor(){super(...arguments),this.onInstancesUpdate=(t,e)=>{if(!t.match(/^system\.adapter\.[-_a-z\d]+\.\d+$/))return;const s=this.props.schema.long?t:this.props.schema.short?t.split(".").pop():t.replace(/^system\.adapter\./,""),i=this.state.selectOptions.findIndex((t=>t.value===s));if(e){if("_dataSources"===this.props.schema.adapter&&(!e.common||!e.common.getHistory))return;if(-1===i){const t=JSON.parse(JSON.stringify(this.state.selectOptions)),s="object"===typeof e.common.name?e.common.name[c.I18n.getLanguage()]||e.common.name.en:e.common.name;t.push({value:this.props.schema.long?e._id:this.props.schema.short?e._id.split(".").pop():e._id.replace(/^system\.adapter\./,""),label:`${s} [${e._id.replace(/^system\.adapter\./,"")}]`,icon:`adapter/${s}/${e.common.icon}`}),t.sort(((t,e)=>t.label>e.label?1:t.label<e.label?-1:0)),this.setState({selectOptions:t})}}else if(-1!==i){const t=JSON.parse(JSON.stringify(this.state.selectOptions)),e={};this.state.value===t[i].value&&(e.value=g.NONE_VALUE),t.splice(i,1),e.selectOptions=t,this.setState(e)}}}componentDidMount(){super.componentDidMount();const t=g.getValue(this.props.data,this.props.attr);let e=this.props.schema.adapter;"_dataSources"===e&&(e=void 0),this.props.oContext.socket.getAdapterInstances(e,!0).then((async s=>{"_dataSources"===this.props.schema.adapter?s=s.filter((t=>{var e;return null===t||void 0===t||null===(e=t.common)||void 0===e?void 0:e.getHistory})):this.props.schema.adapter?s=s.filter((t=>null===t||void 0===t?void 0:t._id.startsWith(`system.adapter.${this.props.schema.adapter}.`))):this.props.schema.adapters&&Array.isArray(this.props.schema.adapters)&&(s=s.filter((t=>{var e;return this.props.schema.adapters.includes(null===t||void 0===t||null===(e=t.common)||void 0===e?void 0:e.name)}))),this.props.schema.onlyEnabled&&(s=s.filter((t=>{var e;return null===t||void 0===t||null===(e=t.common)||void 0===e?void 0:e.enabled})));const i=s.map((t=>({value:this.props.schema.long?t._id:this.props.schema.short?t._id.split(".").pop():t._id.replace(/^system\.adapter\./,""),label:`${t.common.name} [${t._id.replace(/^system\.adapter\./,"")}]`,icon:`adapter/${t.common.name}/${t.common.icon}`})));i.sort(((t,e)=>t.value>e.value?1:t.value<e.value?-1:0)),!1!==this.props.schema.allowDeactivate&&i.unshift({label:c.I18n.t(g.NONE_LABEL),value:g.NONE_VALUE}),this.props.schema.all&&i.unshift({label:c.I18n.t("sch_all"),value:"*"}),this.setState({value:t||"",selectOptions:i}),await this.props.oContext.socket.subscribeObject(`system.adapter.${e?`${e}.`:""}*`,this.onInstancesUpdate)})).catch((t=>console.error(`Cannot get instances: ${t}`)))}componentWillUnmount(){this.props.oContext.socket.unsubscribeObject("system.adapter.*",this.onInstancesUpdate).then((()=>{})),super.componentWillUnmount()}renderItem(t,e){var s;if(!this.state.selectOptions)return null;const i=null===(s=this.state.selectOptions)||void 0===s?void 0:s.find((t=>t.value===this.state.value));return(0,d.jsxs)(h.FormControl,{fullWidth:!0,variant:"standard",children:[this.props.schema.label?(0,d.jsx)(h.InputLabel,{shrink:!0,children:this.getText(this.props.schema.label)}):null,(0,d.jsx)(h.Select,{variant:"standard",error:!!t,displayEmpty:!0,disabled:!!e,value:this.state.value,renderValue:()=>(0,d.jsxs)("span",{style:{display:"flex"},children:[null!==i&&void 0!==i&&i.icon?(0,d.jsx)("img",{src:`./${i.icon}`,alt:i.value,style:jt.icon}):null,this.getText(null===i||void 0===i?void 0:i.label,!0)]}),onChange:t=>this.setState({value:t.target.value},(()=>this.onChange(this.props.attr,this.state.value))),children:this.state.selectOptions.map((t=>(0,d.jsxs)(h.MenuItem,{value:t.value,style:t.value===g.NONE_VALUE?{opacity:.5}:{},children:[t.icon?(0,d.jsx)("img",{src:`./${t.icon}`,alt:t.value,style:jt.icon}):null,this.getText(t.label,!0)]},t.value)))}),this.props.schema.help?(0,d.jsx)(h.FormHelperText,{children:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)}):null]},this.props.attr)}},It={address:{fontSize:"smaller",opacity:.5,marginLeft:8}};const St=class extends g{componentDidMount(){super.componentDidMount(),this.props.oContext.socket.getObject(`system.host.${this.props.common.host}`).then((t=>{var e,s;const i=[];if(null!==t&&void 0!==t&&null!==(e=t.native)&&void 0!==e&&null!==(s=e.hardware)&&void 0!==s&&s.networkInterfaces){const e=t.native.hardware.networkInterfaces;Object.keys(e).forEach((t=>{if(this.props.schema.ignoreInternal&&!e[t].find((t=>!t.internal)))return;if(this.props.schema.ignoreLoopback&&e[t].find((t=>"127.0.0.1"===t.address||"::1"===t.address)))return;let s=e[t].find((t=>"IPv4"===t.family));s=s||e[t].find((t=>"IPv6"===t.family)),i.push({value:t,address:s.address})}))}this.setState({interfaces:i})})).catch((t=>window.alert(`Cannot read interfaces: ${t}`)))}renderItem(t,e){var s,i,o;const a=g.getValue(this.props.data,this.props.attr),n=null===(s=this.state.interfaces)||void 0===s?void 0:s.find((t=>t.value===a));return(0,d.jsxs)(h.FormControl,{fullWidth:!0,variant:"standard",children:[null!==(i=this.state.interfaces)&&void 0!==i&&i.length&&this.props.schema.label?(0,d.jsx)(h.InputLabel,{children:this.getText(this.props.schema.label)}):null,null!==(o=this.state.interfaces)&&void 0!==o&&o.length?(0,d.jsx)(h.Select,{variant:"standard",error:!!t,disabled:!!e,value:a,renderValue:t=>n?(0,d.jsxs)("span",{children:[n.value,(0,d.jsx)("span",{style:It.address,children:n.address})]}):t,onChange:t=>this.onChange(this.props.attr,t.target.value),children:this.state.interfaces.map(((t,e)=>(0,d.jsx)(h.MenuItem,{value:t.value,children:(0,d.jsxs)("span",{children:[t.value,(0,d.jsx)("span",{style:It.address,children:t.address})]})},e)))}):(0,d.jsx)(h.TextField,{fullWidth:!0,variant:"standard",error:!!t,disabled:!!e,value:a,onChange:t=>this.onChange(this.props.attr,t.target.value),label:this.getText(this.props.schema.label)}),this.props.schema.help?(0,d.jsx)(h.FormHelperText,{children:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)}):null]})}},Tt={modalDialog:{minWidth:400,maxWidth:800},overflowHidden:{display:"flex",overflow:"hidden"},titleIcon:{marginRight:5},content:{fontSize:16},languageButton:{position:"absolute",right:8,top:8},languageButtonActive:{color:"primary.main"}},Dt=t=>{let{toggleTranslation:e,noTranslation:s,title:o,fullWidth:a,help:n,maxWidth:r,progress:l,icon:u,applyDisabled:m,applyButton:g,onClose:x,children:v,titleButtonApply:f,titleButtonClose:y,onApply:b,textInput:C,defaultValue:j,overflowHidden:w}=t;const[I,S]=(0,i.useState)(j);(0,i.useEffect)((()=>{S(j)}),[j]);let T=null;return u&&(T=u),(0,d.jsxs)(h.Dialog,{open:!0,maxWidth:r||"md",fullWidth:!!a,disableEscapeKeyDown:!1,onClose:x,sx:{"& .MuiPaper-root":Tt.modalDialog},children:[o&&(0,d.jsxs)(h.DialogTitle,{children:[u?(0,d.jsx)(T,{style:Tt.titleIcon}):null,o,"en"!==c.I18n.getLanguage()&&e?(0,d.jsx)(h.IconButton,{size:"large",style:{...Tt.languageButton,...s?Tt.languageButtonActive:{}},onClick:()=>e(),title:c.I18n.t("Disable/Enable translation"),children:(0,d.jsx)(p.Language,{})}):null]}),(0,d.jsxs)(h.DialogContent,{sx:{...w?Tt.overflowHidden:{},...Tt.content},style:{paddingTop:8},children:[C&&(0,d.jsx)(h.TextField,{autoComplete:"off",fullWidth:!0,autoFocus:!0,variant:"outlined",size:"medium",multiline:!0,value:I,onChange:t=>S(t.target.value)}),v,n?(0,d.jsx)("div",{children:n}):null]}),(0,d.jsxs)(h.DialogActions,{children:[!1!==g&&(0,d.jsx)(h.Button,{startIcon:(0,d.jsx)(p.Check,{}),disabled:l||m&&j===I,onClick:()=>b&&b(C?I:""),variant:"contained",color:"primary",children:c.I18n.t(f||"Ok")}),(0,d.jsx)(h.Button,{color:"grey",onClick:()=>x&&x(),disabled:l,variant:"contained",startIcon:(0,d.jsx)(p.Close,{}),children:c.I18n.t(y||"Cancel")})]})]})};var kt=s(2091),Ot=s.n(kt);s(77563),s(78172),s(67244),s(85781),s(21571);const _t={jsonError:{border:"1px solid red",minHeight:200},jsonNoError:{border:"1px solid #00000000",minHeight:200}};const Ft=function(t){return(0,d.jsx)(Ot(),{style:!0===t.error?_t.jsonError:!1===t.error?_t.jsonNoError:void 0,mode:t.mode||"json",width:"100%",height:"100%",showPrintMargin:t.editValueMode,showGutter:t.editValueMode,highlightActiveLine:t.editValueMode,defaultValue:t.defaultValue,theme:"dark"===t.themeType?"clouds_midnight":"chrome",value:t.value,readOnly:!t.onChange,onChange:e=>t.onChange(e),name:t.name||"UNIQUE_ID_OF_DIV1",fontSize:t.fontSize||14,setOptions:{enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!0,showLineNumbers:t.editValueMode,tabSize:t.editValueMode?2:void 0},editorProps:{$blockScrolling:!0}})},Nt={fullWidth:{width:"100%"},flex:{display:"flex"},button:{height:48,minWidth:48},wrapper:{width:"calc(100vw - 40px)",height:"calc(100vh - 188px)"}};const Et=class extends g{componentDidMount(){super.componentDidMount();const{data:t,attr:e}=this.props,s=g.getValue(t,e)||{};this.setState({value:s,initialized:!0,jsonError:this.validateJson(s)})}validateJson(t){let e=!1;if(!1!==this.props.schema.validateJson&&(t||!this.props.schema.allowEmpty))try{JSON.parse(t)}catch(s){console.log("Error in JSON",s),e=!0}return e}renderItem(t,e){if(!this.state.initialized)return null;const{schema:s,data:i,attr:o}=this.props,{value:a,showSelectId:n}=this.state;return(0,d.jsxs)(h.FormControl,{fullWidth:!0,variant:"standard",children:[(0,d.jsx)("div",{style:Nt.flex,children:(0,d.jsx)(h.Button,{color:"grey",disabled:e,style:Nt.button,size:"small",variant:"outlined",onClick:()=>this.setState({showSelectId:!0}),children:c.I18n.t("ra_JSON editor")})}),n?(0,d.jsx)(Dt,{title:this.getText(s.label),overflowHidden:!0,onClose:()=>this.setState({showSelectId:!1,value:g.getValue(i,o)||{}}),onApply:()=>this.setState({showSelectId:!1},(()=>this.onChange(o,a))),children:(0,d.jsx)("div",{style:{...Nt.wrapper,...this.state.jsonError?{}:void 0},children:(0,d.jsx)(Ft,{value:"object"===typeof a?JSON.stringify(a):a,onChange:t=>this.setState({value:t,jsonError:this.validateJson(t)}),name:"ConfigJsonEditor",themeType:this.props.oContext.themeType})})}):null,s.help||this.state.jsonError?(0,d.jsx)(h.FormHelperText,{children:this.state.jsonError?c.I18n.t("ra_Invalid JSON"):this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)}):null]})}},$t=[{value:"en",label:"English"},{value:"de",label:"Deutsch"},{value:"ru",label:"\u0440\u0443\u0441\u0441\u043a\u0438\u0439"},{value:"pt",label:"Portugues"},{value:"nl",label:"Nederlands"},{value:"fr",label:"fran\xe7ais"},{value:"it",label:"Italiano"},{value:"es",label:"Espanol"},{value:"pl",label:"Polski"},{value:"uk",label:"\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0438\u0439"},{value:"zh-ch",label:"\u7b80\u4f53\u4e2d\u6587"}];const Lt=class extends g{componentDidMount(){super.componentDidMount();const t=g.getValue(this.props.data,this.props.attr),e=[...$t];this.props.schema.system?e.unshift({value:"",label:c.I18n.t("ra_System language")}):e.unshift({value:"",label:c.I18n.t("ra_none")}),this.setState({value:this.props.schema.system?t||"":t||c.I18n.getLanguage(),selectOptions:e})}renderItem(t,e){var s,i;if(!this.state.selectOptions)return null;const o=null===(s=this.state.selectOptions)||void 0===s?void 0:s.find((t=>t.value===this.state.value||!t.value&&!this.state.value));return(0,d.jsxs)(h.FormControl,{fullWidth:!0,variant:"standard",children:[this.props.schema.label?(0,d.jsx)(h.InputLabel,{children:this.getText(this.props.schema.label)}):null,(0,d.jsx)(h.Select,{variant:"standard",error:!!t,disabled:e,value:this.state.value||"_",renderValue:()=>this.getText(null===o||void 0===o?void 0:o.label,this.props.schema.noTranslation),onChange:t=>{let{value:e}=t.target;"_"===e&&(e=""),this.setState({value:e},(()=>{const t=this.onChange(this.props.attr,e);if(t instanceof Promise&&t.catch((t=>console.error(t))),this.props.schema.changeGuiLanguage)if(e){if(e===c.I18n.getLanguage())return;c.I18n.setLanguage(e),this.props.oContext.changeLanguage&&this.props.oContext.changeLanguage()}else this.props.oContext.socket.getSystemConfig().then((t=>{t.common.language!==c.I18n.getLanguage()&&t.common.language&&(c.I18n.setLanguage(t.common.language),this.props.oContext.changeLanguage&&this.props.oContext.changeLanguage())})).catch((t=>console.error(`Cannot read system config: ${t}`)))}))},children:null===(i=this.state.selectOptions)||void 0===i?void 0:i.map((t=>(0,d.jsx)(h.MenuItem,{value:t.value,children:t.label},t.value)))}),this.props.schema.help?(0,d.jsx)(h.FormHelperText,{children:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)}):null]})}};const At=class extends g{constructor(t){super(t),this.scrollRef=void 0,this.scrollRef=o().createRef()}scrolledDown(){return!!this.scrollRef.current&&this.scrollRef.current.offsetHeight+this.scrollRef.current.scrollTop>=this.scrollRef.current.scrollHeight}componentDidMount(){super.componentDidMount(),g.getValue(this.props.data,this.props.attr)||(this.props.schema.licenseUrl?(this.setState({showLicenseDialog:!0,loading:!0,scrolledDown:!1}),fetch(this.props.schema.licenseUrl).then((t=>t.text())).then((t=>this.setState({license:t,loading:!1}))).catch((t=>this.setState({license:t.toString(),loading:!1,error:!0,scrolledDown:!1})))):this.setState({showLicenseDialog:!0,scrolledDown:!1}),setTimeout((()=>{if(this.scrollRef.current){this.scrolledDown()?this.setState({scrolledDown:!0}):this.scrollRef.current.addEventListener("scroll",(()=>{!this.state.scrolledDown&&this.scrolledDown()&&this.setState({scrolledDown:!0})}))}}),1e3))}renderItem(t,e){return this.state.showLicenseDialog?(0,d.jsxs)(h.Dialog,{maxWidth:"lg",open:!0,onClose:(t,e)=>{"escapeKeyDown"!==e&&"backdropClick"!==e&&this.setState({showLicenseDialog:!1})},children:[(0,d.jsx)(h.DialogTitle,{children:this.props.schema.title?c.I18n.t(this.props.schema.title):c.I18n.t("ra_License agreement")}),(0,d.jsxs)(h.DialogContent,{children:[this.props.schema.licenseUrl?(0,d.jsxs)(d.Fragment,{children:[this.state.loading?(0,d.jsx)(h.LinearProgress,{}):null,(0,d.jsx)("pre",{ref:this.scrollRef,style:{width:"100%",height:"100%",overflowY:"auto",fontSize:14},children:this.state.license})]}):null,!this.props.schema.licenseUrl&&this.props.schema.texts?(0,d.jsx)("div",{ref:this.scrollRef,style:{width:"100%",height:"100%",overflowY:"auto",fontSize:14},children:this.props.schema.texts.map(((t,e)=>this.props.schema.noTranslation?(0,d.jsx)("p",{children:t},e):(0,d.jsx)("p",{children:c.I18n.t(t)},e)))}):null]}),(0,d.jsxs)(h.DialogActions,{children:[this.props.schema.checkBox?(0,d.jsx)(h.FormControlLabel,{control:(0,d.jsx)(h.Checkbox,{disabled:e,checked:!!this.state.licenseChecked,onClick:()=>this.setState({licenseChecked:!this.state.licenseChecked})}),label:c.I18n.t(this.props.schema.checkBox)}):null,(0,d.jsx)(h.Button,{disabled:e||this.state.loading||this.state.error||this.props.schema.checkBox&&!this.state.licenseChecked||!this.state.scrolledDown,onClick:()=>{this.setState({showLicenseDialog:!1});const t=this.onChange(this.props.attr,!0);t instanceof Promise&&t.catch((t=>console.error(`Cannot set value: ${t}`)))},color:"primary",variant:"contained",startIcon:(0,d.jsx)(p.Check,{}),children:this.props.schema.agreeText?c.I18n.t(this.props.schema.agreeText):c.I18n.t("ra_Accept license")}),(0,d.jsx)(h.Button,{onClick:()=>{this.setState({showLicenseDialog:!1}),setTimeout((()=>this.setState({showLicenseDialog:!0})),2e3)},color:"grey",variant:"contained",startIcon:(0,d.jsx)(p.Close,{}),children:c.I18n.t("ra_Close")})]})]}):null}},Vt={indeterminate:{opacity:.5},control:{flexDirection:"row",width:"100%"}};const Pt=class extends g{constructor(){super(...arguments),this.updateTimeout=void 0}componentDidMount(){super.componentDidMount();let t=g.getValue(this.props.data,this.props.attr);if(null!==t&&void 0!==t||(t=""),Array.isArray(t)&&this.props.oContext.multiEdit)return t=g.DIFFERENT_VALUE,void this.setState({_value:t,oldValue:t});this.setState({_value:t.toString(),oldValue:t.toString()})}static getDerivedStateFromProps(t,e){if(void 0!==t.schema.min&&t.schema.min<0||void 0!==t.schema.max&&t.schema.max<0)return null;const s=g.getValue(t.data,t.attr);return t.oContext.multiEdit&&e._value===g.DIFFERENT_VALUE?{_value:g.DIFFERENT_VALUE}:null===s||void 0===s||null===e.oldValue||void 0===e.oldValue||s.toString()!==parseFloat(e._value).toString()&&s.toString()!==e.oldValue.toString()?{_value:s}:null}checkValue(t){if(null===t||void 0===t)return null;const e=""===(t=t.toString().trim())?0:parseFloat(t);return""!==t&&Number.isNaN(e)?"ra_Not a number":""!==t&&window.isFinite(e)?void 0!==this.props.schema.min&&e<this.props.schema.min?"ra_Too small":void 0!==this.props.schema.max&&e>this.props.schema.max?"ra_Too big":""===t||"-"===t||Number.isNaN(e)?"ra_Not a number":null:"ra_Not a number"}renderItem(t,e){const s=Array.isArray(this.state._value)||this.state._value===g.DIFFERENT_VALUE;if(null!==this.state.oldValue&&void 0!==this.state.oldValue?(this.updateTimeout&&clearTimeout(this.updateTimeout),this.updateTimeout=setTimeout((()=>{this.updateTimeout=void 0,this.setState({oldValue:null})}),30)):this.updateTimeout&&(clearTimeout(this.updateTimeout),this.updateTimeout=void 0),s){const s=g.getValue(this.props.data,this.props.attr),i=(null===s||void 0===s?void 0:s.filter((t=>t||0===t)).map((t=>({label:t.toString(),value:t}))))||[];return i.unshift({label:c.I18n.t(g.DIFFERENT_LABEL),value:g.DIFFERENT_VALUE}),(0,d.jsx)(h.Autocomplete,{style:Vt.indeterminate,fullWidth:!0,freeSolo:!0,value:i[0],getOptionSelected:(t,e)=>t.label===e.label,onChange:(t,e)=>{const s=this.onChange(this.props.attr,null===e||void 0===e?void 0:e.value,(()=>{this.setState({_value:null===e||void 0===e?void 0:e.value,oldValue:this.state._value})}));s instanceof Promise&&s.catch((t=>console.error(t)))},options:i,getOptionLabel:t=>t.label,renderInput:s=>(0,d.jsx)(h.TextField,{...s,label:this.getText(this.props.schema.label),variant:"standard",slotProps:{htmlInput:{...s.inputProps,readOnly:this.props.schema.readOnly||!1}},error:!!t,placeholder:this.getText(this.props.schema.placeholder),helperText:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation),disabled:!!e})})}return!t&&null!==this.state._value&&void 0!==this.state._value&&this.state._value&&(t=this.checkValue(this.state._value))&&(t=c.I18n.t(t)),(0,d.jsx)(h.FormControl,{variant:"standard",style:Vt.control,children:(0,d.jsx)(h.TextField,{variant:"standard",type:"number",fullWidth:!0,slotProps:{htmlInput:{min:this.props.schema.min,max:this.props.schema.max,step:this.props.schema.step,readOnly:this.props.schema.readOnly||!1}},value:null===this.state._value||void 0===this.state._value?"":this.state._value,error:!!t,disabled:!!e,onChange:t=>{const e=t.target.value,s=this.checkValue(e);s?this.onError(this.props.attr,c.I18n.t(s)):this.onError(this.props.attr),this.setState({_value:e,oldValue:this.state._value},(()=>this.onChange(this.props.attr,parseFloat(e))))},placeholder:this.getText(this.props.schema.placeholder),label:this.getText(this.props.schema.label),helperText:t&&"string"===typeof t?t:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)})})}},Wt={flex:{display:"flex"},button:{height:48,marginLeft:4,minWidth:48}};const Ut=class extends g{componentDidMount(){super.componentDidMount();const{data:t,attr:e}=this.props,s=g.getValue(t,e)||"";this.setState({value:s,initialized:!0})}renderItem(t,e){if(!this.state.initialized)return null;const s=this.props.oContext.socket,{schema:i,attr:o}=this.props,{value:a,showSelectId:n}=this.state;return(0,d.jsxs)(h.FormControl,{fullWidth:!0,variant:"standard",children:[i.label?(0,d.jsx)(h.InputLabel,{shrink:!0,children:this.getText(i.label)}):null,(0,d.jsxs)("div",{style:Wt.flex,children:[(0,d.jsx)(h.TextField,{variant:"standard",fullWidth:!0,value:a,error:!!t,disabled:e,placeholder:this.getText(i.placeholder),label:this.getText(i.label),helperText:this.renderHelp(i.help,i.helpLink,i.noTranslation),onChange:t=>{const e=t.target.value;this.setState({value:e},(()=>this.onChange(o,e)))}}),(0,d.jsx)(h.Button,{color:"grey",disabled:e,style:Wt.button,size:"small",variant:"outlined",onClick:()=>this.setState({showSelectId:!0}),children:"..."})]}),n?(0,d.jsx)(c.DialogSelectID,{imagePrefix:void 0===this.props.oContext.imagePrefix?"../..":this.props.oContext.imagePrefix,dialogName:`admin.${this.props.oContext.adapterName}`,filterFunc:i.filterFunc,themeType:this.props.oContext.themeType,theme:this.props.oContext.theme,types:i.types?Array.isArray(i.types)?i.types:[i.types]:void 0,customFilter:i.customFilter,filters:i.filters,socket:s,selected:a,root:i.root,onClose:()=>this.setState({showSelectId:!1}),onOk:t=>this.setState({showSelectId:!1,value:t},(()=>this.onChange(o,t)))}):null]})}},Bt={fullWidth:{width:"100%",display:"inline-block"},halfWidth1:{width:"calc(50% - 5px)",display:"inline-block",marginRight:8},halfWidth2:{width:"calc(50% - 5px)",display:"inline-block"}},Rt="____ppp____";const Mt=class extends g{componentDidMount(){super.componentDidMount();const t=g.getValue(this.props.data,this.props.attr);this.setState({_repeat:t?Rt:"",_visible:!1,value:t?Rt:"",_notEqual:!1})}onChangePassword(t,e){void 0===t&&(t=this.state.value),void 0===e&&(e=this.state._repeat);const s=!!this.props.schema.repeat&&e!==t;this.setState({value:t,_repeat:e,_notEqual:s},(()=>{if(s)this.onError(this.props.attr,c.I18n.t("ra_Passwords are not equal!"));else{this.onError(this.props.attr);const e=this.onChange(this.props.attr,t);e instanceof Promise&&e.catch((t=>this.onError(this.props.attr,t)))}}))}renderItem(t,e){if(void 0===this.state._notEqual)return null;const s=(0,d.jsx)(h.TextField,{variant:"standard",fullWidth:!0,type:this.state._visible&&this.state.value!==Rt?"text":"password",value:this.state.value,error:!!t||this.state._notEqual,disabled:!!e,onChange:t=>this.onChangePassword(t.target.value),label:this.getText(this.props.schema.label),slotProps:{input:{autoComplete:"new-password",endAdornment:this.state.value&&this.state.value!==Rt&&this.props.schema.visible&&!e&&!this.props.schema.readOnly?(0,d.jsx)(h.InputAdornment,{position:"end",children:(0,d.jsx)(h.IconButton,{size:"large",tabIndex:-1,onClick:t=>{t.preventDefault(),t.stopPropagation(),this.setState({_visible:!this.state._visible})},edge:"end",children:this.state._visible?(0,d.jsx)(p.VisibilityOff,{}):(0,d.jsx)(p.Visibility,{})})}):void 0},htmlInput:{autoComplete:"new-password",form:{autoComplete:"off"},maxLength:this.props.schema.maxLength||this.props.schema.max||void 0,readOnly:this.props.schema.readOnly||!1}},helperText:this.state._notEqual?c.I18n.t("ra_Passwords are not equal!"):this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)});if(this.props.schema.repeat&&!this.props.schema.readOnly){const i=this.state._visible?null:(0,d.jsx)(h.TextField,{variant:"standard",fullWidth:!0,type:"password",value:this.state._repeat,error:!!t||this.state._notEqual,disabled:!!e,onChange:t=>this.onChangePassword(void 0,t.target.value),label:`${this.getText(this.props.schema.label)} (${c.I18n.t("ra_repeat")})`,slotProps:{input:{autoComplete:"new-password"},htmlInput:{autoComplete:"new-password",form:{autoComplete:"off"},maxLength:this.props.schema.maxLength||this.props.schema.max||void 0}},helperText:this.state._notEqual?c.I18n.t("ra_Passwords are not equal!"):this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)});return(0,d.jsxs)("div",{style:Bt.fullWidth,children:[(0,d.jsx)("div",{style:Bt.halfWidth1,children:s}),(0,d.jsx)("div",{style:Bt.halfWidth2,children:i})]})}return s}};const Jt=class extends g{renderItem(t,e){return(0,d.jsx)(h.TextField,{variant:"standard",fullWidth:!0,disabled:!!e,slotProps:{input:{endAdornment:this.props.schema.copyToClipboard?(0,d.jsx)(h.IconButton,{size:"small",onClick:()=>{c.Utils.copyToClipboard(this.getPattern(this.props.schema.pattern,null,this.props.schema.noTranslation)),window.alert(c.I18n.t("ra_Copied"))},children:(0,d.jsx)(c.IconCopy,{})}):void 0}},value:this.getPattern(this.props.schema.pattern,null,!0),label:this.getText(this.props.schema.label),helperText:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)})}},zt={warning:{"& .Mui-error":{color:"orange"}}};const Ht=class extends g{constructor(){super(...arguments),this.updateTimeout=void 0}async componentDidMount(){super.componentDidMount();let t=g.getValue(this.props.data,this.props.attr);null!==t&&void 0!==t||(t=""),this.setState({_value:t.toString(),oldValue:t.toString()});const e=await this.props.oContext.socket.getAdapterInstances(),s=`system.adapter.${this.props.oContext.adapterName}.${this.props.oContext.instance}`,i=await this.props.oContext.socket.getObject(s),o=null===i||void 0===i?void 0:i.common.host,a=[];e.forEach((t=>{var e,i;if(!t||t._id===s||t.common.host!==o)return;if(null===(e=t.native)||void 0===e||!e.bind)return;if(null!==t&&void 0!==t&&t.native&&t.native.secure&&t.native.leEnabled&&t.native.leUpdate){const e=parseInt(t.native.leCheckPort||t.native.lePort,10);var n;if(e)a.push({name:`${t._id.replace("system.adapter.","")} (LE)`,port:e,v6bind:t.native.bind.includes(":")?t.native.bind:t.native.v6bind,bind:t.native.bind,enabled:!(null===(n=t.common)||void 0===n||!n.enabled)})}const r=parseInt(null===t||void 0===t||null===(i=t.native)||void 0===i?void 0:i.port,10);var l;r&&a.push({name:t._id.replace("system.adapter.",""),bind:t.native.bind,v6bind:t.native.bind.includes(":")?t.native.bind:t.native.v6bind,port:r,enabled:!(null===(l=t.common)||void 0===l||!l.enabled)})})),this.setState({ports:a})}static getDerivedStateFromProps(t,e){const s=g.getValue(t.data,t.attr);return null===s||void 0===s||null===e.oldValue||void 0===e.oldValue||s.toString()!==parseInt(e._value,10).toString()&&s.toString()!==e.oldValue.toString()?{_value:s}:null}checkValue(t){if(null===t||void 0===t)return null;const e=void 0===this.props.schema.min?20:this.props.schema.min,s=this.props.schema.max||65535,i=""===(t=t.toString().trim())?0:parseInt(t,10);return""!==t&&Number.isNaN(i)?"ra_Not a number":""!==t&&window.isFinite(Number(t))?i<e?"ra_Too small":i>s?"ra_Too big":""===t||"-"===t||Number.isNaN(i)?"ra_Not a number":null:"ra_Not a number"}renderItem(t,e){null!==this.state.oldValue&&void 0!==this.state.oldValue?(this.updateTimeout&&clearTimeout(this.updateTimeout),this.updateTimeout=setTimeout((()=>{this.updateTimeout=void 0,this.setState({oldValue:null})}),30)):this.updateTimeout&&(clearTimeout(this.updateTimeout),this.updateTimeout=void 0);const s=void 0===this.props.schema.min?20:this.props.schema.min,i=this.props.schema.max||65535;let o;if(this.state.ports){const e=parseInt(this.state._value,10);if(e){const s=this.state.ports.filter((t=>!this.props.data.bind||this.props.data.bind===t.bind||"0.0.0.0"===this.props.data.bind||"0.0.0.0"===t.bind));let i=s.findIndex((t=>t.port===e&&t.enabled));-1!==i?t=c.I18n.t("ra_Port is already used by %s",this.state.ports[i].name):(i=s.findIndex((t=>t.port===e&&!t.enabled)),-1!==i&&(o=!0,t=c.I18n.t("ra_Port could be used by %s",this.state.ports[i].name)))}}return t||null===this.state._value||void 0===this.state._value||"string"===typeof(t=this.checkValue(this.state._value))&&(t=c.I18n.t(t)),(0,d.jsx)(h.TextField,{variant:"standard",type:"number",fullWidth:!0,slotProps:{htmlInput:{min:s,max:i,readOnly:this.props.schema.readOnly||!1}},value:null===this.state._value||void 0===this.state._value?"":this.state._value,error:!!t,disabled:!!e,sx:o?zt.warning:void 0,onChange:t=>{const e=Number(t.target.value.toString().replace(/[^0-9]/g,"")).toString(),s=this.checkValue(e);s?this.onError(this.props.attr,c.I18n.t(s)):this.onError(this.props.attr),this.setState({_value:e,oldValue:this.state._value},(()=>{if(e.trim()===parseInt(e,10).toString()){const t=this.onChange(this.props.attr,parseInt(e,10)||0);t instanceof Promise&&t.catch((t=>{console.error(`Cannot set value for ${this.props.attr}: ${t}`)}))}}))},placeholder:this.getText(this.props.schema.placeholder),label:this.getText(this.props.schema.label),helperText:t&&"string"===typeof t?t:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)})}};const qt=class extends g{componentDidMount(){super.componentDidMount();const t=g.getValue(this.props.data,this.props.attr);this.props.oContext.socket.getEnums("rooms").then((e=>{const s=Object.keys(e).map((t=>({value:this.props.schema.short?t.replace("enum.rooms.",""):t,label:this.getText(e[t].common.name),obj:e[t]})));!1!==this.props.schema.allowDeactivate&&s.unshift({label:c.I18n.t(g.NONE_LABEL),value:g.NONE_VALUE}),this.setState({value:t,selectOptions:s})})).catch((t=>console.error(`Cannot get enums: ${t}`)))}renderItem(t,e){if(!this.state.selectOptions)return null;const s=this.state.selectOptions.find((t=>t.value===this.state.value));return(0,d.jsxs)(h.FormControl,{variant:"standard",fullWidth:!0,children:[this.props.schema.label?(0,d.jsx)(h.InputLabel,{children:this.getText(this.props.schema.label)}):null,(0,d.jsx)(h.Select,{variant:"standard",error:!!t,disabled:!!e,value:this.state.value||"_",renderValue:()=>s?s.obj?(0,d.jsx)(c.TextWithIcon,{value:s.obj,themeType:this.props.oContext.themeType,lang:c.I18n.getLanguage()}):s.label:"",onChange:t=>{this.setState({value:"_"===t.target.value?"":t.target.value},(()=>this.onChange(this.props.attr,this.state.value)))},children:this.state.selectOptions.map((t=>(0,d.jsx)(h.MenuItem,{value:t.value,style:t.value===g.DIFFERENT_VALUE?{opacity:.5}:{},children:t.obj?(0,d.jsx)(c.TextWithIcon,{value:t.obj,themeType:this.props.oContext.themeType,lang:c.I18n.getLanguage()}):t.label},t.value)))}),this.props.schema.help?(0,d.jsx)(h.FormHelperText,{children:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)}):null]})}},Kt={fullWidth:{width:"100%"},noMargin:{"&>div":{marginTop:0}}};const Gt=class extends g{constructor(){super(...arguments),this.initialValue=""}componentDidMount(){super.componentDidMount();const t=g.getValue(this.props.data,this.props.attr),e=[];(this.props.schema.options||[]).forEach((t=>{const s=t;Array.isArray(s.items)?(e.push({label:this.getText(t.label),value:t.value,group:!0}),s.items.forEach((t=>e.push({label:this.getText(t.label),value:t.value,hidden:t.hidden})))):e.push({label:this.getText(t.label),value:t.value,hidden:t.hidden})})),Array.isArray(t)?(this.initialValue=[...t],e.unshift({label:c.I18n.t(g.DIFFERENT_LABEL),value:g.DIFFERENT_VALUE}),this.setState({value:g.DIFFERENT_VALUE,selectOptions:e})):this.setState({value:t,selectOptions:e})}renderItem(t,e){if(!this.state.selectOptions)return null;const s=(this.state.selectOptions||[]).filter((t=>!t.hidden||(this.props.custom?!this.executeCustom(t.hidden,this.props.data,this.props.customObj,this.props.oContext.instanceObj,this.props.arrayIndex,this.props.globalData):!this.execute(t.hidden,this.props.schema.default,this.props.data,this.props.arrayIndex,this.props.globalData)))),i=s.find((t=>t.value==this.state.value));return(0,d.jsxs)(h.FormControl,{variant:"standard",fullWidth:!0,sx:void 0!==this.props.table&&Kt.noMargin,id:`jsonSelect_${this.props.attr}_${this.props.index||0===this.props.index?this.props.index:""}`,children:[this.props.schema.label?(0,d.jsx)(h.InputLabel,{children:this.getText(this.props.schema.label)}):null,(0,d.jsx)(h.Select,{variant:"standard",error:!!t,disabled:!!e,value:this.state.value||"_",renderValue:()=>this.getText(null===i||void 0===i?void 0:i.label,this.props.schema.noTranslation),onChange:t=>{this.setState({value:"_"===t.target.value?"":t.target.value},(()=>{let t;t=this.state.value===g.DIFFERENT_VALUE?this.onChange(this.props.attr,this.initialValue):this.onChange(this.props.attr,this.state.value),t instanceof Promise&&t.catch((t=>console.error(t)))}))},children:s.map(((t,e)=>t.group?(0,d.jsx)(h.ListSubheader,{children:this.getText(t.label,this.props.schema.noTranslation)},e):(0,d.jsx)(h.MenuItem,{value:t.value,style:t.value===g.DIFFERENT_VALUE?{opacity:.5}:{},children:this.getText(t.label,this.props.schema.noTranslation)},e)))}),this.props.schema.help?(0,d.jsx)(h.FormHelperText,{children:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)}):null]})}},Yt={menuPaper:{maxHeight:800}};const Zt=class extends g{constructor(){super(...arguments),this.initialized=!1,this.localContext=void 0}askInstance(){if(this.props.alive){let t=this.props.schema.data;if(void 0===t&&this.props.schema.jsonData){const e=this.getPattern(this.props.schema.jsonData,null,!0);try{t=JSON.parse(e)}catch{console.error(`Cannot parse json data: ${e}`)}}void 0===t&&(t=null),this.setState({running:!0},(()=>{this.props.oContext.socket.sendTo(`${this.props.oContext.adapterName}.${this.props.oContext.instance}`,this.props.schema.command||"send",t).then((t=>this.setState({list:t,running:!1}))).catch((t=>{console.error(`Cannot send command: ${t}`)}))}))}else{const t=g.getValue(this.props.data,this.props.attr);this.setState({value:t,running:!1})}}getContext(){const t={};return Array.isArray(this.props.schema.alsoDependsOn)&&this.props.schema.alsoDependsOn.forEach((e=>t[e]=g.getValue(this.props.data,e))),JSON.stringify(t)}_getValue(){let t=null===this.state.value||void 0===this.state.value?g.getValue(this.props.data,this.props.attr):this.state.value;return this.props.schema.multiple&&("string"===typeof t?t=[t]:null!==t&&void 0!==t||(t=[])),t}renderItem(t,e){var s;if(this.props.alive){const t=this.getContext();t===this.localContext&&this.initialized||(this.localContext=t,setTimeout((()=>this.askInstance()),this.initialized?300:50),this.initialized=!0)}const i=this._getValue();if(!this.props.alive||!this.state.running&&(null===(s=this.state.list)||void 0===s||!s.length))return this.props.schema.multiple||!1===this.props.schema.manual?c.I18n.t("ra_Cannot retrieve options, as instance is offline"):(0,d.jsx)(h.TextField,{variant:"standard",fullWidth:!0,value:i,error:!!t,disabled:!!e,onChange:t=>{const e=t.target.value;this.setState({value:e},(()=>this.onChange(this.props.attr,(e||"").trim())))},placeholder:this.getText(this.props.schema.placeholder),label:this.getText(this.props.schema.label),helperText:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation),slotProps:{input:{endAdornment:this.state.value&&!this.props.schema.noClearButton?(0,d.jsx)(h.InputAdornment,{position:"end",children:(0,d.jsx)(h.IconButton,{size:"small",onClick:()=>this.setState({value:""},(()=>this.onChange(this.props.attr,""))),children:(0,d.jsx)(p.Close,{})})}):null}}});if(this.state.running)return(0,d.jsx)(h.CircularProgress,{size:"24"});const o=this.state.list.filter((t=>!t.hidden||(this.props.custom?!this.executeCustom(t.hidden,this.props.data,this.props.customObj,this.props.oContext.instanceObj,this.props.arrayIndex,this.props.globalData):!this.execute(t.hidden,this.props.schema.default,this.props.data,this.props.arrayIndex,this.props.globalData)))),a=o.find((t=>t.value===i));return(0,d.jsxs)(h.FormControl,{variant:"standard",fullWidth:!0,children:[this.props.schema.label?(0,d.jsx)(h.InputLabel,{children:this.getText(this.props.schema.label)}):null,(0,d.jsx)(h.Select,{variant:"standard",error:!!t,multiple:this.props.schema.multiple,disabled:!!e,sx:{"&.MuiSelect-paper":this.props.schema.multiple?Yt.menuPaper:void 0},value:i,renderValue:t=>this.props.schema.multiple?(0,d.jsx)(h.Box,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map((t=>{const e=o.find((e=>e.value===t));if(e||!1!==this.props.schema.showAllValues){const s=(null===e||void 0===e?void 0:e.label)||t;return(0,d.jsx)(h.Chip,{label:s},t)}return null}))}):(null===a||void 0===a?void 0:a.label)||t,onChange:t=>{const e=this.onChange(this.props.attr,t.target.value);e instanceof Promise&&e.catch((t=>console.error(`Cannot set value: ${t}`)))},children:o.map(((t,e)=>(0,d.jsxs)(h.MenuItem,{value:t.value,children:[this.props.schema.multiple?(0,d.jsx)(h.Checkbox,{checked:i.includes(t.value),onClick:()=>{const e=JSON.parse(JSON.stringify(this._getValue())),s=i.indexOf(t.value);-1!==s?e.splice(s,1):(e.push(t.value),e.sort()),this.setState({value:e},(()=>this.onChange(this.props.attr,e)))}}):null,(0,d.jsx)(h.ListItemText,{primary:t.label})]},e)))}),this.props.schema.help?(0,d.jsx)(h.FormHelperText,{children:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)}):null]})}},Qt={fullWidth:{width:"100%"}};function Xt(t){return t.split(".").reduce(((t,e)=>(t<<8)+parseInt(e,10)),0)>>>0}const te=class extends g{async componentDidMount(){super.componentDidMount();let t=window.location.hostname;if(this.props.schema.openUrl){const s=await this.props.oContext.socket.getCurrentInstance(),i=await this.props.oContext.socket.getObject(`system.adapter.${s}`);if(i){var e;const s=await this.props.oContext.socket.getObject(`system.host.${null===i||void 0===i||null===(e=i.common)||void 0===e?void 0:e.host}`);if(s){const e=function(t,e){var s,i;const o=null===t||void 0===t||null===(s=t.native)||void 0===s||null===(i=s.hardware)||void 0===i?void 0:i.networkInterfaces;if(!o)return null;let a;return Object.keys(o).forEach((t=>o[t].forEach((t=>{t.internal||e.includes(":")&&"IPv6"!==t.family||e.includes(".")&&!e.match(/[^.\d]/)&&"IPv4"!==t.family||("IPv4"!==t.family||t.address.startsWith("172")||"127.0.0.0"!==e&&"localhost"!==e&&!e.match(/[^.\d]/)?a||("IPv4"===t.family&&e.includes(".")&&(Xt(e),Xt(t.netmask),Xt(t.address),Xt(t.netmask)),a=t.address):a=t.address)})))),a||Object.keys(o).forEach((t=>o[t].forEach((t=>{t.internal||e.includes(":")&&"IPv6"!==t.family||e.includes(".")&&!e.match(/[^.\d]/)&&"IPv4"!==t.family||("IPv6"!==t.family||"127.0.0.0"!==e&&"localhost"!==e&&!e.match(/[^.\d]/)?a||("IPv4"===t.family&&e.includes(".")&&(Xt(e),Xt(t.netmask),Xt(t.address),Xt(t.netmask)),a=t.address):a=t.address)})))),a||Object.keys(o).forEach((t=>{o[t].forEach((t=>{t.internal||e.includes(":")&&"IPv6"!==t.family||e.includes(".")&&!e.match(/[^.\d]/)&&"IPv4"!==t.family||("127.0.0.0"===e||"localhost"===e||e.match(/[^.\d]/),a=t.address)}))})),a||Object.keys(o).forEach((t=>{o[t].forEach((t=>{t.internal||(a=t.address)}))})),a}(s,window.location.hostname);if(!e)return void console.warn(`Cannot find suitable IP in host ${i.common.host} for ${i._id}`);t=`${e}:${window.location.port}`}}}await new Promise((e=>{this.setState({_error:"",_message:"",hostname:t},e)})),this.props.schema.onLoaded&&this._onClick()}renderErrorDialog(){return this.state._error?(0,d.jsx)(c.DialogError,{text:this.state._error,onClose:()=>this.setState({_error:""})}):null}renderMessageDialog(){return this.state._message?(0,d.jsx)(c.DialogMessage,{text:this.state._message,onClose:()=>this.setState({_message:""})}):null}_onClick(){this.props.oContext.onCommandRunning(!0),this.setState({running:!0});const t=`${window.location.protocol}//${window.location.host}${window.location.pathname.replace(/\/index\.html$/,"")}`,e=`${window.location.protocol}//${this.state.hostname.split(":").length>3?`[${this.state.hostname}]`:this.state.hostname}${window.location.pathname.replace(/\/index\.html$/,"")}`;let s,i=this.props.schema.data;if(void 0===i&&this.props.schema.jsonData){const s=this.getPattern(this.props.schema.jsonData,{_origin:t,_originIp:e,...this.props.data},!0);try{i=JSON.parse(s)}catch{console.error(`Cannot parse json data: ${s}`)}}void 0===i&&(i=null),this.props.schema.openUrl&&!i&&(i={_origin:t,_originIp:e}),this.props.schema.timeout&&(s=setTimeout((()=>{this.props.oContext.onCommandRunning(!1),this.setState({_error:c.I18n.t("ra_Request timed out"),running:!1})}),parseInt(this.props.schema.timeout,10)||1e4)),this.props.oContext.socket.sendTo(`${this.props.oContext.adapterName}.${this.props.oContext.instance}`,this.props.schema.command||"send",i).then((async t=>{if(s&&(clearTimeout(s),s=void 0),null!==t&&void 0!==t&&t.error)if(this.props.schema.error&&this.props.schema.error[t.error]){let e=this.getText(this.props.schema.error[t.error]);t.args&&t.args.forEach((t=>e=e.replace("%s",t))),this.setState({_error:e})}else this.setState({_error:t.error?c.I18n.t(t.error):c.I18n.t("ra_Error")});else{if(null!==t&&void 0!==t&&t.command)return void(this.props.oContext.onBackEndCommand&&this.props.oContext.onBackEndCommand(t.command));if(null!==t&&void 0!==t&&t.reloadBrowser&&this.props.schema.reloadBrowser)window.location.reload();else if(null!==t&&void 0!==t&&t.openUrl&&this.props.schema.openUrl)window.open(t.openUrl,t.window||this.props.schema.window||"_blank");else if(null!==t&&void 0!==t&&t.result&&this.props.schema.result&&this.props.schema.result[t.result]){let e=this.getText(this.props.schema.result[t.result]);t.args&&t.args.forEach((t=>e=e.replace("%s",t))),window.alert(e)}if(null!==t&&void 0!==t&&t.native&&this.props.schema.useNative){for(const[e,s]of Object.entries(t.native))await this.onChangeAsync(e,s);setTimeout((()=>this.props.oContext.forceUpdate(Object.keys(t.native),this.props.data)),300)}else null!==t&&void 0!==t&&t.result?window.alert("object"===typeof t.result?JSON.stringify(t.result):t.result):window.alert(c.I18n.t("ra_Ok"));null!==t&&void 0!==t&&t.saveConfig&&this.props.onChange(null,null,null,!0)}})).catch((t=>{this.props.schema.error&&this.props.schema.error[t.toString()]?this.setState({_error:this.getText(this.props.schema.error[t.toString()])}):this.setState({_error:c.I18n.t(t.toString())||c.I18n.t("ra_Error")})})).then((()=>{this.props.oContext.onCommandRunning(!1),this.setState({running:!1})}))}renderDialogConfirm(){if(!this.state.confirmDialog)return null;const t=this.state.confirmData||this.props.schema.confirm;let e=null;return"warning"===t.type?e=(0,d.jsx)(p.Warning,{}):"error"===t.type?e=(0,d.jsx)(p.Error,{}):"info"===t.type&&(e=(0,d.jsx)(p.Info,{})),(0,d.jsx)(c.DialogConfirm,{title:this.getText(t.title)||c.I18n.t("ra_Please confirm"),text:this.getText(t.text),ok:this.getText(t.ok)||c.I18n.t("ra_Ok"),cancel:this.getText(t.cancel)||c.I18n.t("ra_Cancel"),icon:e||void 0,onClose:t=>this.setState({confirmDialog:!1},(()=>t&&this._onClick()))})}renderItem(t,e){const s=this.getIcon();return(0,d.jsxs)("div",{style:Qt.fullWidth,children:[(0,d.jsxs)(h.Button,{variant:this.props.schema.variant||void 0,color:this.props.schema.color||"grey",style:{...Qt.fullWidth,...this.props.schema.controlStyle||void 0},disabled:e||!this.props.alive,startIcon:s,title:this.props.alive?this.getText(this.props.schema.title)||"":c.I18n.t("ra_Instance is not alive"),onClick:()=>{this.props.schema.confirm?this.setState({confirmDialog:!0}):this._onClick()},children:[this.props.schema.showProcess&&this.state.running?(0,d.jsx)(h.CircularProgress,{size:20,style:{marginRight:8}}):null,this.getText(this.props.schema.label,this.props.schema.noTranslation)]}),this.renderErrorDialog(),this.renderMessageDialog()]})}},ee={fullWidth:{width:"100%"},icon:{width:24,height:24,marginRight:4}};const se=class extends g{async _onClick(){let t=this.props.schema.val;if("string"===typeof t&&t.includes("${")){var e,s;t=this.getPattern(t,null,!0);const i=await this.props.oContext.socket.getObject(this.props.schema.id);"number"===(null===i||void 0===i||null===(e=i.common)||void 0===e?void 0:e.type)?t=parseFloat(t):"boolean"===(null===i||void 0===i||null===(s=i.common)||void 0===s?void 0:s.type)&&(t="true"===t||!0===t||"1"===t||1===t)}const i=(this.props.schema.id||"").replace(/%INSTANCE%/g,(this.props.oContext.instance||0).toString());try{await this.props.oContext.socket.setState(i,{val:t,ack:!!this.props.schema.ack}),this.props.schema.okText&&window.alert(this.getText(this.props.schema.okText))}catch(o){this.props.schema.error&&this.props.schema.error[o.toString()]?window.alert(this.getText(this.props.schema.error[o.toString()])):window.alert(c.I18n.t(o.toString())||c.I18n.t("ra_Error"))}}renderDialogConfirm(){if(!this.state.confirmDialog)return null;const t=this.state.confirmData||this.props.schema.confirm;let e=null;return"warning"===t.type?e=(0,d.jsx)(p.Warning,{}):"error"===t.type?e=(0,d.jsx)(p.Error,{}):"info"===t.type&&(e=(0,d.jsx)(p.Info,{})),(0,d.jsx)(c.DialogConfirm,{title:this.getText(t.title)||c.I18n.t("ra_Please confirm"),text:this.getText(t.text),ok:this.getText(t.ok)||c.I18n.t("ra_Ok"),cancel:this.getText(t.cancel)||c.I18n.t("ra_Cancel"),icon:e,onClose:t=>this.setState({confirmDialog:!1},(()=>t&&this._onClick()))})}renderItem(t,e){return(0,d.jsxs)(h.Button,{variant:this.props.schema.variant||void 0,color:this.props.schema.color||"grey",style:ee.fullWidth,disabled:e,onClick:async()=>{this.props.schema.confirm?this.setState({confirmDialog:!0}):await this._onClick()},children:[this.props.schema.icon?(0,d.jsx)(c.Icon,{src:this.props.schema.icon,style:ee.icon}):null,this.getText(this.props.schema.label,this.props.schema.noTranslation)]})}},ie={fullWidth:{width:"100%"},slider:{marginLeft:10,marginRight:10,width:"calc(100% - 20px)"}};const oe=class extends g{componentDidMount(){super.componentDidMount();const t=g.getValue(this.props.data,this.props.attr);this.setState({_value:t})}static getDerivedStateFromProps(t,e){if(void 0!==t.schema.min&&t.schema.min<0||void 0!==t.schema.max&&t.schema.max<0)return null;const s=g.getValue(t.data,t.attr);return null===s||void 0===s||s.toString()!==parseFloat(e._value).toString()?{_value:s}:null}renderItem(t,e){const s=this.props.schema.min||0,i=this.props.schema.max||100,o=this.props.schema.unit||"",a=[{value:s,label:s+o},{value:i,label:i+o}];return(0,d.jsxs)(h.Box,{style:ie.fullWidth,children:[this.props.schema.label?(0,d.jsx)(h.Typography,{gutterBottom:!0,children:this.getText(this.props.schema.label)}):null,(0,d.jsx)(h.Slider,{style:ie.slider,value:this.state._value,getAriaValueText:t=>t+o,step:this.props.schema.step||(i-s)/100,valueLabelDisplay:"auto",marks:a,min:s,max:i,disabled:!!e,onChange:t=>{const e=t.target.value;this.setState({_value:e},(()=>this.onChange(this.props.attr,e)))}}),this.props.schema.help?(0,d.jsx)(h.Typography,{children:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)}):null]})}};function ae(t,e){return"edit"===t||"rename"===t?(0,d.jsx)(p.Edit,{style:e}):"delete"===t?(0,d.jsx)(p.Delete,{style:e}):"refresh"===t?(0,d.jsx)(p.Refresh,{style:e}):"newDevice"===t||"new"===t||"add"===t?(0,d.jsx)(p.Add,{style:e}):"discover"===t||"search"===t?(0,d.jsx)(p.Search,{style:e}):"unpairDevice"===t||"unpair"===t?(0,d.jsx)(p.LinkOff,{style:e}):"pairDevice"===t||"pair"===t?(0,d.jsx)(p.Link,{style:e}):"identify"===t?(0,d.jsx)(p.NotListedLocation,{style:e}):"play"===t?(0,d.jsx)(p.PlayArrow,{style:e}):"stop"===t?(0,d.jsx)(p.Stop,{style:e}):"pause"===t?(0,d.jsx)(p.Pause,{style:e}):"forward"===t||"next"===t?(0,d.jsx)(p.FastForward,{style:e}):"rewind"===t||"previous"===t?(0,d.jsx)(p.FastRewind,{style:e}):"lamp"===t||"light"===t?(0,d.jsx)(p.Lightbulb,{style:e}):"backlight"===t?(0,d.jsx)(p.Fluorescent,{style:e}):"dimmer"===t?(0,d.jsx)(p.WbIncandescent,{style:e}):"socket"===t?(0,d.jsx)(p.Power,{style:e}):"settings"===t?(0,d.jsx)(p.Settings,{style:e}):"users"===t||"group"===t?(0,d.jsx)(p.Group,{style:e}):"user"===t?(0,d.jsx)(p.Person,{style:e}):"qrcode"===t?(0,d.jsx)(p.QrCode,{style:e}):"connection"===t?(0,d.jsx)(p.Wifi,{style:e}):"no-connection"===t?(0,d.jsx)(p.WifiOff,{style:e}):"visible"===t?(0,d.jsx)(p.Visibility,{style:e}):null}const ne=class extends g{constructor(){super(...arguments),this.controlTimeout=null,this.delayedUpdate={timer:null,value:null},this.onStateChanged=(t,e)=>{let s=e?e.val:null;"button"===this.state.controlType||"switch"===this.state.controlType?(s=!!s,this.state.stateValue!==s&&this.setState({stateValue:s})):null===s||"slider"!==this.state.controlType&&"number"!==this.state.controlType?this.state.stateValue.toString()!==s.toString()&&this.setState({stateValue:s}):(s=parseFloat(s),console.log(`${Date.now()} Received new value: ${s}`),s!==this.state.stateValue?(this.delayedUpdate.timer&&(clearTimeout(this.delayedUpdate.timer),this.delayedUpdate.timer=null),this.delayedUpdate.value=s,this.delayedUpdate.timer=setTimeout((()=>{this.setState({stateValue:this.delayedUpdate.value})}),500)):this.delayedUpdate.timer&&(clearTimeout(this.delayedUpdate.timer),this.delayedUpdate.timer=null))}}getObjectID(){return this.props.schema.foreign?this.props.schema.oid:`${this.props.schema.system?"system.adapter.":""}${this.props.oContext.adapterName}.${this.props.oContext.instance}.${this.props.schema.oid}`}async componentDidMount(){super.componentDidMount();const t=await this.props.oContext.socket.getObject(this.getObjectID()),e=this.props.schema.control||this.detectType(t),s=await this.props.oContext.socket.getState(this.getObjectID());this.setState({stateValue:s?s.val:null,controlType:e,obj:t},(async()=>{await this.props.oContext.socket.subscribeState(this.getObjectID(),this.onStateChanged)}))}componentWillUnmount(){super.componentWillUnmount(),this.props.oContext.socket.unsubscribeState(this.getObjectID(),this.onStateChanged),this.delayedUpdate.timer&&(clearTimeout(this.delayedUpdate.timer),this.delayedUpdate.timer=null),this.controlTimeout&&(clearTimeout(this.controlTimeout),this.controlTimeout=null,this.props.oContext.socket.setState(this.getObjectID(),this.state.stateValue,!1).catch((t=>console.error(`Cannot control value: ${t}`))))}detectType(t){if((t=t||{}).common=t.common||{},"boolean"===t.common.type){if(!1!==this.props.schema.controlled){if(!1===t.common.read||!0===this.props.schema.controlled)return"button";if(t.common.write||!0===this.props.schema.controlled)return"switch"}return"text"}return"number"===t.common.type&&!1!==this.props.schema.controlled?t.common.write||!0===this.props.schema.controlled?void 0!==t.common.max?"slider":"input":"text":t.common.write&&!1!==this.props.schema.controlled?"input":"text"}renderItem(t,e){if(!this.state.obj)return null;let s;if("button"===this.state.controlType){let t=null;this.props.schema.falseImage&&(t=ae(this.props.schema.falseImage));const i=this.getText(this.props.schema.falseText||this.props.schema.label,this.props.schema.noTranslation);s=!i&&t?(0,d.jsx)(h.IconButton,{style:this.props.schema.falseTextStyle,disabled:!!this.props.schema.readOnly,onClick:async()=>{this.props.schema.confirm?this.setState({confirmDialog:!0,confirmCallback:async t=>{t&&await this.props.oContext.socket.setState(this.getObjectID(),!0,!1)}}):await this.props.oContext.socket.setState(this.getObjectID(),!0,!1)},children:t}):(0,d.jsx)(h.Button,{variant:this.props.schema.variant||"contained",startIcon:t,style:this.props.schema.falseTextStyle,disabled:e||!!this.props.schema.readOnly,onClick:async()=>{this.props.schema.confirm?this.setState({confirmDialog:!0,confirmCallback:async t=>{t&&await this.props.oContext.socket.setState(this.getObjectID(),!0,!1)}}):await this.props.oContext.socket.setState(this.getObjectID(),!0,!1)},children:i||this.getObjectID().split(".").pop()})}else if("input"===this.state.controlType)s=(0,d.jsx)(h.TextField,{style:{width:"100%"},value:this.state.stateValue,variant:"standard",slotProps:{input:{endAdornment:this.getText(this.props.schema.unit,this.props.schema.noTranslation)||this.state.obj.common.unit||void 0},htmlInput:{readOnly:!!this.props.schema.readOnly}},onChange:t=>{this.setState({stateValue:t.target.value},(()=>{this.controlTimeout&&clearTimeout(this.controlTimeout),this.controlTimeout=setTimeout((async()=>{this.controlTimeout=null,await this.props.oContext.socket.setState(this.getObjectID(),this.state.stateValue,!1)}),this.props.schema.controlDelay||0)}))},label:this.getText(this.props.schema.label),helperText:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)});else if("number"===this.state.obj.common.type){const t=void 0===this.props.schema.min?this.state.obj.common.min||0:this.props.schema.min,e=void 0===this.props.schema.max?void 0===this.state.obj.common.max?100:this.state.obj.common.max:this.props.schema.max,i=void 0===this.props.schema.step?this.state.obj.common.step||1:this.props.schema.step;s=(0,d.jsx)(h.TextField,{variant:"standard",style:{width:"100%"},value:this.state.stateValue,type:"number",slotProps:{htmlInput:{min:t,max:e,step:i,readOnly:!!this.props.schema.readOnly},input:{endAdornment:this.getText(this.props.schema.unit,this.props.schema.noTranslation)||this.state.obj.common.unit||void 0}},onChange:t=>{this.setState({stateValue:t.target.value},(()=>{this.controlTimeout&&clearTimeout(this.controlTimeout),this.controlTimeout=setTimeout((async()=>{this.controlTimeout=null;const t=parseFloat(this.state.stateValue);await this.props.oContext.socket.setState(this.getObjectID(),t,!1)}),this.props.schema.controlDelay||0)}))},label:this.getText(this.props.schema.label,this.props.schema.noTranslation),helperText:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)})}else{let t;"normal"===this.props.schema.size?t=16:"large"===this.props.schema.size?t=20:"number"===typeof this.props.schema.size&&(t=this.props.schema.size);let e=this.getText(this.props.schema.label,this.props.schema.noTranslation);const a={display:"flex",alignItems:"center",fontSize:t||"1rem",gap:8};let n,r,l;if(this.props.schema.narrow||(a.width="100%",a.justifyContent="space-between"),e.trim()&&!e.trim().endsWith(":")&&this.props.schema.addColon&&(e=`${e.trim()}:`),this.props.schema.blinkOnUpdate&&(i=this.props.oContext.theme,n="string"===typeof(o=this.props.schema.blinkOnUpdate)?{"@keyframes newStateAnimationOnceColor":{"0%":{color:o},"100%":{color:"dark"===i.palette.mode?"#fff":"#000"}},animation:"newStateAnimationOnceColor 2s ease-in-out"}:{"@keyframes newStateAnimationOnce":{"0%":{color:"#00f900"},"80%":{color:"dark"===i.palette.mode?"#518851":"#008000"},"100%":{color:"dark"===i.palette.mode?"#fff":"#000"}},animation:"newStateAnimationOnce 2s ease-in-out"}),this.props.schema.labelIcon&&(r=(0,d.jsx)(c.Icon,{src:this.props.schema.labelIcon,style:{marginRight:4}})),e&&r?l=(0,d.jsxs)("div",{style:{whiteSpace:"nowrap"},children:[r,e]}):e?l=(0,d.jsx)("div",{style:{whiteSpace:"nowrap"},children:e}):r&&(l=r),"switch"===this.state.controlType){let t=null;const e=this.getText(this.props.schema.falseText,this.props.schema.noTranslation);this.props.schema.falseImage&&(t=ae(this.props.schema.falseImage,e?{marginLeft:8}:void 0));let i=null;const o=this.getText(this.props.schema.trueText,this.props.schema.noTranslation);this.props.schema.trueImage&&(i=ae(this.props.schema.trueImage,o?{marginRight:8}:void 0)),s=(0,d.jsx)(h.Switch,{checked:!!this.state.stateValue,disabled:!!this.props.schema.readOnly,onChange:async()=>{this.props.schema.confirm?this.setState({confirmDialog:!0,confirmCallback:async t=>{t&&await this.props.oContext.socket.setState(this.getObjectID(),!this.state.stateValue,!1)}}):await this.props.oContext.socket.setState(this.getObjectID(),!this.state.stateValue,!1)}}),(e||t||o||i)&&(s=(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",fontSize:14},children:[(0,d.jsxs)("span",{style:this.props.schema.falseTextStyle,children:[e,t]}),s,(0,d.jsxs)("span",{style:this.props.schema.trueTextStyle,children:[i,o]})]})),l&&(s=(0,d.jsxs)("div",{style:a,children:[l,s]}))}else if("slider"===this.state.controlType){let t=null;const e=this.getText(this.props.schema.falseText,this.props.schema.noTranslation);this.props.schema.falseImage&&(t=ae(this.props.schema.falseImage,e?{marginLeft:8}:void 0));let i=null;const o=this.getText(this.props.schema.trueText,this.props.schema.noTranslation);this.props.schema.trueImage&&(i=ae(this.props.schema.trueImage,o?{marginRight:8}:void 0));const n=void 0===this.props.schema.min?this.state.obj.common.min||0:this.props.schema.min,r=void 0===this.props.schema.max?void 0===this.state.obj.common.max?100:this.state.obj.common.max:this.props.schema.max,p=void 0===this.props.schema.step?this.state.obj.common.step||1:this.props.schema.step;s=(0,d.jsx)(h.Slider,{style:{width:"100%",flexGrow:1},min:n,max:r,disabled:!!this.props.schema.readOnly,step:p,value:this.state.stateValue,valueLabelDisplay:"auto",valueLabelFormat:t=>`${t}${this.getText(this.props.schema.unit,this.props.schema.noTranslation)||this.state.obj.common.unit||""}`,onChange:(t,e)=>{this.setState({stateValue:e},(()=>{this.controlTimeout&&clearTimeout(this.controlTimeout),this.controlTimeout=setTimeout((async()=>{console.log(`${Date.now()} Send new value: ${this.state.stateValue}`),this.controlTimeout=null,await this.props.oContext.socket.setState(this.getObjectID(),this.state.stateValue,!1)}),this.props.schema.controlDelay||0)}))}}),(e||t||o||i)&&(s=(0,d.jsxs)("div",{style:{display:"flex",width:"100%",flexGrow:1,alignItems:"center"},children:[(0,d.jsxs)("span",{style:{marginRight:16,...this.props.schema.falseTextStyle},children:[e,t]}),s,(0,d.jsxs)("span",{style:{marginLeft:16,...this.props.schema.trueTextStyle},children:[i,o]})]})),l&&(s=(0,d.jsxs)("div",{style:a,children:[l,s]}))}else if("boolean"===this.state.obj.common.type){let t,e,i=null;this.state.stateValue?(t=this.getText(this.props.schema.trueText,this.props.schema.noTranslation),this.props.schema.trueImage&&(i=ae(this.props.schema.falseImage,t?{marginRight:8}:void 0)),e=this.props.schema.trueTextStyle):(t=this.getText(this.props.schema.falseText,this.props.schema.noTranslation),this.props.schema.falseImage&&(i=ae(this.props.schema.falseImage,t?{marginLeft:8}:void 0)),e=this.props.schema.falseTextStyle),e=Object.assign(a,e),s=(0,d.jsxs)("div",{style:e,children:[l,(0,d.jsxs)(h.Box,{style:{display:"flex",alignItems:"center",gap:8},sx:n,children:[i,t||(this.state.stateValue?c.I18n.t("ra_true"):c.I18n.t("ra_false"))]},this.props.schema.blinkOnUpdate?t:void 0)]})}else{const t=this.getText(this.props.schema.unit,this.props.schema.noTranslation)||this.state.obj.common.unit;let e,i;"html"===this.state.controlType?(i=(this.state.stateValue||"").toString(),e=(0,d.jsx)("span",{dangerouslySetInnerHTML:{__html:this.state.stateValue}})):null===this.state.stateValue?(e="null",i=e):void 0===this.state.stateValue?(e="undefined",i=e):(e=this.state.stateValue.toString(),i=e),s=(0,d.jsxs)("div",{style:a,children:[l,(0,d.jsxs)("div",{style:{display:"flex",alignItems:"baseline",gap:4},children:[(0,d.jsx)(h.Box,{sx:n,children:e},this.props.schema.blinkOnUpdate?i:void 0),t?(0,d.jsx)("span",{style:{opacity:.7,fontSize:"smaller"},children:t}):null]})]})}}var i,o;return s}},re={fullWidth:t=>({width:"100%",backgroundColor:"dark"===t.palette.mode?"#FFF":"#000",borderStyle:"hidden"}),primary:t=>({backgroundColor:t.palette.primary.main}),secondary:t=>({backgroundColor:t.palette.secondary.main})};const le=class extends g{renderItem(){return(0,d.jsx)(h.Box,{component:"hr",sx:c.Utils.getStyle(this.props.oContext.theme,re.fullWidth,"primary"===this.props.schema.color?re.primary:"secondary"===this.props.schema.color?re.secondary:{backgroundColor:this.props.schema.color||("dark"===this.props.oContext.themeType?"#333":"#ddd")},{height:this.props.schema.color?this.props.schema.height||2:this.props.schema.height||1})})}},he={header:t=>({width:"100%",background:t.palette.primary.main,color:t.palette.primary.contrastText,padding:"4px !important",borderRadius:"3px",marginBlockEnd:0,marginBlockStart:0})};const pe=class extends g{renderItem(){let t="h5";switch((this.props.schema.size||5).toString()){case"1":t="h1";break;case"2":t="h2";break;case"3":t="h3";break;case"4":t="h4";break;default:t="h5"}return(0,d.jsx)(h.Box,{component:t,sx:he.header,children:this.getText(this.props.schema.label||this.props.schema.text,this.props.schema.noTranslation)})}};const ce=class extends g{renderItem(){let t=this.props.schema.src;return!t||t.startsWith(".")||t.startsWith("http")||t.startsWith(`adapter/${this.props.oContext.adapterName}/`)||t.startsWith(`./adapter/${this.props.oContext.adapterName}/`)||(t=`adapter/${this.props.oContext.adapterName}/${t}`),(0,d.jsx)("img",{src:t,style:{cursor:this.props.schema.href?"pointer":void 0,width:"100%",height:"100%"},onClick:this.props.schema.href?()=>this.props.schema.href&&window.open(this.props.schema.href,"_blank"):null,alt:""})}};function de(t,e,s){return"string"===typeof s?{"@keyframes newValueAnimationOnceColor":{"0%":{color:e?`${s} !important`:s},"100%":{color:"dark"===t.palette.mode?e?"#fff !important":"#fff":e?"#000 !important":"#000"}},animation:"newValueAnimationOnceColor 2s ease-in-out"}:{"@keyframes newValueAnimationOnce":{"0%":{color:e?"#00f900 !important":"#00f900"},"80%":{color:"dark"===t.palette.mode?e?"#518851 !important":"#518851":e?"#008000 !important":"#008000"},"100%":{color:"dark"===t.palette.mode?e?"#fff !important":"#fff":e?"#000 !important":"#000"}},animation:"newValueAnimationOnce 2s ease-in-out"}}function ue(t,e){return"string"===typeof e?{"@keyframes blinkAnimationColor":{"0%":{color:e},"100%":{color:"dark"===t.palette.mode?"#fff":"#000"}},animation:"blinkAnimationColor 2s ease-in-out infinite"}:{"@keyframes blinkAnimation":{"0%":{color:"#00f900"},"80%":{color:"dark"===t.palette.mode?"#518851":"#008000"},"100%":{color:"dark"===t.palette.mode?"#fff":"#000"}},animation:"blinkAnimation 2s ease-in-out infinite"}}const me={label:{fontWeight:"bold",whiteSpace:"nowrap"},valueImage:{maxHeight:"100%"},valueAndUnit:{display:"flex",gap:4,alignItems:"baseline"},value:{},unit:{fontSize:"smaller",opacity:.7}};const ge=class extends g{renderItem(t){let e,s=this.getText(this.props.schema.text||this.props.schema.label,this.props.schema.noTranslation);this.props.schema.addColon&&"string"===typeof s&&!s.trim().endsWith(":")&&(s=`${s.trim()}:`),s&&(s.includes("<a ")||s.includes("<br")||s.includes("<b>")||s.includes("<i>"))&&(s=c.Utils.renderTextWithA(s)),"normal"===this.props.schema.size?e=16:"large"===this.props.schema.size?e=20:"number"===typeof this.props.schema.size&&(e=this.props.schema.size);const i={width:"100%",height:"100%",display:"flex",alignItems:"center",position:"relative",fontSize:e};let o,a;this.props.schema.narrow?i.gap=8:i.justifyContent="space-between",this.props.schema.data&&"object"===typeof this.props.schema.data&&this.props.schema.data.en?a=this.getText(this.props.schema.data):"object"===typeof this.props.schema.data||void 0===this.props.schema.data||null===this.props.schema.data?a=JSON.stringify(this.props.schema.data):"number"===typeof this.props.schema.data?(a=this.props.schema.data.toString(),this.props.oContext.isFloatComma&&(a=a.replace(".",","))):this.props.schema.booleanAsCheckbox&&"boolean"===typeof this.props.schema.data||(a=this.props.schema.data.toString());let n,r,l=!1;if(this.props.schema.booleanAsCheckbox&&"boolean"===typeof this.props.schema.data)o=(0,d.jsx)(h.Checkbox,{checked:!!o,disabled:!0,size:"small"===this.props.schema.size?"small":"large"===this.props.schema.size?"large":void 0});else if(a.startsWith("data:image/"))o=(0,d.jsx)("div",{style:{...me.value,...me.valueImage,...this.props.schema.styleValue||void 0},children:(0,d.jsx)(c.Icon,{src:a})});else{const t={...me.value,...this.props.schema.styleValue||void 0};this.props.schema.html?o=(0,d.jsx)("div",{style:t,dangerouslySetInnerHTML:{__html:a}}):Array.isArray(this.props.schema.data)?(l=!0,o=(0,d.jsx)("div",{style:t,children:this.props.schema.data.map(((t,e)=>(0,d.jsx)("div",{children:"object"===typeof t||null===t||void 0===t?JSON.stringify(t):t},e)))})):a.includes("\n")?(l=!0,o=(0,d.jsx)("div",{style:t,children:c.Utils.renderTextWithA(a)})):o=(0,d.jsx)("div",{style:t,children:a})}if(this.props.schema.blinkOnUpdate&&this.props.schema.blink){const t=de(this.props.oContext.theme,!0,this.props.schema.blinkOnUpdate),e=ue(this.props.oContext.theme,this.props.schema.blink);o=(0,d.jsx)(h.Box,{sx:{...t,...e},children:o},a)}else if(this.props.schema.blinkOnUpdate){const t=de(this.props.oContext.theme,!1,this.props.schema.blinkOnUpdate);o=(0,d.jsx)(h.Box,{sx:t,children:o},a)}else if(this.props.schema.blink){const t=ue(this.props.oContext.theme,this.props.schema.blink);o=(0,d.jsx)(h.Box,{sx:t,children:o})}this.props.schema.unit&&(o=(0,d.jsxs)("div",{style:me.valueAndUnit,children:[o,(0,d.jsx)("div",{style:{...me.unit,...this.props.schema.styleUnit||void 0},children:this.getText(this.props.schema.unit)})]})),this.props.schema.labelIcon&&(n=(0,d.jsx)(c.Icon,{src:this.props.schema.labelIcon,style:{marginRight:4}})),this.props.schema.copyToClipboard&&(r=(0,d.jsx)(p.ContentCopy,{className:"staticCopyButton",style:{position:"absolute",top:"calc(50% - 12px)",right:0,cursor:"pointer"},onClick:()=>{c.Utils.copyToClipboard(a),window.alert(c.I18n.t("ra_Copied"))}}));const u={"& .staticCopyButton":{display:"none"},"& .staticCopyButton:action":{transform:"scale(0.9)"},"&:hover .staticCopyButton":{display:"block"}};return this.props.schema.highlight&&(u["&:hover"]={backgroundColor:"dark"===this.props.oContext.themeType?"#51515180":"#b8b8b880"}),l&&(i.alignItems="top"),(0,d.jsxs)(h.Box,{component:"div",style:i,sx:u,children:[(0,d.jsxs)("div",{style:{...me.label,...this.props.schema.styleLabel||void 0},children:[n,s]}),o,r]})}},xe={fullWidth:{height:"100%",width:"100%"},link:t=>({textDecoration:"underline",color:"dark"===t.palette.mode?"#4dabf5":"#254e72",cursor:"pointer"})};function ve(t,e,s){let i,o="";t?t.toString().startsWith("#")||t.toString().startsWith("/")?(i=e||"_self",o=t):t.startsWith("http://")||t.startsWith("https://")?(i=e||"_blank",o=t):(o=`#tab-instances/config/${s}/${t}`,i=e||"_self"):(o=`#tab-instances/config/${s}`,i=e||"_self"),"_self"===i?setTimeout((t=>{t.startsWith("#")?window.location.hash=t:t.startsWith("/")?o=`${window.location.protocol}:${window.location.host}${o}`:(t.startsWith("http://")||t.startsWith("https://"))&&(window.location.href=t)}),100,o):(o.startsWith("#")?o=`${window.location.protocol}:${window.location.host}${window.location.pathname}${o}`:o.startsWith("/")&&(o=`${window.location.protocol}:${window.location.host}${o}`),window.open(o,i))}const fe=class extends g{renderItem(t,e){if(this.props.schema.button){const t=this.getIcon();return(0,d.jsx)(h.Button,{variant:this.props.schema.variant||void 0,color:this.props.schema.color||"grey",style:{...xe.fullWidth,...this.props.schema.controlStyle||void 0},disabled:e,startIcon:t,onClick:this.props.schema.href?()=>{const t=this.props.schema.href?this.getText(this.props.schema.href,!0):null;t&&(this.props.oContext.onBackEndCommand?this.props.oContext.onBackEndCommand({command:"link",url:t,target:this.props.schema.target,close:this.props.schema.close}):ve(t,this.props.schema.target,`${this.props.oContext.adapterName}.${this.props.oContext.instance}`))}:null,children:this.getText(this.props.schema.text||this.props.schema.label,this.props.schema.noTranslation)})}let s=this.getText(this.props.schema.text||this.props.schema.label,this.props.schema.noTranslation);return s&&(s.includes("<a ")||s.includes("<br")||s.includes("<b>")||s.includes("<i>"))&&(s=c.Utils.renderTextWithA(s)),(0,d.jsx)(h.Box,{component:"span",style:{...this.props.schema.controlStyle||void 0},sx:this.props.schema.href?xe.link:void 0,onClick:this.props.schema.href?()=>{const t=this.props.schema.href?this.getText(this.props.schema.href,!0):null;t&&(this.props.oContext.onBackEndCommand?this.props.oContext.onBackEndCommand({command:"link",url:t,target:this.props.schema.target||"_blank",close:this.props.schema.close}):ve(t,this.props.schema.target||"_blank",`${this.props.oContext.adapterName}.${this.props.oContext.instance}`))}:null,children:s})}},ye=1048576,be={fullWidth:{width:"100%"},root:{width:"100%"},paper:{width:"100%",marginBottom:16,backgroundColor:"rgba(255, 255, 255, 0.1)"},headerText:{width:"100%"},table:{minWidth:750},visuallyHidden:{border:0,clip:"rect(0 0 0 0)",height:1,margin:-1,overflow:"hidden",padding:0,position:"absolute",top:20,width:1},label:{display:"flex",justifyContent:"space-between"},title:{flex:"1 1 100%"},rootTool:{paddingLeft:16,paddingRight:8},silver:{opacity:.2},flex:{display:"flex",alignItems:"baseline"},filteredOut:{padding:10,display:"flex",textAlign:"center"},buttonEmpty:{width:34,display:"inline-block"},buttonCell:{whiteSpace:"nowrap"},dropZone:{width:"100%",height:100,position:"relative"},dropZoneEmpty:{},uploadDiv:{position:"relative",width:"100%",minHeight:300,opacity:.9,marginTop:30,cursor:"pointer",outline:"none"},uploadDivDragging:{opacity:1,background:"rgba(128,255,128,0.1)"},image:{objectFit:"contain",margin:"auto",display:"flex",width:"100%",height:"100%"},uploadCenterDiv:{margin:5,border:"3px dashed grey",borderRadius:5,width:"calc(100% - 10px)",height:"calc(100% - 10px)",minHeight:300,position:"relative",display:"flex"},uploadCenterIcon:{paddingTop:10,width:48,height:48},uploadCenterText:{fontSize:16},uploadCenterTextAndIcon:{textAlign:"center",position:"absolute",top:0,bottom:0,left:0,right:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},buttonRemoveWrapper:{position:"absolute",zIndex:222,right:0},error:{border:"2px solid red",boxSizing:"border-box"},tooltip:{pointerEvents:"none"}};function Ce(t,e,s){e=e||"key";const i={};return t.forEach((t=>{let o=t[e];null!==o&&void 0!==o||(o=""),delete t[e],i[o]=s?t[s]:t})),i}class je extends g{constructor(t){var e;super(t),e=this,this.filterRefs=void 0,this.typingTimer=null,this.secret="Zgfr56gFe87jJOM",this.handleRequestSort=function(t){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{order:i,orderBy:o}=e.state;if(o){const a=s?i:o===t&&"asc"===i?"desc":"asc",n=e.stableSort(a,t);e.setState({order:a,orderBy:t,iteration:e.state.iteration+1e4},(()=>e.applyFilter(!1,n)))}},this.stableSort=(t,e)=>{const{value:s}=this.state,i=je.getComparator(t,e),o=s.map(((t,e)=>({el:t,index:e})));return o.sort(((t,e)=>{const s=i(t.el,e.el);return 0!==s?s:t.index-e.index})),o.map((t=>t.el))},this.onDelete=t=>()=>{const e=JSON.parse(JSON.stringify(this.state.value));e.splice(t,1),this.setState({value:e,iteration:this.state.iteration+1e4},(()=>this.applyFilter(!1,null,(()=>this.onChangeWrapper(e)))))},this.onClone=t=>()=>{const e=JSON.parse(JSON.stringify(this.state.value)),s=JSON.parse(JSON.stringify(e[t]));if("string"===typeof this.props.schema.clone&&"string"===typeof s[this.props.schema.clone]){let t=1,i=s[this.props.schema.clone];const o=i.match(/(\d+)$/);for(o?(i=i.replace(o[0],""),t=parseInt(o[0],10)+1):i+="_";e.find((e=>e[this.props.schema.clone]===i+t.toString()));)t++;s[this.props.schema.clone]=`${s[this.props.schema.clone]}_${t}`}e.splice(t,0,s),this.setState({value:e,iteration:this.state.iteration+1e4},(()=>this.applyFilter(!1,null,(()=>this.onChangeWrapper(e)))))},this.onChangeWrapper=(t,e)=>{this.typingTimer&&clearTimeout(this.typingTimer),this.typingTimer=setTimeout(((t,e)=>{let s;if(this.typingTimer=null,this.props.schema.encryptedAttributes){const e=JSON.parse(JSON.stringify(t));if(e.forEach((t=>{this.props.schema.encryptedAttributes.forEach((e=>{t[e]&&(t[e]=function(t,e){let s="";for(let i=0;i<e.length;i++)s+=String.fromCharCode(t[i%t.length].charCodeAt(0)^e.charCodeAt(i));return s}(this.secret,t[e]))}))})),this.props.schema.objKeyName){const t=Ce(e,this.props.schema.objKeyName,this.props.schema.objValueName);s=this.onChange(this.props.attr,t)}else s=this.onChange(this.props.attr,e)}else if(this.props.schema.objKeyName){const e=Ce(JSON.parse(JSON.stringify(t)),this.props.schema.objKeyName,this.props.schema.objValueName);s=this.onChange(this.props.attr,e)}else s=this.onChange(this.props.attr,t);s instanceof Promise&&s.catch((t=>console.error(`Cannot save: ${t}`))),e&&(this.applyFilter(!1,t),this.handleRequestSort(this.state.orderBy,!0))}),300,t,e)},this.onAdd=()=>{var t;const{schema:e}=this.props,s=JSON.parse(JSON.stringify(this.state.value)),i=null===(t=e.items)||void 0===t?void 0:t.reduce(((t,e)=>{let i;return i=e.defaultFunc?this.props.custom?e.defaultFunc?this.executeCustom(e.defaultFunc,this.props.data,this.props.customObj,this.props.oContext.instanceObj,s.length,this.props.data):this.props.schema.default:e.defaultFunc?this.execute(e.defaultFunc,this.props.schema.default,this.props.data,s.length,this.props.data):this.props.schema.default:void 0===e.default?null:e.default,t[e.attr]=i,t}),{});s.push(i),this.setState({value:s},(()=>this.applyFilter(!1,null,(()=>this.onChangeWrapper(s)))))},this.applyFilter=(t,e,s)=>{let i=(e=e||this.state.value).map(((t,e)=>e));Object.keys(this.filterRefs).forEach((s=>{let o=je.getFilterValue(this.filterRefs[s]);!t&&o?(o=o.toLowerCase(),i=i.filter((t=>e[t]&&e[t][s]&&e[t][s].toLowerCase().includes(o)))):this.filterRefs[s].current&&je.setFilterValue(this.filterRefs[s],"")})),i.length===e.length&&(i=null),(null!==i||null!==this.state.visibleValue)&&JSON.stringify(i)!==JSON.stringify(this.state.visibleValue)?this.setState({visibleValue:i},(()=>s&&s())):s&&s()},this.filterRefs={},this.props.schema.items=this.props.schema.items||[],this.props.schema.items.forEach((t=>{t.filter&&(this.filterRefs[t.attr]=(0,i.createRef)())}))}async componentDidMount(){super.componentDidMount();const t=g.getValue(this.props.data,this.props.attr)||[];let e;if(e=this.props.schema.objKeyName?function(t,e,s){e=e||"key";const i=[];return Object.keys(t).forEach((o=>{const a={};a[e]=o,s?(a[s]=t[o],i.push(a)):i.push(Object.assign(a,t[o]))})),i}(t,this.props.schema.objKeyName,this.props.schema.objValueName):t,Array.isArray(e)||(e=[]),this.props.schema.encryptedAttributes){const e=await this.props.oContext.socket.getCompactSystemConfig();this.secret=(null===e||void 0===e?void 0:e.native.secret)||this.secret,t.forEach((t=>{this.props.schema.encryptedAttributes.forEach((e=>{t[e]&&(t[e]=function(t,e){let s="";for(let i=0;i<e.length;i++)s+=String.fromCharCode(t[i%t.length].charCodeAt(0)^e.charCodeAt(i));return s}(this.secret,t[e]))}))}))}this.setState({value:e,visibleValue:null,orderBy:"",order:"asc",iteration:0,filterOn:[]},(()=>this.validateUniqueProps()))}componentWillUnmount(){this.typingTimer&&(clearTimeout(this.typingTimer),this.typingTimer=null),super.componentWillUnmount()}itemTable(t,e,s){const{schema:i}=this.props,o=i.items&&i.items.find((e=>e.attr===t));if(!o)return null;const a={items:{[t]:o}};return(0,d.jsx)(Ae,{oContext:this.props.oContext,alive:this.props.alive,arrayIndex:s,changed:this.props.changed,common:this.props.common,custom:!0,data:e,globalData:this.props.data,index:s+this.state.iteration,onChange:(t,e)=>{const i=JSON.parse(JSON.stringify(this.state.value));i[s][t]=e,this.setState({value:i},(()=>{this.validateUniqueProps(),this.onChangeWrapper(i,!0)}))},onError:(t,e)=>this.onError(t,e),originalData:this.props.originalData,schema:a,table:!0,themeName:this.props.themeName})}validateUniqueProps(){if(this.props.schema.uniqueColumns)for(const t of this.props.schema.uniqueColumns){const e=[];this.state.value.find((s=>{const i=s[t];return e.includes(i)?(this.onError(t,"is not unique"),this.setState({errorMessage:c.I18n.t('Non-allowed duplicate entry "%s" in column "%s"',i,t)}),!0):(e.push(i),!1)}))||(this.onError(t,null),this.setState({errorMessage:""}))}}static descendingComparator(t,e,s){return e[s]<t[s]?-1:e[s]>t[s]?1:0}static getComparator(t,e){return"desc"===t?(t,s)=>je.descendingComparator(t,s,e):(t,s)=>-je.descendingComparator(t,s,e)}static getFilterValue(t){var e,s,i;return null===t||void 0===t||null===(e=t.current)||void 0===e||null===(s=e.children[0])||void 0===s||null===(i=s.children[0])||void 0===i?void 0:i.value}static setFilterValue(t,e){return t.current.children[0].children[0].value=e}enhancedTableHead(t,e){const{schema:s}=this.props,{order:i,orderBy:o}=this.state;return(0,d.jsx)(h.TableHead,{children:(0,d.jsxs)(h.TableRow,{children:[s.items&&s.items.map(((t,a)=>(0,d.jsx)(h.TableCell,{style:{width:("string"===typeof t.width&&t.width.endsWith("%"),t.width)},align:"left",sortDirection:o===t.attr&&i,children:(0,d.jsxs)("div",{style:{...be.flex,...s.showFirstAddOnTop?{flexDirection:"column"}:void 0},children:[a||s.noDelete?null:(0,d.jsx)(h.Tooltip,{title:e?c.I18n.t("ra_Cannot add items with set filter"):c.I18n.t("ra_Add row"),slotProps:{popper:{sx:be.tooltip}},children:(0,d.jsx)("span",{children:(0,d.jsx)(h.IconButton,{size:"small",color:"primary",disabled:!!e&&!this.props.schema.allowAddByFilter,onClick:this.onAdd,children:(0,d.jsx)(p.Add,{})})})}),t.sort&&(0,d.jsx)(h.TableSortLabel,{active:!0,style:o!==t.attr?be.silver:void 0,direction:o===t.attr?i:"asc",onClick:()=>this.handleRequestSort(t.attr)}),t.filter&&this.state.filterOn.includes(t.attr)?(0,d.jsx)(h.TextField,{variant:"standard",ref:this.filterRefs[t.attr],onChange:()=>this.applyFilter(),title:c.I18n.t("ra_You can filter entries by entering here some text"),slotProps:{input:{endAdornment:je.getFilterValue(this.filterRefs[t.attr])&&(0,d.jsx)(h.InputAdornment,{position:"end",children:(0,d.jsx)(h.IconButton,{size:"small",onClick:()=>{je.setFilterValue(this.filterRefs[t.attr],""),this.applyFilter()},children:(0,d.jsx)(p.Close,{})})})}},fullWidth:!0,placeholder:this.getText(t.title)}):(0,d.jsx)("span",{style:be.headerText,children:this.getText(t.title)}),t.filter?(0,d.jsx)(h.IconButton,{title:c.I18n.t("ra_Show/hide filter input"),size:"small",onClick:()=>{const e=[...this.state.filterOn],s=this.state.filterOn.indexOf(t.attr);-1===s?e.push(t.attr):e.splice(s,1),this.setState({filterOn:e},(()=>{s&&je.getFilterValue(this.filterRefs[t.attr])&&(je.setFilterValue(this.filterRefs[t.attr],""),this.applyFilter())}))},children:this.state.filterOn.includes(t.attr)?(0,d.jsx)(p.FilterAltOff,{}):(0,d.jsx)(p.FilterAlt,{})}):null]})},`${t.attr}_${a}`))),!s.noDelete&&(0,d.jsxs)(h.TableCell,{style:{paddingLeft:20,paddingRight:20,width:t,textAlign:"right"},padding:"checkbox",children:[s.import?(0,d.jsx)(h.IconButton,{style:{marginRight:10},size:"small",onClick:()=>this.setState({showImportDialog:!0}),title:c.I18n.t("ra_import data from %s file","CSV"),children:(0,d.jsx)(p.UploadFile,{})}):null,s.export?(0,d.jsx)(h.IconButton,{style:{marginRight:10},size:"small",onClick:()=>this.onExport(),title:c.I18n.t("ra_Export data to %s file","CSV"),children:(0,d.jsx)(p.Download,{})}):null,(0,d.jsx)(h.IconButton,{disabled:!0,size:"small",children:(0,d.jsx)(p.Delete,{})})]})]})})}onExport(){const{schema:t}=this.props,{value:e}=this.state,s=[t.items.map((t=>t.attr)).join(";")];e.forEach((e=>{const i=[];t.items.forEach((t=>{var s;null!==(s=e[t.attr])&&void 0!==s&&s.includes(";")?i.push(`"${e[t.attr]}"`):i.push(void 0===e[t.attr]||null===e[t.attr]?"":e[t.attr])})),s.push(i.join(";"))}));const i=document.createElement("a");i.setAttribute("href",`data:text/csv;charset=utf-8,${encodeURIComponent(s.join("\n"))}`);const o=new Date;i.setAttribute("download",`${o.getFullYear()}_${(o.getMonth()+1).toString().padStart(2,"0")}_${o.getDate().toString().padStart(2,"0")}_${this.props.oContext.adapterName}.${this.props.oContext.instance}_${this.props.attr}.csv`),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)}onImport(t){const e=t.split("\n").map((t=>t.replace("\r","").trim())),{schema:s}=this.props,i=e.shift().split(";").filter((t=>t&&s.items.find((e=>e.attr===t)))),o=[];var a;(e.forEach((t=>{const e=t.split(";"),s={};for(let o=0;o<e.length;o++){let t=e[o];if(t.startsWith('"')){for(t=t.substring(1);o<e.length&&!t.endsWith('"');)t+=`;${e[++o]}`;t=t.substring(0,t.length-1)}let a=t;if("true"===t)a=!0;else if("false"===t)a=!1;else if(window.isFinite(t)){const e=this.props.schema.items.find((t=>t.attr===i[o]));a=e&&"number"===e.type?parseFloat(t):t}else a=t;s[i[o]]=a}o.push(s)})),o.length)?null!==(a=this.state.value)&&void 0!==a&&a.length?this.setState({showTypeOfImportDialog:o,showImportDialog:!1}):this.setState({value:o,showImportDialog:!1}):window.alert("ra_No data found in file")}isAnyFilterSet(){return!!Object.keys(this.filterRefs).find((t=>je.getFilterValue(this.filterRefs[t])))}onMoveUp(t){const e=JSON.parse(JSON.stringify(this.state.value)),s=e[t];e.splice(t,1),e.splice(t-1,0,s),this.setState({value:e,iteration:this.state.iteration+1e4},(()=>this.applyFilter(!1,null,(()=>this.onChangeWrapper(e)))))}onMoveDown(t){const e=JSON.parse(JSON.stringify(this.state.value)),s=e[t];e.splice(t,1),e.splice(t+1,0,s),this.setState({value:e,iteration:this.state.iteration+1e4},(()=>this.applyFilter(!1,null,(()=>this.onChangeWrapper(e)))))}onDrop(t){const e=t[0],s=new FileReader;s.onabort=()=>console.log("file reading was aborted"),s.onerror=()=>console.log("file reading has failed"),s.onload=()=>{if(e.size>ye)return void window.alert(c.I18n.t("ra_File is too big. Max %sk allowed. Try use SVG.",Math.round(1024)));const t=new Uint8Array(s.result).reduce(((t,e)=>t+String.fromCharCode(e)),"");this.onImport(t)},s.readAsArrayBuffer(e)}showTypeOfImportDialog(){return this.state.showTypeOfImportDialog?(0,d.jsxs)(h.Dialog,{open:!0,onClose:()=>this.setState({showTypeOfImportDialog:!1}),maxWidth:"md",children:[(0,d.jsx)(h.DialogTitle,{children:c.I18n.t("ra_Append or replace?")}),(0,d.jsx)(h.DialogContent,{children:c.I18n.t("ra_Append %s entries or replace existing?",this.state.showTypeOfImportDialog.length)}),(0,d.jsxs)(h.DialogActions,{children:[(0,d.jsx)(h.Button,{variant:"contained",color:"primary",autoFocus:!0,onClick:()=>{const t=JSON.parse(JSON.stringify(this.state.value));this.state.showTypeOfImportDialog.forEach((e=>t.push(e))),this.setState({value:t,iteration:this.state.iteration+1e4,showTypeOfImportDialog:!1},(()=>this.applyFilter(!1,null,(()=>this.onChangeWrapper(t)))))},children:c.I18n.t("ra_Append")}),(0,d.jsx)(h.Button,{variant:"contained",color:"secondary",autoFocus:!0,onClick:()=>{const t=this.state.showTypeOfImportDialog;this.setState({value:t,iteration:this.state.iteration+1e4,showTypeOfImportDialog:!1},(()=>this.applyFilter(!1,null,(()=>this.onChangeWrapper(t)))))},children:c.I18n.t("ra_Replace")})]})]}):null}showImportDialog(){return this.state.showImportDialog?(0,d.jsxs)(h.Dialog,{open:!0,onClose:()=>this.setState({showImportDialog:!1}),sx:{"& .MuiDialog-paper":{minHeight:500}},maxWidth:"md",fullWidth:!0,children:[(0,d.jsx)(h.DialogTitle,{children:c.I18n.t("ra_Import from %s","CSV")}),(0,d.jsx)(h.DialogContent,{children:(0,d.jsx)(st(),{multiple:!1,accept:{"text/csv":[".csv"]},maxSize:ye,onDragEnter:()=>this.setState({uploadFile:"dragging"}),onDragLeave:()=>this.setState({uploadFile:!0}),onDrop:(t,e)=>{this.setState({uploadFile:!1}),t.length?this.onDrop(t):window.alert(e&&e[0]&&e[0].errors&&e[0].errors[0]&&e[0].errors[0].message||c.I18n.t("ra_Cannot upload"))},children:t=>{let{getRootProps:e,getInputProps:s}=t;return(0,d.jsxs)("div",{style:{...be.uploadDiv,..."dragging"===this.state.uploadFile?be.uploadDivDragging:void 0,...be.dropZone,...this.state.icon?void 0:be.dropZoneEmpty},...e(),children:[(0,d.jsx)("input",{...s()}),(0,d.jsx)("div",{style:be.uploadCenterDiv,children:(0,d.jsxs)("div",{style:be.uploadCenterTextAndIcon,children:[(0,d.jsx)(p.UploadFile,{style:be.uploadCenterIcon}),(0,d.jsx)("div",{style:be.uploadCenterText,children:"dragging"===this.state.uploadFile?c.I18n.t("ra_Drop file here"):c.I18n.t("ra_Place your files here or click here to open the browse dialog")})]})})]})}})}),(0,d.jsx)(h.DialogActions,{children:(0,d.jsx)(h.Button,{variant:"contained",onClick:()=>this.setState({showImportDialog:!1}),color:"primary",startIcon:(0,d.jsx)(p.Close,{}),children:c.I18n.t("Cancel")})})]}):null}renderItem(){const{schema:t}=this.props;let{visibleValue:e}=this.state;if(!this.state.value||!Array.isArray(this.state.value))return null;e=e||this.state.value.map(((t,e)=>e));const s=this.isAnyFilterSet();let i;return this.props.schema.compact&&(i={paddingTop:1,paddingBottom:1}),(0,d.jsxs)(h.Paper,{style:be.paper,children:[this.showImportDialog(),this.showTypeOfImportDialog(),t.label?(0,d.jsx)("div",{style:be.label,children:(0,d.jsx)(h.Toolbar,{variant:"dense",style:be.rootTool,children:(0,d.jsx)(h.Typography,{style:be.title,variant:"h6",id:"tableTitle",component:"div",children:this.getText(t.label)})})}):null,(0,d.jsxs)(h.TableContainer,{children:[(0,d.jsxs)(h.Table,{style:be.table,size:"small",children:[this.enhancedTableHead(s||this.state.orderBy?64:120,s),(0,d.jsxs)(h.TableBody,{children:[e.map(((o,a)=>(0,d.jsxs)(h.TableRow,{hover:!0,children:[t.items&&t.items.map((t=>(0,d.jsx)(h.TableCell,{align:"left",style:i,children:this.itemTable(t.attr,this.state.value[o],o)},`${t.attr}_${o}`))),!t.noDelete&&(0,d.jsxs)(h.TableCell,{align:"left",style:{...i,...be.buttonCell},children:[s||this.state.orderBy?null:a?(0,d.jsx)(h.Tooltip,{title:c.I18n.t("ra_Move up"),slotProps:{popper:{sx:be.tooltip}},children:(0,d.jsx)(h.IconButton,{size:"small",onClick:()=>this.onMoveUp(o),children:(0,d.jsx)(p.ArrowUpward,{})})}):(0,d.jsx)("div",{style:be.buttonEmpty}),s||this.state.orderBy?null:a<e.length-1?(0,d.jsx)(h.Tooltip,{title:c.I18n.t("ra_Move down"),slotProps:{popper:{sx:be.tooltip}},children:(0,d.jsx)(h.IconButton,{size:"small",onClick:()=>this.onMoveDown(o),children:(0,d.jsx)(p.ArrowDownward,{})})}):(0,d.jsx)("div",{style:be.buttonEmpty}),(0,d.jsx)(h.Tooltip,{title:c.I18n.t("ra_Delete current row"),slotProps:{popper:{sx:be.tooltip}},children:(0,d.jsx)(h.IconButton,{size:"small",onClick:this.onDelete(o),children:(0,d.jsx)(p.Delete,{})})}),this.props.schema.clone?(0,d.jsx)(h.Tooltip,{title:c.I18n.t("ra_Clone current row"),slotProps:{popper:{sx:be.tooltip}},children:(0,d.jsx)(h.IconButton,{size:"small",onClick:this.onClone(o),children:(0,d.jsx)(p.ContentCopy,{})})}):null]})]},`${o}_${a}`))),!t.noDelete&&e.length>=(t.showSecondAddAt||5)?(0,d.jsx)(h.TableRow,{children:(0,d.jsx)(h.TableCell,{colSpan:t.items.length+1,style:{...i},children:(0,d.jsx)(h.Tooltip,{title:s?c.I18n.t("ra_Cannot add items with set filter"):c.I18n.t("ra_Add row"),slotProps:{popper:{sx:be.tooltip}},children:(0,d.jsx)("span",{children:(0,d.jsx)(h.IconButton,{size:"small",color:"primary",disabled:!!s&&!this.props.schema.allowAddByFilter,onClick:this.onAdd,children:(0,d.jsx)(p.Add,{})})})})})}):null]})]}),!e.length&&this.state.value.length?(0,d.jsx)("div",{style:be.filteredOut,children:(0,d.jsxs)(h.Typography,{style:be.title,variant:"h6",id:"tableTitle",component:"div",children:[c.I18n.t("ra_All items are filtered out"),(0,d.jsx)(h.IconButton,{size:"small",onClick:()=>this.applyFilter(!0),children:(0,d.jsx)(p.Close,{})})]})}):null]}),t.help?(0,d.jsx)(h.FormHelperText,{children:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)}):null,this.state.errorMessage?(0,d.jsxs)("div",{style:{display:"flex",padding:"5px"},children:[(0,d.jsx)(p.Warning,{color:"error"}),(0,d.jsx)("span",{style:{color:"red",alignSelf:"center"},children:this.state.errorMessage})]}):null]})}}const we=je,Ie={indeterminate:{opacity:.5},label:{width:"100%",fontSize:14,marginBottom:2},helper:{width:"100%",fontSize:12},error:{width:"100%",fontSize:12,color:"#FF0000"}};const Se=class extends g{constructor(){super(...arguments),this.updateTimeout=null}componentDidMount(){super.componentDidMount();let t=g.getValue(this.props.data,this.props.attr);if(Array.isArray(t)&&this.props.oContext.multiEdit)return t=g.DIFFERENT_VALUE,void this.setState({value:t,oldValue:t,jsonError:!1});this.setState({value:t,oldValue:t,jsonError:this.validateJson(t)})}validateJson(t){let e=!1;if(this.props.schema.validateJson&&(t||!this.props.schema.allowEmpty))try{JSON.parse(t)}catch(s){console.log("Error in JSON",s),e=!0}return e}static getDerivedStateFromProps(t,e){if(t.oContext.multiEdit&&e.value===g.DIFFERENT_VALUE)return{value:g.DIFFERENT_VALUE};let s=g.getValue(t.data,t.attr);return null!==s&&void 0!==s&&(s=s.toString()),null===s||void 0===s||s!==e.value&&s!==e.oldValue?{value:s}:null}renderItem(t,e){const s=Array.isArray(this.state.value)||this.state.value===g.DIFFERENT_VALUE;if(this.props.schema.time){let s="";return"number"===typeof this.state.value?s=this.state.value&&this.state.value<9466596e5?new Date(1e3*this.state.value).toLocaleString():new Date(this.state.value).toLocaleString():"string"===typeof this.state.value&&(s=new Date(this.state.value).toLocaleString()),(0,d.jsx)(h.TextField,{variant:"standard",fullWidth:!0,value:s,error:!!t||!!this.state.jsonError,disabled:!!e,slotProps:{htmlInput:{readOnly:!0}},placeholder:this.getText(this.props.schema.placeholder),label:this.getText(this.props.schema.label),helperText:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)})}if(null!==this.state.oldValue&&void 0!==this.state.oldValue?(this.updateTimeout&&clearTimeout(this.updateTimeout),this.updateTimeout=setTimeout((()=>{this.updateTimeout=null,this.setState({oldValue:null})}),30)):this.updateTimeout&&(clearTimeout(this.updateTimeout),this.updateTimeout=null),s){const s=g.getValue(this.props.data,this.props.attr),i=(null===s||void 0===s?void 0:s.filter((t=>t||0===t)).map((t=>({label:t.toString()||"",value:t}))))||[];return i.unshift({label:c.I18n.t(g.DIFFERENT_LABEL),value:g.DIFFERENT_VALUE}),(0,d.jsx)(h.Autocomplete,{style:Ie.indeterminate,fullWidth:!0,value:i[0],onChange:(t,e)=>{const s=e?e.value:"",i=this.onChange(this.props.attr,s,(()=>{this.setState({value:s,oldValue:s,jsonError:this.validateJson(e)})}));i instanceof Promise&&i.catch((t=>console.error(`Cannot set value: ${t}`)))},options:i,getOptionLabel:t=>t.label,renderInput:s=>(0,d.jsx)(h.TextField,{variant:"standard",...s,error:!!t,placeholder:this.getText(this.props.schema.placeholder),slotProps:{htmlInput:{...s.inputProps,maxLength:this.props.schema.maxLength||this.props.schema.max||void 0,readOnly:this.props.schema.readOnly||!1}},label:this.getText(this.props.schema.label),helperText:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation),disabled:!!e})})}let i,o;if((this.props.schema.readOnly||e)&&this.props.schema.copyToClipboard?(this.props.schema.minRows>1&&(o={position:"absolute",right:3,top:20,zIndex:1e3}),i=(0,d.jsx)(h.IconButton,{style:o,size:"small",onClick:()=>{c.Utils.copyToClipboard(this.state.value),window.alert(c.I18n.t("ra_Copied"))},children:(0,d.jsx)(c.IconCopy,{})})):this.props.schema.readOnly||e||!this.state.value||this.props.schema.noClearButton||(this.props.schema.minRows>1&&(o={position:"absolute",right:3,top:20,zIndex:1e3}),i=(0,d.jsx)(h.IconButton,{style:o,size:"small",onClick:()=>this.setState({value:"",oldValue:this.state.value},(()=>this.onChange(this.props.attr,""))),children:(0,d.jsx)(p.Close,{})}),this.props.schema.minRows<=1&&(i=(0,d.jsx)(h.InputAdornment,{position:"end",children:i}))),this.props.schema.minRows>1){const s=this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation);return(0,d.jsxs)("div",{style:{width:"100%",position:"relative"},children:[this.props.schema.label?(0,d.jsx)("div",{style:Ie.label,children:this.getText(this.props.schema.label)}):null,(0,d.jsx)(h.TextareaAutosize,{style:{width:"100%",resize:"vertical",backgroundColor:"dark"===this.props.oContext.themeType?"#363636":"#cccccc",color:"dark"===this.props.oContext.themeType?"#fff":"#111"},minRows:this.props.schema.minRows,maxRows:this.props.schema.maxRows,value:null===this.state.value||void 0===this.state.value?"":this.state.value,disabled:!!e,readOnly:this.props.schema.readOnly||!1,onChange:t=>{const e=t.target.value;this.setState({value:e,oldValue:this.state.value,jsonError:this.validateJson(e)},(()=>this.onChange(this.props.attr,e||"")))},placeholder:this.getText(this.props.schema.placeholder)}),s||t||this.state.jsonError?(0,d.jsx)("div",{style:t?Ie.error:Ie.helper,children:t||(this.state.jsonError?c.I18n.t("ra_Invalid JSON"):s)}):null]})}return(0,d.jsx)(h.TextField,{variant:"standard",fullWidth:!0,value:null===this.state.value||void 0===this.state.value?"":this.state.value,error:!!t||!!this.state.jsonError,disabled:!!e,slotProps:{htmlInput:{maxLength:this.props.schema.maxLength||this.props.schema.max||void 0,readOnly:this.props.schema.readOnly||!1},input:{endAdornment:i}},onChange:t=>{const e=t.target.value;this.setState({value:e,oldValue:this.state.value,jsonError:this.validateJson(e)},(()=>this.onChange(this.props.attr,e)))},placeholder:this.getText(this.props.schema.placeholder),label:this.getText(this.props.schema.label),helperText:this.state.jsonError?c.I18n.t("ra_Invalid JSON"):this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)})}},Te={width:"100%"};const De=class extends g{constructor(){super(...arguments),this.initialized=!1,this.localContext=void 0}askInstance(){if(this.props.alive){let t=this.props.schema.data;if(void 0===t&&this.props.schema.jsonData){const e=this.getPattern(this.props.schema.jsonData,null,!0);try{t=JSON.parse(e)}catch{console.error(`Cannot parse json data: ${e}`)}}void 0===t&&(t=null),this.props.oContext.socket.sendTo(`${this.props.oContext.adapterName}.${this.props.oContext.instance}`,this.props.schema.command||"send",t).then((t=>{if("object"===typeof t){const e=t;this.setState({text:e.text||"",style:e.style,icon:e.icon,iconStyle:e.iconStyle})}else"string"===typeof t&&this.setState({text:t||""})})).catch((t=>console.error(`Cannot send command: ${t}`)))}}getLocalContext(){const t={};return Array.isArray(this.props.schema.alsoDependsOn)&&this.props.schema.alsoDependsOn.forEach((e=>t[e]=g.getValue(this.props.data,e))),JSON.stringify(t)}renderItem(){if(this.props.alive){const t=this.getLocalContext();t===this.localContext&&this.initialized||(this.localContext=t,setTimeout((()=>this.askInstance()),this.initialized?300:50),this.initialized=!0)}if(void 0===this.state.text)return null;let t=null;return this.state.icon&&(t=ae(this.state.icon,{marginRight:this.state.text?8:void 0,...this.state.iconStyle||void 0}),t||(t=(0,d.jsx)(c.Icon,{src:this.state.icon,style:{marginRight:this.state.text?8:void 0,...this.state.iconStyle||void 0}}))),"text"===this.props.schema.container?(0,d.jsx)(h.TextField,{variant:"standard",fullWidth:!0,slotProps:{input:{endAdornment:this.props.schema.copyToClipboard?(0,d.jsx)(h.IconButton,{size:"small",onClick:()=>{c.Utils.copyToClipboard(this.state.text),window.alert(c.I18n.t("ra_Copied"))},children:(0,d.jsx)(c.IconCopy,{})}):void 0}},value:this.state.text,label:this.getText(this.props.schema.label),helperText:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)}):(0,d.jsxs)("div",{style:{...Te,...this.state.style||void 0},children:[t,"html"===this.props.schema.container?(0,d.jsx)("span",{dangerouslySetInnerHTML:{__html:this.state.text||""}}):this.state.text]})}};const ke=class extends g{componentDidMount(){var t;super.componentDidMount();const e=g.getValue(this.props.data,this.props.attr);if(!e&&null!==(t=this.props.customObj)&&void 0!==t&&t._id){const t=function(t,e){let s;return s=e&&t.substring(0,e.length)===e?t.substring(e.length+1):t,s=s.replace(/\./g,"/").replace(/_/g," "),s}(this.props.customObj._id,`${this.props.oContext.adapterName}.${this.props.oContext.instance}`);this.setState({value:t})}else this.setState({value:e||""})}renderItem(t,e){return(0,d.jsx)(h.TextField,{variant:"standard",fullWidth:!0,slotProps:{htmlInput:{maxLength:this.props.schema.maxLength||this.props.schema.max||void 0}},value:this.state.value,error:!!t,disabled:e,placeholder:this.getText(this.props.schema.placeholder),label:this.getText(this.props.schema.label),helperText:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation),onChange:t=>{const e=t.target.value;this.setState({value:e},(()=>this.onChange(this.props.attr,e)))}})}};const Oe=class extends g{async componentDidMount(){var t;super.componentDidMount();const e=await this.props.oContext.socket.getObject("system.meta.uuid");this.setState({uuid:(null===e||void 0===e||null===(t=e.native)||void 0===t?void 0:t.uuid)||"unknown"})}renderItem(t,e){return(0,d.jsx)(h.TextField,{variant:"standard",fullWidth:!0,error:!!t,disabled:!!e,slotProps:{htmlInput:{readOnly:!0},input:{endAdornment:(0,d.jsx)(h.IconButton,{onClick:()=>{c.Utils.copyToClipboard(this.state.uuid),window.alert(c.I18n.t("ra_Copied %s",this.state.uuid))},children:(0,d.jsx)(p.ContentCopy,{})})}},value:this.state.uuid||"",label:this.getText(this.props.schema.label)||c.I18n.t("ra_Serial number (UUID)"),helperText:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)})}},_e={icon:{width:16,height:16,marginRight:8}};const Fe=class extends g{componentDidMount(){super.componentDidMount(),this.props.oContext.socket.getUsers().then((t=>{const e={},s=c.I18n.getLanguage();this.props.schema.short?t.forEach((t=>{var i,o;return e[t._id]={color:null===(i=t.common)||void 0===i?void 0:i.color,icon:null===(o=t.common)||void 0===o?void 0:o.icon,name:c.Utils.getObjectNameFromObj(t,s)}})):t.forEach((t=>{var i,o;return e[t._id.replace(/^system\.user\./,"")]={color:null===(i=t.common)||void 0===i?void 0:i.color,icon:null===(o=t.common)||void 0===o?void 0:o.icon,name:c.Utils.getObjectNameFromObj(t,s)}})),this.setState({users:e})})).catch((t=>console.error(`Cannot get users: ${t}`)))}renderItem(t,e){var s,i;const o=g.getValue(this.props.data,this.props.attr);return(0,d.jsxs)(h.FormControl,{variant:"standard",fullWidth:!0,children:[this.state.users&&this.props.schema.label?(0,d.jsx)(h.InputLabel,{children:this.getText(this.props.schema.label)}):null,this.state.users?(0,d.jsx)(h.Select,{variant:"standard",error:!!t,disabled:!!e,value:o,renderValue:t=>{var e,s,i;return(0,d.jsxs)("span",{children:[this.state.users&&null!==(e=this.state.users[t])&&void 0!==e&&e.icon?(0,d.jsx)(c.Icon,{src:this.state.users&&(null===(s=this.state.users[t])||void 0===s?void 0:s.icon),style:_e.icon}):null,this.state.users&&(null===(i=this.state.users[t])||void 0===i?void 0:i.name)||t||""]})},style:{color:this.state.users&&(null===(s=this.state.users[o])||void 0===s?void 0:s.color)||void 0,backgroundColor:c.Utils.getInvertedColor(this.state.users&&(null===(i=this.state.users[o])||void 0===i?void 0:i.color),this.props.oContext.themeType)},onChange:t=>this.onChange(this.props.attr,t.target.value),children:this.state.users&&Object.keys(this.state.users).map((t=>(0,d.jsxs)(h.MenuItem,{style:{color:this.state.users[t].color||void 0,backgroundColor:c.Utils.getInvertedColor(this.state.users[t].color,this.props.oContext.themeType)},value:t,children:[this.state.users[t].icon?(0,d.jsx)(c.Icon,{src:this.state.users[t].icon,style:_e.icon}):null,this.state.users[t].name]},t)))}):(0,d.jsx)(h.TextField,{variant:"standard",error:!!t,disabled:!!e,value:o,onChange:t=>this.onChange(this.props.attr,t.target.value),label:this.getText(this.props.schema.label)}),this.props.schema.help?(0,d.jsx)(h.FormHelperText,{children:this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)}):null]})}};const Ne=class extends g{async componentDidMount(){super.componentDidMount();const t=await s.e(7249).then(s.bind(s,47249));this.setState({QRCode:t.default})}renderItem(){const t=this.state.QRCode;return t?(0,d.jsx)(t,{value:this.props.schema.data,size:this.props.schema.size,fgColor:this.props.schema.fgColor,bgColor:this.props.schema.bgColor,level:this.props.schema.level}):null}},Ee={accordion:v,alive:b,autocomplete:C,autocompleteSendTo:j,certCollection:k,certificate:S,certificates:D,checkbox:N,checkLicense:F,chip:H,chips:H,color:K,coordinates:Y,cron:I,custom:Q,datePicker:class extends g{componentDidMount(){super.componentDidMount();const t=g.getValue(this.props.data,this.props.attr);this.setState({value:t})}renderItem(t,e){return(0,d.jsx)(X.DatePicker,{sx:t=>({width:"100%",borderBottom:`1px solid ${t.palette.text.primary}`,"& fieldset":{display:"none"},"& input":{padding:`${t.spacing(1.5)} 0 4px 0`},"& .MuiInputAdornment-root":{marginLeft:0,marginTop:1},"& label":{transform:"translate(0px, -9px) scale(0.75)"}}),format:this.props.oContext.systemConfig.dateFormat.toLowerCase().replace("mm","MM"),disabled:!!e,value:this.state.value,onChange:t=>{this.setState({value:t},(()=>this.onChange(this.props.attr,this.state.value)))},label:this.getText(this.props.schema.label)})}},deviceManager:tt,divider:le,file:vt,fileSelector:pt,func:ft,header:pe,image:Ct,imageSendTo:bt,instance:wt,interface:St,ip:yt,jsonEditor:Et,language:Lt,license:At,number:Pt,objectId:Ut,password:Mt,pattern:Jt,port:Ht,qrCode:Ne,room:qt,select:Gt,selectSendTo:Zt,sendto:te,sendTo:te,setState:se,slider:oe,state:ne,staticImage:ce,staticInfo:ge,staticLink:fe,staticText:fe,table:we,text:Se,textSendTo:De,timePicker:class extends g{componentDidMount(){super.componentDidMount();const t=g.getValue(this.props.data,this.props.attr);this.setState({value:t})}renderItem(t,e){const s="HH:mm:ss"!==this.props.schema.returnFormat,i=new Date(Date.parse(`Thu, 01 Jan 1970 ${this.state.value||"00:00:00"}`));return(0,d.jsx)(X.TimePicker,{sx:t=>({width:"100%",borderBottom:`1px solid ${t.palette.text.primary}`,"& fieldset":{display:"none"},"& input":{padding:`${t.spacing(1.5)} 0 4px 0`},"& .MuiInputAdornment-root":{marginLeft:0,marginTop:1},"& label":{transform:"translate(0px, -9px) scale(0.75)"}}),ampm:this.props.oContext.systemConfig.dateFormat.includes("/"),timeSteps:this.props.schema.timeSteps||this.props.schema.timesteps||{hours:1,minutes:5,seconds:5},format:this.props.schema.format||"HH:mm:ss",disabled:!!e,value:i,onChange:t=>{let e;e=t instanceof Date?t.toTimeString().split(" ")[0]:t.toTimeString(),s&&(e=e.split(":").slice(0,2).join(":")),this.setState({value:e},(()=>this.onChange(this.props.attr,this.state.value)))},views:this.props.schema.views||["hours","minutes","seconds"],label:this.getText(this.props.schema.label)})}},topic:ke,uuid:Oe,user:Fe},$e={fullWidth:{width:"100%"},paper:{margin:1,width:"auto !important",overflowY:"auto",paddingBottom:1},paperWithIcons:{height:"calc(100vh - 259px) !important"},paperWithoutIcons:{height:"calc(100vh - 235px) !important"},padding:{padding:"10px"},heading:{},primary:t=>({backgroundColor:t.palette.primary.main,color:"dark"===t.palette.mode?"inherit":"#FFF"}),secondary:t=>({backgroundColor:t.palette.secondary.main})};class Le extends g{componentDidMount(){super.componentDidMount(),this.props.schema&&this.props.schema.collapsable&&this.setState({expanded:"true"===(window._localStorage||window.localStorage).getItem(`${this.props.oContext.adapterName}.${this.props.attr}`)})}renderItems(t,e){return t?Object.keys(t).map((s=>{if(this.props.oContext.multiEdit&&t[s].noMultiEdit)return null;const i=t[s].type||"panel";let o;return"custom"===i?t[s].url?o=Q:this.props.oContext.customs&&this.props.oContext.customs[t[s].component]?o=this.props.oContext.customs[t[s].component]:(console.error(`Cannot find custom component: ${t[s].component}`),o=g):o="panel"===i?Le:Ee[i]||g,(0,d.jsx)(o,{oContext:this.props.oContext,index:this.props.index,changed:this.props.changed,arrayIndex:this.props.arrayIndex,commandRunning:this.props.commandRunning,style:$e.panel,common:this.props.common,alive:this.props.alive,themeName:this.props.themeName,data:this.props.data,originalData:this.props.originalData,onError:this.props.onError,onChange:this.props.onChange,disabled:e,customObj:this.props.customObj,custom:this.props.custom,schema:t[s],attr:s,table:this.props.table},`${s}_${void 0===this.props.index?"":this.props.index}`)})):null}render(){const t=this.props.schema;if(!t)return null;const{disabled:e,hidden:s}=this.calculate(t),i=this.props.schema.items,o=this.props.schema.style||{};if(s){if(t.hideOnlyControl){const e=(0,d.jsx)(h.Grid2,{size:{xs:t.xs||void 0,sm:t.sm||void 0,md:t.md||void 0,lg:t.lg||void 0,xl:t.xl||void 0},sx:c.Utils.getStyle(this.props.oContext.theme,{marginBottom:0,textAlign:"left"},o,"dark"===this.props.oContext.themeType&&t.darkStyle)});return t.newLine?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{style:{flexBasis:"100%",height:0}}),e]}):e}return null}if(this.props.table)return this.renderItems(i,e);if(this.props.custom)return(0,d.jsx)(h.Grid2,{container:!0,style:$e.fullWidth,columnSpacing:2,rowSpacing:1,sx:o,children:this.renderItems(i,e)},`${this.props.attr}_${this.props.index}`);let a;if(a=t.collapsable?(0,d.jsxs)(h.Accordion,{style:$e.fullWidth,expanded:!!this.state.expanded,onChange:()=>{(window._localStorage||window.localStorage).setItem(`${this.props.oContext.adapterName}.${this.props.attr}`,this.state.expanded?"false":"true"),this.setState({expanded:!this.state.expanded})},children:[(0,d.jsx)(h.AccordionSummary,{expandIcon:(0,d.jsx)(p.ExpandMore,{}),sx:c.Utils.getStyle(this.props.oContext.theme,o,this.props.oContext.themeType&&t.darkStyle,"primary"===t.color?$e.primary:"secondary"===t.color&&$e.secondary,{width:"100%"}),children:(0,d.jsx)(h.Typography,{style:$e.heading,children:this.getText(t.label)})}),(0,d.jsx)(h.AccordionDetails,{children:(0,d.jsx)(h.Grid2,{container:!0,columnSpacing:2,rowSpacing:1,sx:{...o,width:"100%",padding:"10px"},children:this.renderItems(i,e)})})]},`${this.props.attr}_${this.props.index}`):(0,d.jsx)(h.Box,{component:"div",className:this.props.className,sx:c.Utils.getStyle(this.props.oContext.theme,this.props.style,o,{width:"100%"},this.props.isParentTab&&$e.paper,this.props.isParentTab&&(this.props.withIcons?$e.paperWithIcons:$e.paperWithoutIcons)),children:(0,d.jsx)(h.Grid2,{container:!0,columnSpacing:2,rowSpacing:1,sx:c.Utils.getStyle(this.props.oContext.theme,{width:"100%"},this.props.isParentTab&&$e.padding,this.props.schema.innerStyle),children:this.renderItems(i,e)})},`${this.props.attr}_${this.props.index}`),!this.props.isParentTab){const e=(0,d.jsx)(h.Grid2,{title:this.getText(t.tooltip),size:{xs:t.xs||void 0,sm:t.sm||void 0,md:t.md||void 0,lg:t.lg||void 0,xl:t.xl||void 0},sx:{marginBottom:0,textAlign:"left",...o},children:a});return t.newLine?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{style:{flexBasis:"100%",height:0}}),e]}):e}return a}}const Ae=Le,Ve={tabs:{height:"100%",width:"100%"},panel:{width:"100%",display:"block"},panelWithIcons:{height:"calc(100% - 72px)"},panelWithoutIcons:{height:"calc(100% - 48px)"}};const Pe=class extends g{constructor(t){let e;if(super(t),this.onHashTabsChanged=()=>{const t=(window.location.hash||"").replace(/^#/,"").split("/");if(t.length>3&&"config"===t[1]){const e=t[3],s=parseInt(e,10);let i;s.toString()===e?s>=0&&s<Object.keys(this.props.schema.items).length&&(i=Object.keys(this.props.schema.items)[s]):Object.keys(this.props.schema.items).includes(e)&&(i=e),void 0!==i&&i!==this.state.tab&&((window._localStorage||window.localStorage).setItem(`${this.props.dialogName||"App"}.${this.props.oContext.adapterName}`,i),this.setState({tab:i}))}},this.props.root){const t=(window.location.hash||"").replace(/^#/,"").split("/");if(t.length>=3&&"config"===t[1]){const s=t[3],i=parseInt(s,10);s&&i.toString()===s?i>=0&&i<Object.keys(this.props.schema.items).length&&(e=Object.keys(this.props.schema.items)[i]):s&&Object.keys(this.props.schema.items).includes(s)&&(e=s),window.addEventListener("hashchange",this.onHashTabsChanged,!1)}}void 0===e&&(e=(window._localStorage||window.localStorage).getItem(`${this.props.dialogName||"App"}.${this.props.oContext.adapterName}`)||Object.keys(this.props.schema.items)[0],Object.keys(this.props.schema.items).includes(e)||(e=Object.keys(this.props.schema.items)[0])),Object.assign(this.state,{tab:e})}componentWillUnmount(){window.removeEventListener("hashchange",this.onHashTabsChanged,!1),super.componentWillUnmount()}render(){const t=this.props.schema.items;let e=!1;return(0,d.jsxs)("div",{style:Ve.tabs,children:[(0,d.jsx)(h.Tabs,{variant:"scrollable",scrollButtons:"auto",style:this.props.schema.tabsStyle,value:this.state.tab,onChange:(t,e)=>{(window._localStorage||window.localStorage).setItem(`${this.props.dialogName||"App"}.${this.props.oContext.adapterName}`,e),this.setState({tab:e},(()=>{if(this.props.root){const t=(window.location.hash||"").split("/");t.length>=3&&"config"===t[1]&&(t[3]=this.state.tab,window.location.hash=t.join("/"))}}))},children:Object.keys(t).map((s=>{let i;if(this.props.custom){if(this.executeCustom(t[s].hidden,this.props.data,this.props.customObj,this.props.oContext.instanceObj,this.props.index,this.props.globalData))return null;i=this.executeCustom(t[s].disabled,this.props.data,this.props.customObj,this.props.oContext.instanceObj,this.props.index,this.props.globalData)}else{if(this.execute(t[s].hidden,!1,this.props.data,this.props.index,this.props.globalData))return null;i=this.execute(t[s].disabled,!1,this.props.data,this.props.index,this.props.globalData)}const o=this.getIcon(t[s].icon);return e=e||!!o,(0,d.jsx)(h.Tab,{id:s,wrapped:!0,disabled:i,value:s,iconPosition:this.props.schema.iconPosition||"start",icon:o,label:this.getText(t[s].label)},s)}))}),(0,d.jsx)(Ae,{oContext:this.props.oContext,isParentTab:!0,changed:this.props.changed,index:1001,arrayIndex:this.props.arrayIndex,globalData:this.props.globalData,commandRunning:this.props.commandRunning,style:{...Ve.panel,...e?Ve.panelWithIcons:Ve.panelWithoutIcons},common:this.props.common,alive:this.props.alive,themeName:this.props.themeName,data:this.props.data,originalData:this.props.originalData,onChange:this.props.onChange,onError:this.props.onError,customObj:this.props.customObj,custom:this.props.custom,schema:t[this.state.tab],table:this.props.table,withIcons:e},this.state.tab)]})}},We={width:"100%",height:"100%"};class Ue extends i.Component{constructor(t){super(t),this.forceUpdateHandlers=void 0,this.errorTimeout=null,this.errorCached=null,this.oContext=void 0,this.onCommandRunning=t=>this.setState({commandRunning:t}),this.onAlive=(t,e)=>{!(null===e||void 0===e||!e.val)!==this.state.alive&&this.setState({alive:!(null===e||void 0===e||!e.val)})},this.onChange=(t,e,s,i)=>{if(this.props.onValueChange)this.props.onValueChange(t,e,i),s&&s();else if(t&&this.props.onChange){const e={changed:JSON.stringify(t)!==this.state.originalData};this.setState(e,(()=>{this.props.onChange(t,e.changed,i),s&&s()}))}else i&&this.props.onChange(null,null,i)},this.onError=(t,e)=>{this.errorCached=this.errorCached||JSON.parse(JSON.stringify(this.state.errors));const s=this.errorCached;e?s[t]=e:delete s[t],this.errorTimeout&&clearTimeout(this.errorTimeout),JSON.stringify(s)!==JSON.stringify(this.state.errors)?this.errorTimeout=setTimeout((()=>this.setState({errors:this.errorCached},(()=>{this.errorTimeout=null,this.errorCached=null,this.props.onError(!!Object.keys(this.state.errors).length)}))),50):this.errorCached=null},this.changeLanguage=()=>{this.forceUpdate()},this.forceAttrUpdate=(t,e)=>{Array.isArray(t)?t.forEach((t=>this.forceUpdateHandlers[t]&&this.forceUpdateHandlers[t](e))):this.forceUpdateHandlers[t]&&this.forceUpdateHandlers[t](e)},this.registerOnForceUpdate=(t,e)=>{e?this.forceUpdateHandlers[t]=e:this.forceUpdateHandlers[t]&&delete this.forceUpdateHandlers[t]},this.state={originalData:JSON.stringify(this.props.data),changed:!1,errors:{},updateData:this.props.updateData||0,systemConfig:null,alive:!1,commandRunning:!1,schema:JSON.parse(JSON.stringify(this.props.schema))},this.forceUpdateHandlers={},this.buildDependencies(this.state.schema),this.readData()}static getDerivedStateFromProps(t,e){return t.updateData!==e.updateData?{updateData:t.updateData,originalData:JSON.stringify(t.data),schema:JSON.parse(JSON.stringify(t.schema))}:null}static async loadI18n(t,e,s){if(!0===e||e&&"string"===typeof e){const o=c.I18n.getLanguage(),a="string"===typeof e?e:"i18n";let n,r=await t.fileExists(`${s}.admin`,`${a}/${o}.json`);if(r?n=`${a}/${o}.json`:(r=await t.fileExists(`${s}.admin`,`${a}/${o}/translations.json`),r?n=`${a}/${o}/translations.json`:"en"!==o&&(r=await t.fileExists(`${s}.admin`,`${a}/en.json`),r?n=`${a}/en.json`:(r=await t.fileExists(`${s}.admin`,`${a}/en/translations.json`),r&&(n=`${a}/en/translations.json`)))),n){const e=await t.readFile(`${s}.admin`,n);let a;a=void 0!==e.file?e.file:e;try{const t=JSON.parse(a);c.I18n.extendTranslations(t,o)}catch(i){return console.error(`Cannot parse language file "${s}.admin/${n}: ${i}`),""}return n}return console.warn(`Cannot find i18n for ${s} / ${n}`),""}return e&&"object"===typeof e?(c.I18n.extendTranslations(e),""):""}readData(){this.props.socket.getCompactSystemConfig().then((t=>this.props.socket.getState(`system.adapter.${this.props.adapterName}.${this.props.instance}.alive`).then((e=>this.setState({systemConfig:t.common,alive:!(!e||!e.val)},(()=>{this.updateContext(!0),this.props.custom||this.props.socket.subscribeState(`system.adapter.${this.props.adapterName}.${this.props.instance}.alive`,this.onAlive)})))))).catch((t=>console.error(`Cannot read system config: ${t}`)))}flatten(t,e){return e=e||{},t.items&&Object.keys(t.items).forEach((s=>{e[s]=t.items[s],this.flatten(t.items[s],e)})),e}buildDependencies(t){const e=this.flatten(t);Object.keys(e).forEach((t=>{var s,i,o,a,n,r,l,h,p,c;null!==(s=e[t].confirm)&&void 0!==s&&s.alsoDependsOn&&(null===(r=e[t].confirm)||void 0===r||r.alsoDependsOn.forEach((s=>{if(e[s]){e[s].confirmDependsOn=e[s].confirmDependsOn||[];const i={...e[t],attr:t};i.confirm&&(i.confirm.cancel="Undo"),e[s].confirmDependsOn.push(i)}else console.error(`[JsonConfigComponent] Attribute ${s} does not exist!`),s.startsWith("data.")&&console.warn(`[JsonConfigComponent] please use "${s.replace(/^data\./,"")}" instead of "${s}"`)})));null!==(i=e[t].onChange)&&void 0!==i&&i.alsoDependsOn&&(null===(l=e[t].onChange)||void 0===l||l.alsoDependsOn.forEach((s=>{if(e[s]){e[s].onChangeDependsOn=e[s].onChangeDependsOn||[];const i={...e[t],attr:t};e[s].onChangeDependsOn.push(i)}else console.error(`[JsonConfigComponent] Attribute ${s} does not exist!`),s.startsWith("data.")&&console.warn(`[JsonConfigComponent] please use "${s.replace(/^data\./,"")}" instead of "${s}"`)})));null!==(o=e[t].hidden)&&void 0!==o&&o.alsoDependsOn&&(null===(h=e[t].hidden)||void 0===h||h.alsoDependsOn.forEach((s=>{if(e[s]){e[s].hiddenDependsOn=e[s].hiddenDependsOn||[];const i={...e[t],attr:t};e[s].hiddenDependsOn.push(i)}else console.error(`[JsonConfigComponent] Attribute ${s} does not exist!`),s.startsWith("data.")&&console.warn(`[JsonConfigComponent] please use "${s.replace(/^data\./,"")}" instead of "${s}"`)})));null!==(a=e[t].label)&&void 0!==a&&a.alsoDependsOn&&(null===(p=e[t].label)||void 0===p||p.alsoDependsOn.forEach((s=>{if(e[s]){e[s].labelDependsOn=e[s].labelDependsOn||[];const i={...e[t],attr:t};e[s].labelDependsOn.push(i)}else console.error(`[JsonConfigComponent] Attribute ${s} does not exist!`),s.startsWith("data.")&&console.warn(`[JsonConfigComponent] please use "${s.replace(/^data\./,"")}" instead of "${s}"`)})));null!==(n=e[t].help)&&void 0!==n&&n.alsoDependsOn&&(null===(c=e[t].help)||void 0===c||c.alsoDependsOn.forEach((s=>{if(e[s]){e[s].helpDependsOn=e[s].helpDependsOn||[];const i={...e[t],attr:t};e[s].helpDependsOn.push(i)}else console.error(`[JsonConfigComponent] Attribute ${s} does not exist!`),s.startsWith("data.")&&console.warn(`[JsonConfigComponent] please use "${s.replace(/^data\./,"")}" instead of "${s}"`)})))}))}updateContext(t){this.oContext={DeviceManager:this.props.DeviceManager,adapterName:this.props.adapterName,changeLanguage:this.changeLanguage,common:this.props.common,customs:this.props.customs,dateFormat:this.props.dateFormat,embedded:this.props.embedded,expertMode:this.props.expertMode,forceUpdate:this.forceAttrUpdate,imagePrefix:this.props.imagePrefix,instance:this.props.instance,instanceObj:this.props.instanceObj,isFloatComma:this.props.isFloatComma,multiEdit:this.props.multiEdit,onBackEndCommand:this.props.onBackEndCommand,onCommandRunning:this.onCommandRunning,onValueChange:this.props.onValueChange,registerOnForceUpdate:this.registerOnForceUpdate,socket:this.props.socket,systemConfig:this.state.systemConfig,theme:this.props.theme,themeType:this.props.themeType,_themeName:this.props.themeName,updateData:this.state.updateData},t&&this.forceUpdate()}renderItem(t){return"tabs"===t.type?(0,d.jsx)(Pe,{oContext:this.oContext,alive:this.state.alive,changed:this.state.changed,commandRunning:this.state.commandRunning,common:this.props.common,custom:this.props.custom,customObj:this.props.customObj,data:this.props.data,onChange:this.onChange,onError:(t,e)=>this.onError(t,e),originalData:JSON.parse(this.state.originalData),root:!0,schema:t,themeName:this.props.themeName}):"panel"!==t.type&&t.type?(console.error(`Unknown item type in root: ${JSON.stringify(t)}`),null):(0,d.jsx)(Ae,{oContext:this.oContext,alive:this.state.alive,changed:this.state.changed,commandRunning:this.state.commandRunning,common:this.props.common,custom:this.props.custom,customObj:this.props.customObj,data:this.props.data,index:1e3,isParentTab:!this.props.embedded,onChange:this.onChange,onError:(t,e)=>this.onError(t,e),originalData:JSON.parse(this.state.originalData),root:!0,schema:t,themeName:this.props.themeName})}render(){return this.state.systemConfig&&this.oContext?(this.oContext._themeName!==this.props.themeName&&(this.oContext._themeName=this.props.themeName,setTimeout((()=>this.updateContext(!0)),0)),(0,d.jsx)("div",{style:{...this.props.embedded?void 0:We,...this.props.style,...this.state.schema.style},children:this.renderItem(this.state.schema)})):(0,d.jsx)(h.LinearProgress,{})}}const Be=Ue,Re={root:{width:"100%",height:"100%",overflow:"hidden",position:"relative"},scroll:{height:"calc(100% - 48px)",overflowY:"auto"},exportImportButtons:{position:"absolute",top:5,right:0,zIndex:3},button:{marginRight:"5px"},tooltip:{pointerEvents:"none"}};function Me(t,e){if("string"!==typeof e)return e;if(!e.startsWith("$/aes-192-cbc:")||!/^[0-9a-f]{48}$/.test(t))return function(t,e){let s="";for(let i=0;i<e.length;i++)s+=String.fromCharCode(t[i%t.length].charCodeAt(0)^e.charCodeAt(i));return s}(t,e);const s=e.split(":",3),i=window.CryptoJS.enc.Hex.parse(t),o=window.CryptoJS.enc.Hex.parse(s[1]),a=window.CryptoJS.lib.CipherParams.create({ciphertext:window.CryptoJS.enc.Hex.parse(s[2])}),n=window.CryptoJS.AES.decrypt(a,i,{iv:o});return window.CryptoJS.enc.Utf8.stringify(n)}function Je(t,e,s){if("string"!==typeof e)return e;if(!/^[0-9a-f]{48}$/.test(t))return function(t,e){let s="";for(let i=0;i<e.length;i++)s+=String.fromCharCode(t[i%t.length].charCodeAt(0)^e.charCodeAt(i));return s}(t,e);let i;i=s?window.CryptoJS.enc.Hex.parse(s):window.CryptoJS.lib.WordArray.random(16);const o=window.CryptoJS.enc.Hex.parse(t),a=window.CryptoJS.AES.encrypt(e,o,{iv:i}).ciphertext;return`$/aes-192-cbc:${window.CryptoJS.enc.Hex.stringify(i)}:${a}`}function ze(t,e){var s;return e&&document.getElementById(e)?null===(s=document.getElementById(e))||void 0===s?void 0:s.onload:new Promise((s=>{const i=document.createElement("script");i.setAttribute("id",e),i.onload=s,i.src=t,document.getElementsByTagName("head")[0].appendChild(i)}))}class He extends c.Router{constructor(t){super(t),this.fileSubscribed=[],this.fileLangSubscribed="",this.secret=void 0,this.handleFileSelect=t=>{const e=t.target.files[0];if(e){const t=new FileReader;t.onload=t=>{if(!t.target)return;const e=t.target.result;try{const t=JSON.parse(e);this.setState({data:t,changed:JSON.stringify(t)!==JSON.stringify(this.state.originalData)})}catch{window.alert(c.I18n.t("[JsonConfig] Failed to parse JSON file"))}},t.readAsText(e)}else window.alert(c.I18n.t("[JsonConfig] Failed to open JSON File"))},this.onFileChange=async(t,e,s)=>{if(t===`${this.props.adapterName}.admin`&&s)if(e===this.fileLangSubscribed)try{var i;await Be.loadI18n(this.props.socket,null===(i=this.state.schema)||void 0===i?void 0:i.i18n,this.props.adapterName),this.setState({hash:`${this.state.hash}1`})}catch{}else if(this.fileSubscribed.includes(e))try{const t=await this.getConfigFile(this.fileSubscribed[0]);this.setState({schema:t,hash:l()(JSON.stringify(t)).toString()})}catch{}},this.state={updateData:0,changed:!1,confirmDialog:!1,theme:(0,c.Theme)(t.themeName),saveConfigDialog:!1,hash:"_"},this.secret=t.secret||"",this.getInstanceObject().then((t=>this.getConfigFile().then((e=>Be.loadI18n(this.props.socket,null===e||void 0===e?void 0:e.i18n,this.props.adapterName).then((s=>{s&&(this.fileLangSubscribed||(this.fileLangSubscribed=s,this.props.socket.subscribeFiles(`${this.props.adapterName}.admin`,this.fileLangSubscribed,this.onFileChange))),t?this.setState({schema:e,data:t.native,common:t.common,hash:l()(JSON.stringify(e)).toString()}):window.alert(`Instance system.adapter.${this.props.adapterName}.${this.props.instance} not found!`)}))))))}componentWillUnmount(){super.componentWillUnmount(),this.fileSubscribed.length&&(this.props.socket.unsubscribeFiles(`${this.props.adapterName}.admin`,this.fileSubscribed,this.onFileChange),this.fileSubscribed=[]),this.fileLangSubscribed&&(this.props.socket.unsubscribeFiles(`${this.props.adapterName}.admin`,this.fileLangSubscribed,this.onFileChange),this.fileLangSubscribed="")}getExportImportButtons(){return(0,d.jsxs)("div",{style:Re.exportImportButtons,children:[(0,d.jsx)(h.Tooltip,{title:this.props.t("Import settings from JSON file"),slotProps:{popper:{sx:Re.tooltip}},children:(0,d.jsx)(h.Fab,{size:"small",sx:{"&.MuiFab-root":Re.button},onClick:()=>{const t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("id","files"),t.setAttribute("opacity",0),t.addEventListener("change",(t=>this.handleFileSelect(t)),!1),t.click()},children:(0,d.jsx)(p.Publish,{})})}),(0,d.jsx)(h.Tooltip,{title:this.props.t("Export setting to JSON file"),slotProps:{popper:{sx:Re.tooltip}},children:(0,d.jsx)(h.Fab,{size:"small",sx:{"&.MuiFab-root":Re.button},onClick:()=>{this.state.data&&c.Utils.generateFile(`${this.props.adapterName}.${this.props.instance}.json`,this.state.data)},children:(0,d.jsx)(p.Publish,{style:{transform:"rotate(180deg)"}})})})]})}async getInstanceObject(){try{const e=await this.props.socket.getObject(`system.adapter.${this.props.adapterName}.${this.props.instance}`);if(Array.isArray(e.encryptedNative)){var t;if(!this.secret){const t=await this.props.socket.getSystemConfig();await ze("../../lib/js/crypto-js/crypto-js.js","crypto-js"),this.secret=t.native.secret}return null===(t=e.encryptedNative)||void 0===t||t.forEach((t=>{e.native[t]&&(e.native[t]=Me(this.secret,e.native[t]))})),e}return e}catch(e){window.alert(`[JsonConfig] Cannot read instance object: ${e}`)}return null}renderDialogConfirm(){return this.state.confirmDialog?(0,d.jsx)(c.DialogConfirm,{title:c.I18n.t("ra_Please confirm"),text:c.I18n.t("ra_Some data are not stored. Discard?"),ok:c.I18n.t("ra_Discard"),cancel:c.I18n.t("ra_Cancel"),onClose:t=>this.setState({confirmDialog:!1},(()=>t&&c.Router.doNavigate(null)))}):null}async scanForInclude(t,e){if("string"===typeof t["#include"]){const s=await this._getConfigFile(t["#include"],[...e]);return delete t["#include"],s&&(t={...t,...s}),t}const s=Object.keys(t);for(let i=0;i<s.length;i++)t[s[i]]&&"object"===typeof t[s[i]]&&(t[s[i]]=await this.scanForInclude(t[s[i]],e));return t}async getConfigFile(t){return this._getConfigFile(t)}async _getConfigFile(t,e){if(t=t||"jsonConfig.json5",(e=e||[]).includes(t))return window.alert(`[JsonConfig] Circular reference in file: ${t} => ${e.join(" => ")}`),null;e.push(t);try{await this.props.socket.fileExists(`${this.props.adapterName}.admin`,t)||(t="jsonConfig.json");const i=await this.props.socket.readFile(`${this.props.adapterName}.admin`,t);let o="",a="";if(void 0!==i.file&&(a=i.file),"string"===typeof a)o=a;else if("Buffer"===a.type){let t="";const e=new Uint8Array(a.data),s=e.byteLength;for(let i=0;i<s;i++)t+=String.fromCharCode(e[i]);o=t}this.fileSubscribed.includes(t)||(this.fileSubscribed.push(t),await this.props.socket.subscribeFiles(`${this.props.adapterName}.admin`,t,this.onFileChange));try{return await this.scanForInclude(n().parse(o),e)}catch(s){window.alert("[JsonConfig] Cannot parse json5 config!"),console.log(s)}}catch(i){this.state.schema||window.alert(`[JsonConfig] Cannot read file "${t}: ${i}`)}return null}renderSaveConfigDialog(){return this.state.saveConfigDialog?(0,d.jsx)(c.DialogConfirm,{title:c.I18n.t("ra_Please confirm"),text:c.I18n.t("Save configuration?"),ok:c.I18n.t("ra_Save"),cancel:c.I18n.t("ra_Cancel"),onClose:t=>this.setState({saveConfigDialog:!1},(()=>t&&this.onSave(!0)))}):null}findAttr(t,e){var s;if(null!==(s=e=e||this.state.schema)&&void 0!==s&&s.items){if(t in e.items)return e.items[t];for(const s of Object.values(e.items)){const e=this.findAttr(t,s);if(e)return e}}return null}postProcessing(t,e,s){if(s=s||this.state.schema,!t)return void console.error(`Data is empty in postProcessing: ${e}, ${JSON.stringify(s)}`);const i=t[e];if(s.items)if("table"===s.type){const t=i;if(!Array.isArray(t))return;for(const e of t)for(const t of s.items)this.postProcessing(e,t.attr,t)}else for(const[o,a]of Object.entries(s.items)){if("panel"===a.type||"tabs"===a.type||"accordion"===a.type)return;this.postProcessing(t,o,a)}else if(e&&"string"===typeof i)if("text"===s.type)!1!==s.trim&&(t[e]=i.trim());else if("ip"===s.type)t[e]=i.trim();else if("number"===s.type){const o=parseFloat(i.toString().replace(",","."));void 0!==s.min&&o<s.min?t[e]=s.min:void 0!==s.max&&o>s.max?t[e]=s.max:t[e]=o}else if("port"===s.type){const o=parseInt(i.toString(),10);void 0!==s.min&&o<s.min?t[e]=s.min:void 0!==s.max&&o>s.max&&(t[e]=s.max),0!==t[e]&&o<20?t[e]=20:t[e]=o>65535?65535:o}else"checkbox"===s.type&&(t[e]=!0===t[e]||"true"===t[e]||"on"===t[e]||1===t[e]||"1"===t[e])}async onSave(t,e){if(t){const t=await this.getInstanceObject();if(!t)return console.error("Something went wrong: may be no connection?"),void window.alert("Something went wrong: may be no connection?");if(!this.state.data||!this.state.schema)return;const i={};for(const e of Object.keys(this.state.data)){const s=this.findAttr(e);s&&s.doNotSave&&"state"!==s.type||e.startsWith("_")?(g.setValue(t.native,e,null),i[e]=this.state.data[e]):g.setValue(t.native,e,this.state.data[e])}try{const e=JSON.parse(JSON.stringify(t));if(Array.isArray(e.encryptedNative)){await ze("../../lib/js/crypto-js/crypto-js.js","crypto-js");for(const t of e.encryptedNative)e.native[t]&&(e.native[t]=Je(this.secret,e.native[t]))}await this.props.socket.setObject(e._id,e)}catch(s){window.alert(`[JsonConfig] Cannot set object: ${s}`)}const o={...t.native,...i};console.log(o),this.setState({changed:!1,data:o,updateData:this.state.updateData+1,originalData:o},(()=>e&&c.Router.doNavigate(null)))}else this.state.changed?this.setState({confirmDialog:!0}):c.Router.doNavigate(null)}componentDidUpdate(t,e){e.changed!==this.state.changed&&this.props.configStored(!this.state.changed)}async componentDidMount(){const t=`${window.location.protocol}//${window.location.host}${window.location.pathname}validate_config/${this.props.adapterName}`;console.log(`fetch ${t}`),await fetch(t)}render(){return this.state.data&&this.state.schema?(0,d.jsxs)("div",{style:Re.root,children:[this.renderDialogConfirm(),this.getExportImportButtons(),this.renderSaveConfigDialog(),(0,d.jsx)(Be,{style:Re.scroll,socket:this.props.socket,themeName:this.props.themeName,themeType:this.props.themeType,adapterName:this.props.adapterName,instance:this.props.instance,isFloatComma:this.props.isFloatComma,dateFormat:this.props.dateFormat,schema:this.state.schema,common:this.state.common,expertMode:this.props.expertMode,data:this.state.data,updateData:this.state.updateData,onError:t=>this.setState({error:t}),onChange:(t,e,s)=>{s&&this.state.error&&(window.alert(c.I18n.t("Cannot save configuration because of error in configuration")),s=!1),!s||this.state.changed||e||(s=!1),t?this.setState({data:t,changed:e,saveConfigDialog:s}):void 0!==s&&this.setState({saveConfigDialog:s})},DeviceManager:this.props.DeviceManager,theme:this.state.theme},this.state.hash),(0,d.jsx)(c.SaveCloseButtons,{isIFrame:!1,dense:!0,paddingLeft:0,newReact:!0,theme:this.state.theme,noTextOnButtons:"xs"===this.props.width||"sm"===this.props.width||"md"===this.props.width,changed:!(!this.state.error&&!this.state.changed),error:!!this.state.error,onSave:t=>this.onSave(!0,t),onClose:()=>this.onSave(!1)})]}):(0,d.jsx)(h.LinearProgress,{})}}const qe=He},75443:()=>{}}]);
//# sourceMappingURL=6853.cd96edae.chunk.js.map