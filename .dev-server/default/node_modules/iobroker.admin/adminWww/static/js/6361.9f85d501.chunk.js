"use strict";(self.webpackChunksrc_rx=self.webpackChunksrc_rx||[]).push([[6361],{16668:(e,s,t)=>{t.d(s,{K:()=>l,S:()=>a});t(28437);var o=t(89303),i=t(32075),r=t(16904),n=t(70579);function l(e){const s=e.icon;return(0,n.jsxs)("div",{style:e.styles.formContainer,children:[s?(0,n.jsx)(s,{style:e.styles.formIcon}):null,(0,n.jsx)(o.FormControl,{style:e.styles.formControl,variant:"standard",children:(0,n.jsx)(o.TextField,{variant:"standard",label:e.t(e.label),autoComplete:e.autoComplete,error:!!e.error,helperText:e.error||"",value:e.value,onChange:s=>e.onChange(s.target.value),disabled:e.disabled,type:e.type,slotProps:{inputLabel:{shrink:!0},input:{readOnly:!1,endAdornment:e.value?(0,n.jsx)(o.InputAdornment,{position:"end",children:(0,n.jsx)(o.IconButton,{size:"small",onClick:()=>e.onChange(""),children:(0,n.jsx)(i.Close,{})})}):null}}})})]})}function a(e){const s=e.icon;return(0,n.jsxs)("div",{style:{width:"100%"},children:[s?(0,n.jsx)(s,{style:e.previewStyle||e.styles.formIcon}):null,(0,n.jsx)(r.ColorPicker,{style:{...e.style||void 0,width:s?"calc(100% - 45px)":"100%",display:"inline-block",verticalAlign:"top"},label:e.t(e.label),onChange:e.onChange,value:e.value||""})]})}},46361:(e,s,t)=>{t.r(s),t.d(s,{default:()=>N});var o=t(28437),i=t(16904),r=t(30335),n=t(67537),l=t(28791),a=t(94343),d=t(89303),c=t(32075),p=t(17774),h=t(42734),u=t(27686),m=t(70579);const g=e=>{const s=e.isDragging?0:1,t=i.Utils.getInvertedColor(e.user.common.color,e.themeType,!0),o={cursor:"grab",opacity:s,overflow:"hidden",color:t};return e.user.common.color&&(o.backgroundColor=e.user.common.color),(0,m.jsx)(d.Card,{style:o,sx:e.styles.userGroupCard2,children:(0,m.jsxs)("div",{style:e.styles.userCardContent,children:[(0,m.jsxs)("div",{style:e.styles.right,children:[(0,m.jsx)(d.Checkbox,{checked:e.user.common.enabled,style:{color:t},disabled:e.user.common.dontDelete,onChange:()=>{e.socket.extendObject(e.user._id,{common:{enabled:!e.user.common.enabled}}).then((()=>e.updateData()))}}),(0,m.jsx)(d.IconButton,{size:"small",onClick:()=>e.showUserEditDialog(e.user,!1),children:(0,m.jsx)(c.Edit,{style:{color:t}})}),(0,m.jsx)(d.IconButton,{size:"small",onClick:()=>e.showUserDeleteDialog(e.user),disabled:e.user.common.dontDelete,children:(0,m.jsx)(c.Delete,{style:e.user.common.dontDelete?null:{color:t}})})]}),(0,m.jsxs)(d.CardContent,{children:[(0,m.jsxs)(d.Typography,{gutterBottom:!0,component:"div",style:e.styles.userGroupTitle,children:[e.user.common.icon?(0,m.jsx)(i.Icon,{style:e.styles.icon,src:e.user.common.icon}):(0,m.jsx)(c.Person,{style:e.styles.icon}),(0,m.jsxs)("div",{children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("span",{style:e.styles.userGroupUserName,children:e.getText(e.user.common.name)}),(0,m.jsxs)("span",{style:e.styles.userGroupUserID,children:["[",e.user._id,"]"]})]}),(0,m.jsx)("span",{children:e.user.common.desc?(0,m.jsx)("div",{style:e.styles.description,children:e.getText(e.user.common.desc)}):null})]})]}),e.groups.find((s=>s.common.members&&s.common.members.includes(e.user._id)))?(0,m.jsxs)("div",{children:[e.t("In groups"),":"]}):null,(0,m.jsx)("div",{children:e.groups.map((s=>{var o,r;if(!s.common.members||!s.common.members.includes(e.user._id))return null;const n=s&&null!==(o=s.common)&&void 0!==o&&o.color?i.Utils.getInvertedColor(s.common.color,e.themeType,!0):t;return(0,m.jsxs)(d.Card,{variant:"outlined",sx:e.styles.userGroupMember,style:{color:n,borderColor:`${n}80`,background:(null===(r=s.common)||void 0===r?void 0:r.color)||"inherit"},children:[s.common.icon?(0,m.jsx)(i.Icon,{style:e.styles.icon,src:s.common.icon}):(0,m.jsx)(c.Group,{style:e.styles.icon}),e.getText(s.common.name),(0,m.jsx)(d.IconButton,{size:"small",onClick:()=>e.removeUserFromGroup(e.user._id,s._id),children:(0,m.jsx)(c.Clear,{style:{color:n}})})]},s._id)}))})]})]})})},x=e=>{const s=(0,o.useRef)(),[{isDragging:t},i,r]=(0,h.i)({type:"user",item:()=>{var t;return{userId:e.user._id,preview:(0,m.jsx)("div",{style:{width:null===(t=s.current)||void 0===t?void 0:t.offsetWidth},children:(0,m.jsx)(g,{...e})})}},end:(s,t)=>{const o=t.getDropResult();s&&o&&e.addUserToGroup(s.userId,o.groupId)},collect:e=>({isDragging:e.isDragging(),handlerId:e.getHandlerId()})});return(0,o.useEffect)((()=>{r((0,u.n)(),{captureDraggingState:!0})}),[r]),(0,m.jsx)("div",{ref:i,children:(0,m.jsx)("div",{ref:s,children:(0,m.jsx)(g,{isDragging:t,...e})})})};var y=t(35964);const v=e=>{var s;const[{CanDrop:t,isOver:o},r]=(0,y.H)((()=>({accept:"user",drop:()=>({groupId:e.group._id}),canDrop:(s,t)=>function(e,s){return!s.group.common.members||!s.group.common.members.includes(e.getItem().userId)}(t,e),collect:e=>({isOver:e.isOver(),CanDrop:e.canDrop()})})),[e.group.common.members]);let n,l=.7;t&&o?(l=t?1:.125,n=e.styles.userGroupCardSecondary):t&&(l=t?.75:.25);const a=i.Utils.getInvertedColor(e.group.common.color,e.themeType,!0),p={opacity:l,overflow:"hidden",color:a};return e.group.common.color&&(p.backgroundColor=e.group.common.color),(0,m.jsxs)(d.Card,{style:p,ref:r,sx:i.Utils.getStyle(e.theme,e.styles.userGroupCard2,n),children:[(0,m.jsxs)("div",{style:e.styles.right,children:[(0,m.jsx)(d.IconButton,{size:"small",onClick:()=>e.showGroupEditDialog(e.group,!1),children:(0,m.jsx)(c.Edit,{style:{color:a}})}),(0,m.jsx)(d.IconButton,{size:"small",onClick:()=>e.showGroupDeleteDialog(e.group),disabled:e.group.common.dontDelete,children:(0,m.jsx)(c.Delete,{style:e.group.common.dontDelete?null:{color:a}})})]}),(0,m.jsxs)(d.CardContent,{children:[(0,m.jsxs)(d.Typography,{gutterBottom:!0,component:"div",style:e.styles.userGroupTitle,children:[e.group.common.icon?(0,m.jsx)(i.Icon,{style:e.styles.icon,src:e.group.common.icon}):(0,m.jsx)(c.Group,{style:e.styles.icon}),(0,m.jsxs)("div",{children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("span",{style:e.styles.userGroupUserName,children:e.getText(e.group.common.name)}),(0,m.jsxs)("span",{children:["[",e.group._id,"]"]})]}),e.group.common.desc?(0,m.jsx)("div",{style:e.styles.description,children:e.getText(e.group.common.desc)}):null]})]}),null!==(s=e.group.common.members)&&void 0!==s&&s.length?(0,m.jsxs)("div",{children:[e.t("Group members"),":"]}):null,(0,m.jsx)("div",{children:(e.group.common.members||[]).map(((s,t)=>{var o,r;const n=e.users.find((e=>e._id===s)),l=n&&null!==(o=n.common)&&void 0!==o&&o.color?i.Utils.getInvertedColor(n.common.color,e.themeType,!0):a;return n?(0,m.jsxs)(d.Card,{variant:"outlined",sx:e.styles.userGroupMember,style:{color:l,borderColor:`${l}40`,background:(null===(r=n.common)||void 0===r?void 0:r.color)||"inherit"},children:[n.common.icon?(0,m.jsx)(i.Icon,{style:e.styles.icon,src:n.common.icon}):(0,m.jsx)(c.Person,{style:e.styles.icon}),e.getText(n.common.name),(0,m.jsx)(d.IconButton,{size:"small",onClick:()=>e.removeUserFromGroup(s,e.group._id),children:(0,m.jsx)(c.Clear,{style:{color:l}})})]},t):null}))})]})]})};var C=t(16668);const j=[t.p+"static/media/user1.24fa2b07586d952c415397f499b50c49.svg",t.p+"static/media/user2.c6b253a8208981fea9c70e282073c8ea.svg",t.p+"static/media/user3.e838132e7f2d6d44d829d934daf96dbe.svg",t.p+"static/media/user4.f66996c087a4247316e162b5ec54ff11.svg",t.p+"static/media/user5.842fb6e5ac2067df7c241eb9e42a7ff6.svg",t.p+"static/media/user6.f1589fc9f97a1e42a2a3dd62d18aee5e.svg",t.p+"static/media/user7.773f25cff1c54afbc35bbd79455aa271.svg",t.p+"static/media/user8.43bbbecca8ba97c5da0521bdc072ae1f.svg",t.p+"static/media/user9.2a94bc8f32545bf549e96311624574c4.svg",t.p+"static/media/user10.7b8712e8bbad287a584a0a26ac4cf23c.svg",t.p+"static/media/user11.dfec7022ca4b81de158d5adf60571632.svg",t.p+"static/media/user12.67a70d9093f2e3aafdeddb5dc4f110df.svg"],b={padding:"16px 24px"};class f extends o.Component{constructor(e){super(e),this.state={originalId:e.user._id,passwordRepeat:e.user.common.password}}componentDidMount(){if(this.props.isNew){const e=j[Math.round(Math.random()*(j.length-1))];e&&i.Utils.getSvg(e).then((e=>{const s=i.Utils.clone(this.props.user);s.common.icon=e,this.props.onChange(s)}))}}render(){const e=this.props.users.find((e=>e._id===this.props.user._id)),s=this.props.user._id!==this.state.originalId,t=e=>e.replace(i.Utils.FORBIDDEN_CHARS,"_").replace(/\s/g,"_").replace(/\./g,"_").replace(/,/g,"_").replace(/__/g,"_").replace(/__/g,"_").toLowerCase(),o=(e,s)=>{const t=e.split(".");return t[t.length-1]=s,t.join(".")},r=this.props.getText(this.props.user.common.desc),n=this.props.getText(this.props.user.common.name),l=p.A.checkPassword(this.props.user.common.password),a=p.A.checkPassword(this.props.user.common.password,this.state.passwordRepeat);let h="system.user."!==this.props.user._id&&!l&&!a;return(this.props.isNew&&e||e&&s)&&(h=!1),(0,m.jsxs)(d.Dialog,{fullWidth:this.props.innerWidth<500,open:!0,onClose:(e,s)=>{"backdropClick"!==s&&"escapeKeyDown"!==s&&this.props.onClose()},children:[(0,m.jsx)(d.DialogTitle,{style:{...this.props.styles.dialogTitle,padding:12},children:this.props.t("User parameters")}),(0,m.jsx)(d.DialogContent,{sx:{"&.MuiDialogContent-root":{...this.props.innerWidth<500?this.props.styles.narrowContent:void 0,...b}},children:(0,m.jsxs)(d.Grid2,{container:!0,spacing:this.props.innerWidth<500?1:4,style:this.props.styles.dialog,children:[(0,m.jsx)(d.Grid2,{size:{xs:12,md:6},children:(0,m.jsx)(C.K,{label:"Name",t:this.props.t,value:n,onChange:e=>{const s=i.Utils.clone(this.props.user);this.props.user.common.dontDelete||t(this.props.getText(s.common.name))!==s._id.split(".").pop()||(s._id=o(s._id,t(e))),s.common.name=e,this.props.onChange(s)},autoComplete:"new-password",icon:c.TextFields,styles:this.props.styles})}),(0,m.jsx)(d.Grid2,{size:{xs:12,md:6},children:(0,m.jsx)(C.K,{label:"ID edit",t:this.props.t,disabled:this.props.user.common.dontDelete,value:this.props.user._id.split(".")[this.props.user._id.split(".").length-1],onChange:e=>{const s=i.Utils.clone(this.props.user);s._id=o(s._id,t(e)),this.props.onChange(s)},icon:c.LocalOffer,styles:this.props.styles})}),(0,m.jsx)(d.Grid2,{size:{xs:12,md:6},children:(0,m.jsx)(C.K,{label:"ID preview",t:this.props.t,disabled:!0,value:this.props.user._id,icon:c.Pageview,styles:this.props.styles})}),(0,m.jsx)(d.Grid2,{size:{xs:12,md:6},children:(0,m.jsx)(C.K,{label:"Description",t:this.props.t,value:r,onChange:e=>{const s=i.Utils.clone(this.props.user);s.common.desc=e,this.props.onChange(s)},icon:c.Description,styles:this.props.styles})}),(0,m.jsx)(d.Grid2,{size:{xs:12,md:6},children:(0,m.jsx)(C.K,{label:"Password",t:this.props.t,value:this.props.user.common.password,error:l?this.props.t(l):void 0,onChange:e=>{const s=i.Utils.clone(this.props.user);s.common.password=e,this.props.onChange(s)},type:"password",autoComplete:"new-password",icon:c.VpnKey,styles:this.props.styles})}),(0,m.jsx)(d.Grid2,{size:{xs:12,md:6},children:(0,m.jsx)(C.K,{label:"Password repeat",t:this.props.t,value:this.state.passwordRepeat,error:a?this.props.t(a):void 0,onChange:e=>this.setState({passwordRepeat:e}),type:"password",autoComplete:"new-password",icon:c.VpnKey,styles:this.props.styles})}),(0,m.jsx)(d.Grid2,{size:{xs:12,md:6},children:(0,m.jsx)(i.IconPicker,{icons:j,label:"Icon",value:this.props.user.common.icon,onChange:e=>{const s=i.Utils.clone(this.props.user);s.common.icon=e,this.props.onChange(s)},previewStyle:this.props.styles.iconPreview,icon:c.Image})}),(0,m.jsx)(d.Grid2,{size:{xs:12,md:6},children:(0,m.jsx)(C.S,{label:"Color",t:this.props.t,value:this.props.user.common.color,previewStyle:this.props.styles.iconPreview,onChange:e=>{const s=i.Utils.clone(this.props.user);s.common.color=e,this.props.onChange(s)},icon:c.ColorLens,style:this.props.styles.colorPicker,styles:this.props.styles})})]})}),(0,m.jsxs)(d.DialogActions,{style:this.props.styles.dialogActions,children:[(0,m.jsx)(d.Button,{variant:"contained",color:"primary",autoFocus:!0,onClick:()=>this.props.saveData(this.props.isNew?null:this.state.originalId),disabled:!h,startIcon:(0,m.jsx)(c.Check,{}),children:this.props.t("Save")}),(0,m.jsx)(d.Button,{variant:"contained",color:"grey",onClick:this.props.onClose,startIcon:(0,m.jsx)(c.Close,{}),children:this.props.t("Cancel")})]})]})}}const D=f;const w=[t.p+"static/media/group1.e4d9dfc6de58d318b9f8659b7bdf92c8.svg",t.p+"static/media/group2.005a7b0a473ee5c6b4afa0f5a4bd399e.svg",t.p+"static/media/group3.ee5e28d28f498bd44d945842ecc32110.svg",t.p+"static/media/group4.d6b392ffee69d8a8efee376434f5cfba.svg",t.p+"static/media/group5.68fdb9e99d289e9c014cc8ee4e9ae4bb.svg",t.p+"static/media/group6.c7f286d197fb918b0d2b34944ec9ef6a.svg",t.p+"static/media/group7.066f78d64741ca336b2137f9caf72133.svg",t.p+"static/media/group8.25d573e553e37968d4e6babd06b36746.svg",t.p+"static/media/group9.b7aae7b7185e989f91b749ff1758d49d.svg",t.p+"static/media/group10.250fd49c0c4d348815c639620bef3467.svg"];function _(e){const s=(e,s)=>Object.values(e).map(((t,o)=>{const i=Object.keys(e)[o];return s(t,i)}));let t=e.group.common.acl;return t=t||{},t.object=t.object||{read:!0,list:!0,write:!0,delete:!1,create:void 0},t.object={read:!0,list:!0,write:!0,delete:!1,...t.object},t.state=t.state||{read:!0,list:!0,write:!0,delete:!1,create:void 0},t.state={read:!0,list:!0,write:!0,delete:!1,...t.state},t.users=t.users||{write:!1,delete:!1,create:!1,list:void 0,read:void 0},t.users={write:!1,delete:!1,create:!1,...t.users},t.other=t.other||{http:!1,execute:!1,sendto:!0},t.other={http:!1,execute:!1,sendto:!0,...t.other},t.file=t.file||{read:!0,list:!0,write:!1,delete:!1,create:!1},t.file={read:!0,list:!0,write:!1,delete:!1,create:!1,...t.file},(0,m.jsx)(d.Grid2,{container:!0,spacing:e.innerWidth<500?1:4,style:e.styles.dialog,children:s(e.group.common.acl||{},((t,o)=>(0,m.jsxs)(d.Grid2,{size:{xs:12,md:12},children:[(0,m.jsx)(d.Box,{component:"h2",sx:e.styles.permHeaders,children:e.t(`group_acl_${o}`)}),s(t,((s,t)=>(0,m.jsx)(d.FormControlLabel,{control:(0,m.jsx)(d.Checkbox,{disabled:"system.group.administrator"===e.group._id,checked:s,onChange:s=>{const r=i.Utils.clone(e.group);r.common.acl[o][t]=s.target.checked,e.onChange(r)}}),label:e.t(`group_acl_${t}`),labelPlacement:"top"},t)))]},o)))},"PermissionsTab")}const k={padding:"16px 24px"};class G extends o.Component{constructor(e){super(e),this.state={tab:0,originalId:e.group._id}}componentDidMount(){if(this.props.isNew){const e=w[Math.round(Math.random()*(w.length-1))];e&&i.Utils.getSvg(e).then((e=>{const s=i.Utils.clone(this.props.group);s.common.icon=e,this.props.onChange(s)}))}}render(){const e=this.props.groups.find((e=>e._id===this.props.group._id)),s=this.props.group._id!==this.state.originalId;let t="system.group."!==this.props.group._id&&this.props.group.common.password===this.props.group.common.passwordRepeat;const o=e=>e.replace(i.Utils.FORBIDDEN_CHARS,"_").replace(/\s/g,"_").replace(/\./g,"_").toLowerCase(),r=(e,s)=>{const t=e.split(".");return t[t.length-1]=s,t.join(".")};this.props.isNew?e&&(t=!1):e&&s&&(t=!1);const n=this.props.getText(this.props.group.common.desc),l=this.props.getText(this.props.group.common.name),a=[(0,m.jsxs)(d.Grid2,{container:!0,spacing:this.props.innerWidth<500?1:4,style:this.props.styles.dialog,children:[(0,m.jsx)(d.Grid2,{size:{xs:12,md:6},children:(0,m.jsx)(C.K,{label:"Name",t:this.props.t,value:l,onChange:e=>{const s=i.Utils.clone(this.props.group);this.props.group.common.dontDelete||o(this.props.getText(s.common.name))!==s._id.split(".").pop()||(s._id=r(s._id,o(e))),s.common.name=e,this.props.onChange(s)},autoComplete:"off",icon:c.TextFields,styles:this.props.styles})}),(0,m.jsx)(d.Grid2,{size:{xs:12,md:6},children:(0,m.jsx)(C.K,{label:"ID edit",t:this.props.t,disabled:this.props.group.common.dontDelete,value:this.props.group._id.split(".")[this.props.group._id.split(".").length-1],onChange:e=>{const s=i.Utils.clone(this.props.group);s._id=r(s._id,o(e)),this.props.onChange(s)},icon:c.LocalOffer,styles:this.props.styles})}),(0,m.jsx)(d.Grid2,{size:{xs:12,md:6},children:(0,m.jsx)(C.K,{label:"ID preview",t:this.props.t,disabled:!0,value:this.props.group._id,icon:c.Pageview,styles:this.props.styles})}),(0,m.jsx)(d.Grid2,{size:{xs:12,md:6},children:(0,m.jsx)(C.K,{label:"Description",t:this.props.t,value:n,onChange:e=>{const s=i.Utils.clone(this.props.group);s.common.desc=e,this.props.onChange(s)},icon:c.Description,styles:this.props.styles})}),(0,m.jsx)(d.Grid2,{size:{xs:12,md:6},children:(0,m.jsx)(i.IconPicker,{label:"Icon",icons:w,value:this.props.group.common.icon,onChange:e=>{const s=i.Utils.clone(this.props.group);s.common.icon=e,this.props.onChange(s)},previewStyle:this.props.styles.iconPreview,icon:c.Image})}),(0,m.jsx)(d.Grid2,{size:{xs:12,md:6},children:(0,m.jsx)(C.S,{label:"Color",t:this.props.t,value:this.props.group.common.color,previewStyle:this.props.styles.iconPreview,onChange:e=>{const s=i.Utils.clone(this.props.group);s.common.color=e,this.props.onChange(s)},icon:c.ColorLens,style:this.props.styles.colorPicker,styles:this.props.styles})})]}),_(this.props)][this.state.tab];return(0,m.jsxs)(d.Dialog,{open:!0,onClose:(e,s)=>{"backdropClick"!==s&&"escapeKeyDown"!==s&&this.props.onClose()},fullWidth:this.props.innerWidth<500,children:[(0,m.jsx)(d.DialogTitle,{style:this.props.styles.dialogTitle,children:(0,m.jsxs)(d.Tabs,{variant:"fullWidth",value:this.state.tab,onChange:(e,s)=>this.setState({tab:s}),children:[(0,m.jsx)(d.Tab,{label:this.props.t("Main"),value:0}),(0,m.jsx)(d.Tab,{label:this.props.t("Permissions"),value:1})]})}),(0,m.jsx)(d.DialogContent,{sx:{"&.MuiDialogContent-root":{...this.props.innerWidth<500?this.props.styles.narrowContent:void 0,...k}},children:a}),(0,m.jsxs)(d.DialogActions,{style:this.props.styles.dialogActions,children:[(0,m.jsx)(d.Button,{variant:"contained",color:"primary",autoFocus:!0,onClick:()=>this.props.saveData(this.props.isNew?null:this.state.originalId),disabled:!t,startIcon:(0,m.jsx)(c.Check,{}),children:this.props.t("Save")}),(0,m.jsx)(d.Button,{variant:"contained",color:"grey",onClick:this.props.onClose,startIcon:(0,m.jsx)(c.Close,{}),children:this.props.t("Cancel")})]})]})}}const T=G;function U(e){return(0,m.jsxs)(d.Dialog,{open:!0,onClose:e.onClose,children:[(0,m.jsx)(d.DialogTitle,{children:e.t("Please confirm")}),(0,m.jsx)(d.DialogContent,{children:(0,m.jsx)(d.DialogContentText,{children:e.t("Do you want to delete user %s?",e.getText(e.user.common.name))})}),(0,m.jsxs)(d.DialogActions,{children:[(0,m.jsx)(d.Button,{variant:"contained",color:"primary",onClick:()=>e.deleteUser(e.user._id),startIcon:(0,m.jsx)(c.Delete,{}),children:e.t("Delete")}),(0,m.jsx)(d.Button,{variant:"contained",color:"grey",autoFocus:!0,onClick:e.onClose,startIcon:(0,m.jsx)(c.Close,{}),children:e.t("Cancel")})]})]})}function I(e){return(0,m.jsxs)(d.Dialog,{open:!0,onClose:e.onClose,children:[(0,m.jsx)(d.DialogTitle,{children:e.t("Please confirm")}),(0,m.jsx)(d.DialogContent,{children:(0,m.jsx)(d.DialogContentText,{children:e.t("Do you want to delete group %s?",e.getText(e.group.common.name))})}),(0,m.jsxs)(d.DialogActions,{style:e.styles.dialogActions,children:[(0,m.jsx)(d.Button,{variant:"contained",color:"primary",onClick:()=>e.deleteGroup(e.group._id),startIcon:(0,m.jsx)(c.Delete,{}),children:e.t("Delete")}),(0,m.jsx)(d.Button,{variant:"contained",color:"grey",autoFocus:!0,onClick:e.onClose,startIcon:(0,m.jsx)(c.Close,{}),children:e.t("Cancel")})]})]})}const E="***********",S={mainGridCont:{height:"calc(100% - 55px)",overflowY:"auto"},childGridCont:{display:"flex",flexDirection:"column"},childGridContWide:{height:"100%"},canDrop:e=>({backgroundColor:e.palette.background.default}),headContainer:{margin:10},blocksContainer:{overflowY:"auto",overflowX:"hidden"},userGroupCard2:e=>({border:"1px solid #FFF",borderColor:e.palette.divider,m:"10px",minHeight:150,backgroundColor:e.palette.background.default,color:e.palette.text.primary,transition:"all 200ms ease-out",opacity:1,overflow:"hidden","&:hover":{overflowY:"auto",boxShadow:"0 1px 1px 0 rgba(0, 0, 0, .4),0 6px 6px 0 rgba(0, 0, 0, .2)"}}),userGroupCardSecondary:e=>({color:e.palette.text.primary,backgroundColor:e.palette.success.light}),permHeaders:e=>({backgroundColor:"dark"===e.palette.mode?e.palette.background.default:e.palette.primary.main,p:"4px",borderRadius:"2px",color:"#EEE"}),userCardContent:{height:"100%",opacity:1},userGroupTitle:{display:"inline-flex",alignItems:"center"},userGroupUserName:{fontWeight:900,padding:5},userGroupUserID:{opacity:.7,padding:5},description:{fontSize:10,fontStyle:"italic",marginLeft:5,opacity:.7},userGroupMember:e=>({display:"inline-flex",m:"4px",p:"4px",backgroundColor:"#00000010",border:"1px solid #FFF",borderColor:e.palette.text.primary,color:e.palette.text.primary,alignItems:"center"}),icon:{height:32,width:32,marginRight:5,backgroundSize:"cover",backgroundPosition:"center"},right:{float:"right"},left:{float:"left",marginRight:10},dialog:{},flex:{display:"flex"},formControl:{display:"flex",padding:24,flexGrow:1e3},formContainer:{display:"flex",justifyContent:"center",alignItems:"center"},formIcon:{margin:10,opacity:.6},descriptionPanel:e=>({width:"100%",backgroundColor:"transparent",mb:"20px",mt:"20px",ml:"20px",opacity:.75,border:"none",display:"flex",alignItems:"center","& a":{pl:"3px",color:"dark"===e.palette.mode?"#EEE":"#111"}}),dialogTitle:{borderBottom:"1px solid #00000020",padding:0,width:"100%"},dialogActions:{borderTop:"1px solid #00000020",width:"100%"},dialogPaper:{overflowY:"initial",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:"calc(100% - 100px)",height:"calc(100% - 100px)",maxWidth:800,maxHeight:"100%"},dialogPaperMini:{maxHeight:300},colorPicker:{},iconPreview:{height:40,width:40},mainDescription:{fontSize:"200%"},deleteDialog:{padding:20},narrowContent:{padding:"8px 8px 8px 8px"}},P=()=>{const e=(0,a.gx)();return e.display?(0,m.jsx)("div",{style:e.style,children:e.item.preview}):null},F={_id:"system.user.",type:"user",common:{name:"",password:"",enabled:!0,color:"",desc:""},native:{},enums:{}},O={_id:void 0,native:{},type:"group",common:{name:"",desc:"",members:[],dontDelete:void 0,acl:{object:{list:!1,read:!1,write:!1,delete:!1,create:void 0},state:{list:!1,read:!1,write:!1,create:!1,delete:!1},users:{list:!1,read:!1,write:!1,create:!1,delete:!1},other:{execute:!1,http:!1,sendto:!1},file:{list:!1,read:!1,write:!1,create:!1,delete:!1}},icon:"",color:""}};class W extends o.Component{constructor(e){super(e),this.getText=e=>e&&("object"===typeof e?e[this.props.lang]||e.en||"":e||"")||"",this.showUserEditDialog=(e,s)=>{(e=i.Utils.clone(e)).common.password=e.common.password?E:"",this.setState({userEditDialog:e,userEditDialogNew:s})},this.showGroupEditDialog=(e,s)=>{e=i.Utils.clone(e),this.setState({groupEditDialog:e,groupEditDialogNew:s})},this.updateData=()=>{let e;return this.props.socket.getForeignObjects("system.user.*","user").then((s=>(e=Object.values(s).sort(((e,s)=>e._id>s._id?1:-1)),e.forEach((e=>{e.common&&e.common.description&&(e.common.desc||(e.common.desc=e.common.description),delete e.common.description)})),this.props.socket.getForeignObjects("system.group.*","group")))).then((s=>{const t=Object.values(s).sort(((e,s)=>e._id>s._id?1:-1));t.forEach((e=>{e.common&&e.common.description&&(e.common.desc||(e.common.desc=e.common.description),delete e.common.description)})),this.setState({groups:t,users:e})}))},this.changeUserFormData=e=>this.setState({userEditDialog:e}),this.changeGroupFormData=e=>this.setState({groupEditDialog:e}),this.saveUser=async e=>{const s=i.Utils.clone(this.state.userEditDialog),t=this.state.users.find((e=>e._id===s._id)),o=s.common.password&&s.common.password!==E?s.common.password:"";if(s.common.password=t?t.common.password:"",await this.props.socket.setObject(s._id,s),"object"===typeof this.state.userEditDialog&&e&&e!==this.state.userEditDialog._id)try{await this.props.socket.delObject(e);for(let t=0;t<this.state.groups.length;t++){const o=this.state.groups[t];if(o.common.members.includes(e)){const t=i.Utils.clone(o);t.common.members[t.common.members.indexOf(e)]=s._id,await this.props.socket.setObject(t._id,t)}}}catch(r){window.alert(`Cannot delete user: ${r}`)}if(o)try{await this.props.socket.changePassword(s._id,o)}catch(r){window.alert(`Cannot change password: ${r}`)}this.setState({userEditDialog:!1},(()=>this.updateData()))},this.saveGroup=async e=>{if("object"===typeof this.state.groupEditDialog){if(await this.props.socket.setObject(this.state.groupEditDialog._id,this.state.groupEditDialog),e&&e!==this.state.groupEditDialog._id)try{await this.props.socket.delObject(e)}catch(s){window.alert(`Cannot delete user: ${s}`)}this.setState({groupEditDialog:!1},(()=>this.updateData()))}},this.showUserDeleteDialog=e=>this.setState({userDeleteDialog:e}),this.showGroupDeleteDialog=e=>this.setState({groupDeleteDialog:e}),this.deleteUser=e=>{this.props.socket.delObject(e).then((()=>Promise.all(this.state.groups.map((s=>{if(s.common.members.includes(e)){const t=i.Utils.clone(s);return t.common.members.splice(t.common.members.indexOf(e),1),this.props.socket.setObject(t._id,t)}return Promise.resolve(null)}))))).catch((e=>window.alert(`Cannot delete user: ${e}`))).then((()=>{this.setState({userDeleteDialog:!1},(()=>this.updateData()))}))},this.deleteGroup=e=>this.props.socket.delObject(e).then((()=>this.setState({groupDeleteDialog:!1},(()=>this.updateData())))).catch((e=>window.alert(`Cannot delete user: ${e}`))),this.addUserToGroup=(e,s)=>{const t=this.state.groups.find((e=>e._id===s)),o=t.common.members;o.includes(e)||(o.push(e),this.props.socket.setObject(t._id,t).then((()=>this.updateData())).catch((e=>window.alert(`Cannot delete user: ${e}`))))},this.removeUserFromGroup=(e,s)=>{const t=this.state.groups.find((e=>e._id===s)),o=t.common.members;o.includes(e)&&(o.splice(o.indexOf(e),1),this.props.socket.setObject(t._id,t).then((()=>this.updateData())))},this.state={users:null,groups:null,userEditDialog:!1,userEditDialogNew:null,groupEditDialog:!1,groupEditDialogNew:null,userDeleteDialog:!1,groupDeleteDialog:!1,innerWidth:0}}componentDidMount(){this.setState({innerWidth:window.innerWidth},(()=>this.updateData()))}componentDidUpdate(){window.innerWidth!==this.state.innerWidth&&setTimeout((()=>this.setState({innerWidth:window.innerWidth})),100)}static _isUniqueName(e,s,t){return!e.find((e=>e._id===`system.user.${s.toLowerCase()}_${t}`||e.common.name===`${s} ${t}`))}static findNewUniqueName(e,s,t){let o=1;for(;!W._isUniqueName(s,t,o);)o++;return{_id:`system.${e?"group":"user"}.${t.toLowerCase()}_${o}`,name:`${t} ${o}`}}render(){return this.state.users&&this.state.groups?(0,m.jsxs)(r.Q,{backend:p.A.isTouchDevice()?l.qi:n.t2,children:[(0,m.jsx)(P,{}),(0,m.jsx)(d.Box,{component:"div",sx:S.descriptionPanel,children:this.props.t("You can drag users to groups.")}),(0,m.jsxs)(d.Grid2,{container:!0,spacing:2,style:S.mainGridCont,children:[(0,m.jsxs)(d.Grid2,{size:{xs:12,md:6},style:{...S.childGridCont,...this.state.innerWidth>600?S.childGridContWide:void 0},children:[(0,m.jsxs)("div",{style:S.headContainer,children:[(0,m.jsx)(d.Fab,{size:"small",style:S.right,onClick:()=>{const{_id:e,name:s}=W.findNewUniqueName(!0,this.state.groups,this.props.t("Group")),t=i.Utils.clone(O);t._id=e,t.common.name=s,this.showGroupEditDialog(t,!0)},children:(0,m.jsx)(c.GroupAdd,{})}),(0,m.jsx)(d.Typography,{gutterBottom:!0,variant:"h4",component:"h4",children:this.props.t("Groups")})]}),(0,m.jsx)("div",{style:S.blocksContainer,children:this.state.groups.sort(((e,s)=>{var t,o;const i=(this.getText(null===e||void 0===e||null===(t=e.common)||void 0===t?void 0:t.name)||e._id).toLowerCase(),r=(this.getText(null===s||void 0===s||null===(o=s.common)||void 0===o?void 0:o.name)||s._id).toLowerCase();return i>r?1:i<r?-1:0})).map((e=>(0,m.jsx)(v,{themeType:this.props.themeType,group:e,users:this.state.users,showGroupEditDialog:this.showGroupEditDialog,showGroupDeleteDialog:this.showGroupDeleteDialog,removeUserFromGroup:this.removeUserFromGroup,getText:this.getText,styles:S,...this.props},e._id)))})]}),(0,m.jsxs)(d.Grid2,{size:{xs:12,md:6},style:{...S.childGridCont,...this.state.innerWidth>600?S.childGridContWide:void 0},children:[(0,m.jsxs)("div",{style:S.headContainer,children:[(0,m.jsx)(d.Fab,{size:"small",style:S.right,onClick:()=>{const{_id:e,name:s}=W.findNewUniqueName(!1,this.state.users,this.props.t("User")),t=i.Utils.clone(F);t._id=e,t.common.name=s,this.showUserEditDialog(t,!0)},children:(0,m.jsx)(c.PersonAdd,{})}),(0,m.jsx)(d.Typography,{gutterBottom:!0,variant:"h4",component:"h4",children:this.props.t("Users")})]}),(0,m.jsx)("div",{style:S.blocksContainer,children:this.state.users.sort(((e,s)=>{var t,o;const i=(this.getText(null===e||void 0===e||null===(t=e.common)||void 0===t?void 0:t.name)||e._id).toLowerCase(),r=(this.getText(null===s||void 0===s||null===(o=s.common)||void 0===o?void 0:o.name)||s._id).toLowerCase();return i>r?1:i<r?-1:0})).map((e=>(0,m.jsx)(x,{themeType:this.props.themeType,user:e,groups:this.state.groups,showUserEditDialog:this.showUserEditDialog,showUserDeleteDialog:this.showUserDeleteDialog,updateData:this.updateData,addUserToGroup:this.addUserToGroup,removeUserFromGroup:this.removeUserFromGroup,getText:this.getText,styles:S,...this.props},e._id)))})]})]}),this.state.userEditDialog?(0,m.jsx)(D,{onClose:()=>this.setState({userEditDialog:!1}),users:this.state.users,user:this.state.userEditDialog,isNew:this.state.userEditDialogNew,t:this.props.t,getText:this.getText,styles:S,onChange:this.changeUserFormData,saveData:this.saveUser,innerWidth:this.state.innerWidth}):null,this.state.groupEditDialog?(0,m.jsx)(T,{onClose:()=>this.setState({groupEditDialog:!1}),groups:this.state.groups,group:this.state.groupEditDialog,isNew:this.state.groupEditDialogNew,t:this.props.t,getText:this.getText,styles:S,onChange:this.changeGroupFormData,innerWidth:this.state.innerWidth,saveData:this.saveGroup}):null,this.state.userDeleteDialog?(0,m.jsx)(U,{getText:this.getText,onClose:()=>this.setState({userDeleteDialog:!1}),user:this.state.userDeleteDialog,t:this.props.t,deleteUser:this.deleteUser}):null,this.state.groupDeleteDialog?(0,m.jsx)(I,{getText:this.getText,onClose:()=>this.setState({groupDeleteDialog:!1}),group:this.state.groupDeleteDialog,t:this.props.t,styles:S,deleteGroup:this.deleteGroup}):null]}):(0,m.jsx)(d.LinearProgress,{})}}const z=W;function N(e){return(0,m.jsx)(i.TabContainer,{children:(0,m.jsx)(i.TabContent,{style:{display:"flex",flexDirection:"column",overflow:"auto"},children:(0,m.jsx)(z,{t:e.t,lang:e.lang,socket:e.socket,ready:e.ready,expertMode:e.expertMode,themeType:e.themeType,theme:e.theme})})})}},94343:(e,s,t)=>{t.d(s,{gx:()=>a});var o=t(28437),i=t(35661),r=(e,s)=>({x:e.x-s.x,y:e.y-s.y}),n=(e,s)=>{let t=e.getClientOffset();if(null===t)return null;if(!s.current||!s.current.getBoundingClientRect)return r(t,(e=>{let s=e.getInitialClientOffset(),t=e.getInitialSourceClientOffset();return null===s||null===t?{x:0,y:0}:r(s,t)})(e));let o=s.current.getBoundingClientRect(),i={x:o.width/2,y:o.height/2};return r(t,i)},l=e=>{let s=`translate(${e.x.toFixed(1)}px, ${e.y.toFixed(1)}px)`;return{pointerEvents:"none",position:"fixed",top:0,left:0,transform:s,WebkitTransform:s}},a=()=>{let e=(0,o.useRef)(null),s=(0,i.V)((s=>({currentOffset:n(s,e),isDragging:s.isDragging(),itemType:s.getItemType(),item:s.getItem(),monitor:s})));return s.isDragging&&null!==s.currentOffset?{display:!0,itemType:s.itemType,item:s.item,style:l(s.currentOffset),monitor:s.monitor,ref:e}:{display:!1}};(0,o.createContext)(void 0)}}]);
//# sourceMappingURL=6361.9f85d501.chunk.js.map