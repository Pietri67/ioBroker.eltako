"use strict";(self.webpackChunksrc_rx=self.webpackChunksrc_rx||[]).push([[5687],{79313:(e,t,l)=>{l.d(t,{A:()=>d});var i=l(28437),o=l(89303),s=l(32075),n=l(16904),r=l(70579);const a={modalDialog:{minWidth:400,maxWidth:800},overflowHidden:{display:"flex",overflow:"hidden"},titleIcon:{marginRight:5},content:{fontSize:16},languageButton:{position:"absolute",right:8,top:8},languageButtonActive:e=>({color:e.palette.primary.main})},d=e=>{let{toggleTranslation:t,noTranslation:l,title:d,fullWidth:c,help:u,maxWidth:p,progress:h,icon:v,disableApplyIfNotChanged:f,applyButton:m,onClose:w,children:g,titleButtonApply:y,titleButtonClose:x,onApply:j,textInput:b,defaultValue:C,overflowHidden:k,disableApply:A,theme:S}=e;const[G,T]=(0,i.useState)(C);(0,i.useEffect)((()=>{T(C)}),[C]);let F=null;v&&(F=v);const I=n.Utils.getStyle(S,a.languageButtonActive);return(0,r.jsxs)(o.Dialog,{open:!0,maxWidth:p||"md",fullWidth:!!c,disableEscapeKeyDown:!1,onClose:w,sx:{"& .MuiPaper-root":a.modalDialog},children:[d&&(0,r.jsxs)(o.DialogTitle,{children:[v?(0,r.jsx)(F,{style:a.titleIcon}):null,d,"en"!==n.I18n.getLanguage()&&t?(0,r.jsx)(o.IconButton,{size:"large",style:{...a.languageButton,...l?I:void 0},onClick:()=>t(),title:n.I18n.t("Disable/Enable translation"),children:(0,r.jsx)(s.Language,{})}):null]}),(0,r.jsxs)(o.DialogContent,{style:{...k?a.overflowHidden:void 0,...a.content,paddingTop:8},children:[b&&(0,r.jsx)(o.TextField,{autoComplete:"off",fullWidth:!0,autoFocus:!0,variant:"standard",size:"medium",multiline:!0,value:G,onChange:e=>T(e.target.value),slotProps:{input:{endAdornment:G?(0,r.jsx)(o.InputAdornment,{position:"end",children:(0,r.jsx)(o.IconButton,{size:"small",onClick:()=>T(""),children:(0,r.jsx)(s.Close,{})})}):null}}}),g,u?(0,r.jsx)("div",{children:u}):null]}),(0,r.jsxs)(o.DialogActions,{children:[(void 0===m||m)&&(0,r.jsx)(o.Button,{startIcon:(0,r.jsx)(s.Check,{}),disabled:A||h||f&&C===G,onClick:()=>j&&j(b?G:""),variant:"contained",color:"primary",children:n.I18n.t(y||"Ok")}),(0,r.jsx)(o.Button,{color:"grey",onClick:w,disabled:h,variant:"contained",startIcon:(0,r.jsx)(s.Close,{}),children:n.I18n.t(x||"Cancel")})]})]})}},75687:(e,t,l)=>{l.r(t),l.d(t,{default:()=>C});var i=l(28437),o=l(89303),s=l(16904),n=l(26382),r=l(56603),a=(l(79335),l(46982)),d=l(70579);const c=r.require("ace/ext/modelist");class u extends s.FileViewerClass{constructor(e){super(e),this.writeFile64=()=>{const e=this.props.href.split("/"),t=this.state.editingValue;e.splice(0,2);const l=e[0],i=e.splice(1).join("/");this.props.socket.writeFile64(l,i,n.hp.from(t).toString("base64")).then((()=>this.props.onClose())).catch((e=>window.alert(`Cannot write file: ${e}`)))},Object.assign(this.state,{editing:!!this.props.formatEditFile||!1})}static getEditFile(e){switch(e){case"json":return"json";case"json5":return"json5";case"js":return"javascript";case"html":case"txt":return"html";default:return c.getModeForPath(`testFile.${e}`).mode.split("/").pop()}}getEditorOrViewer(){return(0,d.jsx)(a.A,{mode:u.getEditFile(this.props.formatEditFile),themeType:this.props.themeType,value:this.state.editingValue||this.state.code||this.state.text,onChange:this.state.editing?e=>this.setState({editingValue:e,changed:!0}):void 0})}onSave(){this.writeFile64()}}const p=(0,s.withWidth)()(u);var h=l(17774),v=l(79313);const f=[{Owner:[{name:"read",valueNum:1024,title:"read owner"},{name:"write",valueNum:512,title:"write owner"}]},{Group:[{name:"read",valueNum:64,title:"read group"},{name:"write",valueNum:32,title:"write group"}]},{Everyone:[{name:"read",valueNum:4,title:"read everyone"},{name:"write",valueNum:2,title:"write everyone"}]}],m=(e,t,l)=>(e|=t&l,e&=t|65535&~l),w=e=>{let{value:t,setValue:l,t:s,differentValues:n,applyToChildren:r,mask:a,setMask:c,disabled:u}=e;(0,i.useEffect)((()=>{if(r){let e=0;for(let l=0;l<n.length;l++)e|=t^n[l];c(e)}else c(0)}),[n,r,c,t]);let p=t;return(0,d.jsx)("div",{style:{display:"flex",width:"fit-content",margin:20,border:"1px solid",borderLeft:0},children:f.map((e=>{const i=Object.keys(e)[0];return(0,d.jsxs)("div",{style:{width:150,height:150,display:"flex",flexDirection:"column",alignItems:"center",borderLeft:"1px solid"},children:[(0,d.jsx)("div",{style:{height:50,display:"flex",alignItems:"center",fontSize:18,borderBottom:"1px solid silver",width:"100%",justifyContent:"center"},children:s(i)}),(0,d.jsx)("div",{style:{display:"flex",width:"100%"},children:e[i].map(((e,i)=>{let n=!1;const r=a&e.valueNum;return p-e.valueNum>=0&&(p-=e.valueNum,n=!0),(0,d.jsxs)("div",{style:{display:"flex",flexDirection:"column",flex:1,alignItems:"center",borderRight:0===i?"1px solid":0},children:[(0,d.jsx)("div",{style:{height:50,borderBottom:"1px solid",width:"100%",justifyContent:"center",display:"flex",alignItems:"center",color:"silver"},children:s(e.name)}),(0,d.jsx)("div",{style:{height:50,display:"flex"},children:(0,d.jsx)(o.Checkbox,{disabled:u,checked:n,color:r?"primary":"secondary",indeterminate:!!r,style:r?{opacity:.5}:void 0,onChange:i=>{r&&(a&=65535&~e.valueNum,c(a));let o=t;i.target.checked?o|=e.valueNum:o&=65535&~e.valueNum,l(o)}})})]},e.valueNum)}))})]},i)}))})};async function g(e,t,l){let i=t[e];if(!i){const o=e.split("/"),s=o.length,n=o.shift()||null,r=o.join("/"),a=await l.readDir(n,r);t[e]=[];for(let l=0;l<a.length;l++){const i=a[l],o={id:`${e}/${i.file}`,ext:h.A.getFileExtension(i.file),folder:i.isDir,name:i.file,size:i.stats&&i.stats.size,modified:i.modifiedAt,acl:i.acl,level:s};t[e].push(o)}i=t[e]}for(let o=0;o<i.length;o++){const e=i[o];e.folder&&await g(e.id,t,l)}}async function y(e,t,l){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if("string"===typeof l&&(l=l.split("/"),s=0,i=l.shift()||"",o=""),!(l.length>=s))if(t[i+o]){if(l.length-1===s){const n=`${i+o}/${l[s]}`,r=t[i+o].find((e=>e.id===n));return void(r&&r.folder&&await g(i+o,t,e))}o+=`/${l[s]}`,await y(e,t,l,i,o,s+1)}else{const n=await e.readDir(i||null,o);t[i+o]=[],n.forEach((e=>{const l={id:`${o}/${e.file}`,ext:h.A.getFileExtension(e.file),folder:e.isDir,name:e.file,size:e.stats&&e.stats.size,modified:e.modifiedAt,acl:e.acl,level:s};t[i+o].push(l)})),await y(e,t,l,i,o,s+1)}}const x="different",j=e=>{let{onClose:t,onApply:l,selected:n,applyChangesToObject:r,applyChangesToFile:a,objects:c,t:u,themeType:p,folders:h,socket:f,theme:g}=e;const j=n.substring(0,n.lastIndexOf("/"))||n,b=(1===n.split("/").length?h["/"].find((e=>{let{id:t}=e;return t===n})):h[j].find((e=>{let{id:t}=e;return t===n})))||{},[C,k]=(0,i.useState)(null),[A,S]=(0,i.useState)(null),[G,T]=(0,i.useState)([]),[F,I]=(0,i.useState)([]),[E,D]=(0,i.useState)(!1),[O,$]=(0,i.useState)(0),[B,N]=(0,i.useState)(null),[W,V]=(0,i.useState)(!1),[z,L]=(0,i.useState)(!1),[M,_]=(0,i.useState)([]),[P,H]=(0,i.useState)(0),[R,U]=(0,i.useState)([]),[q,K]=(0,i.useState)(!0),[Y,J]=(0,i.useState)(!1),Q=s.I18n.getLanguage();return(0,i.useEffect)((()=>{const e=[],t=b.id;let l=!1,i=!1,o=null,s=null,n=null;const r=[];let a=0;y(f,h,t).then((()=>{const d=function(e){const t={};return Object.keys(e).forEach((l=>{t[l]={folder:!0,id:l,level:0,name:l},e[l].forEach((e=>{t[e.id]=e}))})),t}(h),u=`${t}/`;Object.keys(d).forEach((p=>{if("/"!==p&&(p===t||p.startsWith(u)))if(!p.includes("/")&&c[p]){var h,v,f,m,w,g,y,x,j;const t=c[p];a++,r.push(t),null===n&&void 0!==(null===(h=t.acl)||void 0===h?void 0:h.file)&&(n=t.acl.file),null===o&&void 0!==(null===(v=t.acl)||void 0===v?void 0:v.owner)&&(o=t.acl.owner),null===s&&void 0!==(null===(f=t.acl)||void 0===f?void 0:f.ownerGroup)&&(s=t.acl.ownerGroup),W||o===(null===(m=t.acl)||void 0===m?void 0:m.owner)||void 0===(null===(w=t.acl)||void 0===w?void 0:w.owner)||(l=!0),z||s===(null===(g=t.acl)||void 0===g?void 0:g.ownerGroup)||void 0===(null===(y=t.acl)||void 0===y?void 0:y.ownerGroup)||(i=!0),void 0===(null===(x=t.acl)||void 0===x?void 0:x.file)||n===(null===(j=t.acl)||void 0===j?void 0:j.file)||e.includes(t.acl.file)||e.push(t.acl.file)}else if(!d[p].folder){a++;const t=d[p];r.push(t),null===n&&void 0!==t.acl.permissions&&(n=t.acl.permissions),null===o&&void 0!==t.acl.owner&&(o=t.acl.owner),null===s&&void 0!==t.acl.ownerGroup&&(s=t.acl.ownerGroup),W||o===t.acl.owner||void 0===t.acl.owner||(l=!0),z||s===t.acl.ownerGroup||void 0===t.acl.ownerGroup||(i=!0),void 0===t.acl.permissions||n===t.acl.permissions||e.includes(t.acl.permissions)||e.push(t.acl.permissions)}}));const p=[],v=[];Object.keys(c).forEach((e=>{const t=c[e];e.startsWith("system.group.")&&"group"===(null===t||void 0===t?void 0:t.type)?v.push(t):e.startsWith("system.user.")&&"user"===(null===t||void 0===t?void 0:t.type)&&p.push(t)}));const f=c["system.config"].common.defaultNewAcl;o=o||f.owner,s=s||f.ownerGroup,n=n||f.file,N(n),k(o),S(s),V(l),L(i),T(p),I(v),null!==b&&void 0!==b&&b.folder&&D(!0),$(a),_(e),U(r)}))}),[c,n]),(0,i.useEffect)((()=>{if(E)W&&C!==x&&k(x),z&&A!==x&&S(x);else{var e,t,l,i;if(C&&C===x)k((null===(e=c[n])||void 0===e||null===(t=e.acl)||void 0===t?void 0:t.owner)||null);if(A&&A===x)S((null===(l=c[n])||void 0===l||null===(i=l.acl)||void 0===i?void 0:i.ownerGroup)||null)}console.log(`stateOwnerUser ${C}`)}),[E,C,A,W,z]),R.length?(0,d.jsx)(v.A,{theme:g,titleButtonApply:"apply",overflowHidden:!0,disableApply:q,progress:Y,onClose:t,onApply:()=>{J(!0),setTimeout((async()=>{var e,t;const i=(null===(e=c["system.config"].common)||void 0===e||null===(t=e.defaultNewAcl)||void 0===t?void 0:t.file)||1636;if(E){const e=65535&~P;for(let t=0;t<R.length;t++){const l=R[t];let c=!1;const f=l,w=l;if(f._id){var o,s,n,d;const t=m((null===(o=f.acl)||void 0===o?void 0:o.file)||i,B,e);t!==(null===(s=f.acl)||void 0===s?void 0:s.file)&&(f.acl=f.acl||{},f.acl.file=t,c=!0),C!==x&&C!==(null===(n=f.acl)||void 0===n?void 0:n.owner)&&(f.acl=f.acl||{},f.acl.owner=C,c=!0),A!==x&&A!==(null===(d=f.acl)||void 0===d?void 0:d.ownerGroup)&&(f.acl=f.acl||{},f.acl.ownerGroup=A,c=!0);try{c&&await r(f)}catch(S){console.error(S)}}else if(w&&!w.folder){var u,p,h,v;const t={},l=m((null===(u=w.acl)||void 0===u?void 0:u.permissions)||i,B,e);if(l!==(null===(p=w.acl)||void 0===p?void 0:p.permissions)&&(t.permissions=l,c=!0),C!==x&&C!==(null===(h=w.acl)||void 0===h?void 0:h.owner)&&(t.owner=C,c=!0),A!==x&&A!==(null===(v=w.acl)||void 0===v?void 0:v.ownerGroup)&&(t.ownerGroup=A,c=!0),c){const e=w.id.split("/"),l=e.shift(),i=e.join("/");try{await a(l,i,t)}catch(S){console.error(S)}}}}}else{const e=b.id.split("/"),t=e.shift(),l=e.join("/"),i={};let o=!1;var f,w,g;if(b.folder){if(!e.length&&c[b.id]){var y,j,k;const e=c[b.id];(null===(y=e.acl)||void 0===y?void 0:y.file)!==B&&(e.acl=e.acl||{},e.acl.file=B,o=!0),(null===(j=e.acl)||void 0===j?void 0:j.owner)!==C&&(e.acl=e.acl||{},e.acl.owner=C,o=!0),(null===(k=e.acl)||void 0===k?void 0:k.ownerGroup)!==A&&(e.acl=e.acl||{},e.acl.ownerGroup=A,o=!0),o&&await r(e)}}else(null===(f=b.acl)||void 0===f?void 0:f.permissions)!==B&&(i.permissions=B,o=!0),(null===(w=b.acl)||void 0===w?void 0:w.owner)!==C&&(i.owner=C,o=!0),(null===(g=b.acl)||void 0===g?void 0:g.ownerGroup)!==A&&(i.ownerGroup=A,o=!0),o&&await a(t,l,i)}J(!1),l()}),200)},children:(0,d.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,d.jsx)("div",{style:{margin:10,fontSize:20},children:u("Access control list: %s",n)}),(0,d.jsxs)("div",{style:{display:"flex"},children:[(0,d.jsx)(s.SelectWithIcon,{fullWidth:!0,style:{marginRight:10},label:u("Owner user"),lang:Q,list:G,t:u,disabled:Y,value:C||void 0,themeType:p,different:!!W&&x,onChange:e=>{V(!1),k(e),K(!1)}}),(0,d.jsx)(s.SelectWithIcon,{fullWidth:!0,label:u("Owner group"),lang:Q,list:F,t:u,disabled:Y,value:A||void 0,themeType:p,different:!!z&&x,onChange:e=>{L(!1),S(e),K(!1)}})]}),(0,d.jsxs)("div",{style:{display:"flex",margin:10,alignItems:"center",fontSize:10,marginLeft:0,color:"silver"},children:[(0,d.jsx)("div",{style:b.folder&&E?void 0:{color:"green"},children:u("to apply one item")}),(0,d.jsx)(o.Switch,{disabled:1===R.length||Y,checked:!c[b.id]&&!!b.folder||E,onChange:e=>{D(e.target.checked),K(!1)},color:"primary"}),(0,d.jsxs)("div",{style:b.folder||E?{color:"green"}:void 0,children:[u("to apply with children")," ",b.folder||O>1?`(${O} ${u("object(s)")})`:""]})]}),Y&&(0,d.jsx)(o.LinearProgress,{}),(0,d.jsx)("div",{style:{overflowY:"auto"},children:(0,d.jsxs)("div",{children:[(0,d.jsx)("h2",{children:u("File rights")}),(0,d.jsx)(w,{disabled:Y,mask:P,setMask:H,applyToChildren:E,differentValues:M,t:u,setValue:e=>{N(e),K(!1)},value:B})]})})]})}):(0,d.jsx)(o.LinearProgress,{})};class b extends i.Component{constructor(e){super(e),this.t=void 0,this.wordCache=void 0,this.objects=void 0,this.translate=(e,t,l)=>void 0!==t?this.props.t(e,t,l):(this.wordCache[e]||(this.wordCache[e]=this.props.t(e)),this.wordCache[e]),this.t=this.translate,this.wordCache={},this.objects={}}componentDidMount(){this.props.socket.getObjects(!0,!0).then((e=>this.objects=e))}renderAclDialog(e){return(0,d.jsx)(j,{theme:this.props.theme,themeType:this.props.themeType,applyChangesToObject:async t=>{const l=await this.props.socket.getObject(t._id);l.acl=t.acl,await this.props.socket.setObject(l._id,l);const i=l;null!==i&&void 0!==i&&i.acl&&e.updateItemsAcl([{id:i._id,acl:i.acl,level:0,name:i._id,folder:!1}])},applyChangesToFile:async(t,l,i)=>{let o;if((i.owner||i.ownerGroup)&&i.permissions?(await this.props.socket.chownFile(t,l,{owner:i.owner,ownerGroup:i.ownerGroup}),o=await this.props.socket.chmodFile(t,l,{mode:i.permissions})):i.permissions?o=await this.props.socket.chmodFile(t,l,{mode:i.permissions}):(i.owner||i.ownerGroup)&&(o=await this.props.socket.chownFile(t,l,{owner:i.owner,ownerGroup:i.ownerGroup})),Array.isArray(o))for(let s=0;s<o.length;s++){const l=o[s];l&&l.file&&l.acl&&e.updateItemsAcl([{id:`${t}/${l.path?`${l.path}/`:""}${l.file}`,acl:l.acl,level:0,name:"",folder:!1}])}},selected:e.state.selected,folders:e.state.folders,objects:this.objects,socket:this.props.socket,t:this.t,onClose:()=>e.setState({modalEditOfAccess:!1}),onApply:()=>e.setState({modalEditOfAccess:!1})})}render(){return this.props.ready?(0,d.jsx)(s.TabContainer,{children:(0,d.jsx)(s.TabContent,{overflow:"auto",children:(0,d.jsx)(s.FileBrowser,{showViewTypeButton:!0,ready:this.props.ready,socket:this.props.socket,themeType:this.props.themeType,theme:this.props.theme,lang:this.props.lang,t:this.props.t,showToolbar:!0,allowUpload:!0,allowView:!0,allowDownload:!0,allowCreateFolder:!0,allowDelete:!0,expertMode:this.props.expertMode,modalEditOfAccessControl:e=>this.renderAclDialog(e),FileViewer:p})})}):(0,d.jsx)(o.LinearProgress,{})}}const C=b}}]);
//# sourceMappingURL=5687.9f372fe2.chunk.js.map