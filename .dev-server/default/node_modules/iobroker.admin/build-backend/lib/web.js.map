{"version":3,"file":"web.js","sourceRoot":"","sources":["../../src/lib/web.ts"],"names":[],"mappings":"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","sourcesContent":["import { commonTools, EXIT_CODES } from '@iobroker/adapter-core';\nimport * as IoBWebServer from '@iobroker/webserver';\nimport * as express from 'express';\nimport type { Express, Response, Request, NextFunction } from 'express';\nimport type { Server } from 'node:http';\nimport { readFileSync, existsSync, createReadStream, readdirSync, lstatSync } from 'node:fs';\nimport { inherits } from 'util';\nimport { join, normalize, parse, dirname } from 'node:path';\nimport { Transform } from 'node:stream';\nimport * as compression from 'compression';\nimport * as mime from 'mime';\nimport { gunzipSync } from 'node:zlib';\nimport * as archiver from 'archiver';\nimport axios from 'axios';\nimport { Ajv } from 'ajv';\nimport { parse as JSON5 } from 'json5';\nimport * as passport from 'passport';\nimport * as fileUpload from 'express-fileupload';\nimport { Strategy } from 'passport-local';\n\nimport type { Store } from 'express-session';\nimport * as session from 'express-session';\nimport * as bodyParser from 'body-parser';\nimport * as cookieParser from 'cookie-parser';\n\nexport interface AdminAdapterConfig extends ioBroker.AdapterConfig {\n    accessAllowedConfigs: string[];\n    accessAllowedTabs: string[];\n    accessApplyRights: boolean;\n    accessLimit: boolean;\n    auth: boolean;\n    autoUpdate: number;\n    bind: string;\n    cache: boolean;\n    certChained: string;\n    certPrivate: string;\n    certPublic: string;\n    defaultUser: string;\n    doNotCheckPublicIP: boolean;\n    language: ioBroker.Languages;\n    leCollection: boolean;\n    loadingBackgroundColor: string;\n    loadingBackgroundImage: boolean;\n    loadingHideLogo: boolean;\n    loginBackgroundColor: string;\n    loginBackgroundImage: boolean;\n    loginHideLogo: boolean;\n    loginMotto: string;\n    port: number;\n    secure: boolean;\n    thresholdValue: number;\n    tmpPath: string;\n    tmpPathAllow: boolean;\n    ttl: number;\n    reverseProxy: {\n        globalPath: string;\n        paths: { path: string; instance: string }[];\n    }[];\n}\n\nlet AdapterStore;\n/** Content of a socket-io file */\nlet socketIoFile: false | string;\n/** UUID of the installation */\nlet uuid: string;\nconst page404 = readFileSync(`${__dirname}/../../public/404.html`).toString('utf8');\nconst logTemplate = readFileSync(`${__dirname}/../../public/logTemplate.html`).toString('utf8');\n// const FORBIDDEN_CHARS = /[\\]\\[*,;'\"`<>\\\\\\s?]/g; // with space\nconst ONE_MONTH_SEC = 30 * 24 * 3_600;\n\n// copied from here: https://github.com/component/escape-html/blob/master/index.js\nconst matchHtmlRegExp = /[\"'&<>]/;\nfunction escapeHtml(string: string): string {\n    const str = `${string}`;\n    const match = matchHtmlRegExp.exec(str);\n\n    if (!match) {\n        return str;\n    }\n\n    let escape;\n    let html = '';\n    let index;\n    let lastIndex = 0;\n\n    for (index = match.index; index < str.length; index++) {\n        switch (str.charCodeAt(index)) {\n            case 34: // \"\n                escape = '&quot;';\n                break;\n            case 38: // &\n                escape = '&amp;';\n                break;\n            case 39: // '\n                escape = '&#39;';\n                break;\n            case 60: // <\n                escape = '&lt;';\n                break;\n            case 62: // >\n                escape = '&gt;';\n                break;\n            default:\n                continue;\n        }\n\n        if (lastIndex !== index) {\n            html += str.substring(lastIndex, index);\n        }\n\n        lastIndex = index + 1;\n        html += escape;\n    }\n\n    return lastIndex !== index ? html + str.substring(lastIndex, index) : html;\n}\n\nfunction isLocalUrl(path: string): boolean {\n    try {\n        return new URL(path, 'http://127.0.0.1:3000').origin === 'http://127.0.0.1:3000';\n    } catch {\n        return false;\n    }\n}\n\nfunction get404Page(customText?: string): string {\n    if (customText) {\n        return page404.replace('<div class=\"custom-message\"></div>', `<div class=\"custom-message\">${customText}</div>`);\n    }\n\n    return page404;\n}\n\n/**\n * Read folder recursive\n *\n * @param adapter the adapter instance\n * @param adapterName name of the adapter or dir\n * @param url url of the specific file or directory\n */\nasync function readFolderRecursive(\n    adapter: AdminAdapter,\n    adapterName: string,\n    url: string,\n): Promise<{ name: string; file: Buffer }[]> {\n    const filesOfDir = [];\n    const fileMetas = await adapter.readDirAsync(adapterName, url);\n    for (const fileMeta of fileMetas) {\n        if (!fileMeta.isDir) {\n            const file = await adapter.readFileAsync(adapterName, `${url}/${fileMeta.file}`);\n\n            if (file.file instanceof Buffer) {\n                filesOfDir.push({ name: url ? `${url}/${fileMeta.file}` : fileMeta.file, file: file.file });\n            } else {\n                filesOfDir.push({\n                    name: url ? `${url}/${fileMeta.file}` : fileMeta.file,\n                    file: Buffer.from(file.file as string, 'utf-8'),\n                });\n            }\n        } else {\n            filesOfDir.push(...(await readFolderRecursive(adapter, adapterName, `${url}/${fileMeta.file}`)));\n        }\n    }\n\n    return filesOfDir;\n}\n\nfunction MemoryWriteStream(): void {\n    Transform.call(this);\n    this._chunks = [];\n    this._transform = (chunk: unknown, enc: unknown, cb: () => void): void => {\n        this._chunks.push(chunk);\n        cb();\n    };\n    this.collect = (): unknown => {\n        const result = Buffer.concat(this._chunks);\n        this._chunks = [];\n        return result;\n    };\n}\ninherits(MemoryWriteStream, Transform);\n\ninterface WebOptions {\n    systemLanguage: ioBroker.Languages;\n}\n\ninterface AdminAdapter extends ioBroker.Adapter {\n    secret: string;\n    config: AdminAdapterConfig;\n}\n\n/**\n * Webserver class\n */\nclass Web {\n    // eslint-disable-next-line @typescript-eslint/consistent-type-imports\n    server: {\n        app: null | Express;\n        server: null | (Server & { __server: { app: null | Express; server: null | Server } });\n    } = {\n        app: null,\n        server: null,\n    };\n\n    // todo delete after react will be main\n    private readonly LOGIN_PAGE = '/index.html?login';\n\n    /** URL to the JSON config schema */\n    private readonly JSON_CONFIG_SCHEMA_URL =\n        'https://raw.githubusercontent.com/ioBroker/adapter-react-v5/main/schemas/jsonConfig.json';\n\n    private bruteForce: Record<string, { errors: number; time?: number }> = {};\n    private store: unknown = null;\n    private indexHTML: string;\n    baseDir = join(__dirname, '..', '..');\n    dirName = normalize(`${this.baseDir}/admin/`.replace(/\\\\/g, '/')).replace(/\\\\/g, '/');\n    private unprotectedFiles: { name: string; isDir: boolean }[];\n    systemConfig: Partial<ioBroker.SystemConfigObject>;\n\n    // todo delete after React will be main\n    wwwDir = join(this.baseDir, 'adminWww');\n\n    private settings: AdminAdapterConfig;\n    private readonly adapter: AdminAdapter;\n    private options: WebOptions;\n    private readonly onReady: (server: unknown, store: unknown, adapter: AdminAdapter) => void;\n    private systemLanguage: ioBroker.Languages;\n    private checkTimeout: ioBroker.Timeout;\n\n    /**\n     * Create a new instance of Web\n     *\n     * @param settings settings of the adapter\n     * @param adapter instance of the adapter\n     * @param onReady callback when the server is ready\n     * @param options options for the webserver\n     */\n    constructor(\n        settings: AdminAdapterConfig,\n        adapter: AdminAdapter,\n        onReady: (server: unknown, store: unknown, adapter: AdminAdapter) => void,\n        options: WebOptions,\n    ) {\n        this.settings = settings;\n        this.adapter = adapter;\n        this.onReady = onReady;\n        this.options = options;\n\n        this.systemLanguage = this.options?.systemLanguage || 'en';\n\n        void this.#init();\n    }\n\n    decorateLogFile(fileName: string, text?: string): string {\n        const log = text || readFileSync(fileName).toString();\n        return logTemplate.replace('@@title@@', parse(fileName).name).replace('@@body@@', log);\n    }\n\n    setLanguage(lang: ioBroker.Languages): void {\n        this.systemLanguage = lang;\n    }\n\n    close(): void {\n        if (this.checkTimeout) {\n            this.adapter.clearTimeout(this.checkTimeout);\n            this.checkTimeout = null;\n        }\n\n        void this.adapter.setState('info.connection', false, true);\n        this.server.server?.close();\n    }\n\n    prepareIndex(): string {\n        let template = readFileSync(join(this.wwwDir, 'index.html')).toString('utf8');\n        const m = template.match(/([\"']?@@\\w+@@[\"']?)/g);\n        m.forEach(pattern => {\n            pattern = pattern.replace(/@/g, '').replace(/'/g, '').replace(/\"/g, '');\n            if (pattern === 'disableDataReporting') {\n                template = template.replace(\n                    /['\"]@@disableDataReporting@@[\"']/g,\n                    // @ts-expect-error deprecated: this is not used on instance objects use system.adapter.xy.plugins.sentry.enabled\n                    this.adapter.common?.disableDataReporting ? 'true' : 'false',\n                );\n            } else if (pattern === 'loginBackgroundImage') {\n                if (this.adapter.config.loginBackgroundImage) {\n                    template = template.replace(\n                        '@@loginBackgroundImage@@',\n                        `files/${this.adapter.namespace}/login-bg.png`,\n                    );\n                } else {\n                    template = template.replace('@@loginBackgroundImage@@', '');\n                }\n            } else if (pattern === 'loginBackgroundColor') {\n                template = template.replace(\n                    '@@loginBackgroundColor@@',\n                    this.adapter.config.loginBackgroundColor || 'inherit',\n                );\n            } else if (pattern === 'loadingBackgroundImage') {\n                if (this.adapter.config.loadingBackgroundImage) {\n                    template = template.replace(\n                        '@@loadingBackgroundImage@@',\n                        `files/${this.adapter.namespace}/loading-bg.png`,\n                    );\n                } else {\n                    template = template.replace('@@loadingBackgroundImage@@', '');\n                }\n            } else if (pattern === 'loadingBackgroundColor') {\n                template = template.replace(\n                    '@@loadingBackgroundColor@@',\n                    this.adapter.config.loadingBackgroundColor || '',\n                );\n            } else if (pattern === 'vendorPrefix') {\n                template = template.replace(\n                    `@@vendorPrefix@@`,\n                    this.systemConfig.native.vendor.uuidPrefix || (uuid.length > 36 ? uuid.substring(0, 2) : ''),\n                );\n            } else if (pattern === 'loginMotto') {\n                template = template.replace(\n                    `@@loginMotto@@`,\n                    this.systemConfig.native.vendor.admin.login.motto || this.adapter.config.loginMotto || '',\n                );\n            } else if (pattern === 'loginLogo') {\n                template = template.replace(`@@loginLogo@@`, this.systemConfig.native.vendor.icon || '');\n            } else if (pattern === 'loginLink') {\n                template = template.replace(`@@loginLink@@`, this.systemConfig.native.vendor.admin.login.link || '');\n            } else if (pattern === 'loginTitle') {\n                template = template.replace(`@@loginTitle@@`, this.systemConfig.native.vendor.admin.login.title || '');\n            } else {\n                template = template.replace(\n                    `@@${pattern}@@`,\n                    (this.adapter.config as Record<string, any>)[pattern] !== undefined\n                        ? (this.adapter.config as Record<string, any>)[pattern]\n                        : '',\n                );\n            }\n        });\n\n        return template;\n    }\n\n    getInfoJs(): string {\n        const result = [`window.sysLang = \"${this.systemLanguage}\";`];\n\n        return result.join('\\n');\n    }\n\n    getErrorRedirect(origin: string): string {\n        // LOGIN_PAGE /index.html?login\n        // origin can be \"?login&href=\" -\n        // or \"/?login&href=\" -\n        //\n        if (origin) {\n            const parts = origin.split('&');\n            if (!parts.includes('error')) {\n                parts.splice(1, 0, 'error');\n                origin = parts.join('&');\n            }\n            if (origin.startsWith('?login')) {\n                return this.LOGIN_PAGE + origin.substring(6);\n            }\n            if (origin.startsWith('/?login')) {\n                return this.LOGIN_PAGE + origin.substring(7);\n            }\n            if (origin.startsWith(this.LOGIN_PAGE)) {\n                return origin;\n            }\n            return this.LOGIN_PAGE + origin;\n        }\n        return `${this.LOGIN_PAGE}?error`;\n    }\n\n    /**\n     * Validate, al JSON configs from alla adapters against the current schema\n     *\n     * @param adapterName name of the adapter\n     */\n    async validateJsonConfig(adapterName: string): Promise<void> {\n        let schema: Record<string, any> | null = null;\n\n        try {\n            const schemaRes = await axios.get(this.JSON_CONFIG_SCHEMA_URL);\n            schema = schemaRes.data as Record<string, any>;\n        } catch (e) {\n            this.adapter.log.debug(`Could not get jsonConfig schema: ${e.message}`);\n            return;\n        }\n\n        const res: ioBroker.AdapterObject | null = await this.adapter.getForeignObjectAsync<`system.adapter.${string}`>(\n            `system.adapter.${adapterName}`,\n        );\n\n        // @ts-expect-error fixed in js-controller 7.x\n        if (res?.common.adminUI?.config === 'json') {\n            try {\n                const ajv = new Ajv({\n                    allErrors: false,\n                    strict: 'log',\n                });\n\n                const adapterPath = dirname(require.resolve(`iobroker.${adapterName}/package.json`));\n\n                const jsonConfPath = join(adapterPath, 'admin', 'jsonConfig.json');\n                const json5ConfPath = join(adapterPath, 'admin', 'jsonConfig.json5');\n                let jsonConf: string;\n\n                if (existsSync(jsonConfPath)) {\n                    jsonConf = readFileSync(jsonConfPath, {\n                        encoding: 'utf-8',\n                    });\n                } else {\n                    jsonConf = readFileSync(json5ConfPath, {\n                        encoding: 'utf-8',\n                    });\n                }\n\n                const validate = ajv.compile(schema);\n                const valid = validate(JSON5(jsonConf));\n\n                if (!valid) {\n                    this.adapter.log.warn(\n                        `${adapterName} has an invalid jsonConfig: ${JSON.stringify(validate.errors)}`,\n                    );\n                }\n            } catch (e) {\n                this.adapter.log.debug(`Error validating schema of ${adapterName}: ${e.message}`);\n            }\n        }\n    }\n\n    unzipFile(fileName: string, data: string, res: Response): void {\n        // extract the file\n        try {\n            const text = gunzipSync(data).toString('utf8');\n            if (text.length > 2 * 1024 * 1024) {\n                res.header('Content-Type', 'text/plain');\n                res.send(text);\n            } else {\n                res.header('Content-Type', 'text/html');\n                res.send(this.decorateLogFile(fileName, text));\n            }\n        } catch (e) {\n            res.header('Content-Type', 'application/gzip');\n            res.send(data);\n            this.adapter.log.error(`Cannot extract file ${fileName}: ${e}`);\n        }\n    }\n\n    /**\n     * Initialize the server\n     */\n    async #init(): Promise<void> {\n        if (this.settings.port) {\n            this.server.app = express();\n            this.server.app.use(compression());\n\n            this.settings.ttl = Math.round(this.settings.ttl) || 3_600;\n            this.settings.accessAllowedConfigs = this.settings.accessAllowedConfigs || [];\n            this.settings.accessAllowedTabs = this.settings.accessAllowedTabs || [];\n\n            this.server.app.disable('x-powered-by');\n\n            // enable use of i-frames together with HTTPS\n            this.server.app.get('/*', (_req: Request, res: Response, next: NextFunction): void => {\n                res.header('X-Frame-Options', 'SAMEORIGIN');\n                next(); // http://expressjs.com/guide.html#passing-route control\n            });\n\n            // ONLY for DEBUG\n            /*server.app.use((req: Request, res: Response, next: NextFunction): void => {\n                res.header('Access-Control-Allow-Origin', '*');\n                res.header('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Accept');\n                next();\n            });*/\n\n            this.server.app.get('/version', (_req: Request, res: Response): void => {\n                res.status(200).send(this.adapter.version);\n            });\n\n            // replace socket.io\n            this.server.app.use((req: Request, res: Response, next: NextFunction): void => {\n                // return favicon always\n                if (req.url === '/favicon.ico') {\n                    res.set('Content-Type', 'image/x-icon');\n                    if (this.systemConfig.native.vendor.ico) {\n                        // convert base64 to ico\n                        const text = this.systemConfig.native.vendor.ico.split(',')[1];\n                        res.send(Buffer.from(text, 'base64'));\n                        return;\n                    }\n\n                    res.send(readFileSync(join(this.wwwDir, 'favicon.ico')));\n                    return;\n                } else if (\n                    socketIoFile !== false &&\n                    (req.url.startsWith('socket.io.js') || req.url.match(/\\/socket\\.io\\.js(\\?.*)?$/))\n                ) {\n                    if (socketIoFile) {\n                        res.contentType('text/javascript');\n                        res.status(200).send(socketIoFile);\n                        return;\n                    }\n                    socketIoFile = readFileSync(join(this.wwwDir, 'lib', 'js', 'socket.io.js'), {\n                        encoding: 'utf-8',\n                    });\n                    if (socketIoFile) {\n                        res.contentType('text/javascript');\n                        res.status(200).send(socketIoFile);\n                        return;\n                    }\n                    socketIoFile = false;\n                    res.status(404).send(get404Page());\n                    return;\n                }\n                next();\n            });\n\n            this.server.app.get('*/_socket/info.js', (_req: Request, res: Response): void => {\n                res.set('Content-Type', 'application/javascript');\n                res.status(200).send(this.getInfoJs());\n            });\n\n            if (this.settings.auth) {\n                AdapterStore = commonTools.session(session, this.settings.ttl);\n                const flash = await import('connect-flash');\n                this.store = new AdapterStore({ adapter: this.adapter });\n\n                passport.use(\n                    new Strategy(\n                        (\n                            username: string,\n                            password: string,\n                            done: (error: any, user?: string | false) => void,\n                        ): void => {\n                            username = (username || '').toString();\n\n                            if (this.bruteForce[username] && this.bruteForce[username].errors > 4) {\n                                let minutes = new Date().getTime() - this.bruteForce[username].time;\n                                if (this.bruteForce[username].errors < 7) {\n                                    if (new Date().getTime() - this.bruteForce[username].time < 60_000) {\n                                        minutes = 1;\n                                    } else {\n                                        minutes = 0;\n                                    }\n                                } else if (this.bruteForce[username].errors < 10) {\n                                    if (new Date().getTime() - this.bruteForce[username].time < 180_000) {\n                                        minutes = Math.ceil((180_000 - minutes) / 60000);\n                                    } else {\n                                        minutes = 0;\n                                    }\n                                } else if (this.bruteForce[username].errors < 15) {\n                                    if (new Date().getTime() - this.bruteForce[username].time < 600_000) {\n                                        minutes = Math.ceil((60_0000 - minutes) / 60_000);\n                                    } else {\n                                        minutes = 0;\n                                    }\n                                } else if (new Date().getTime() - this.bruteForce[username].time < 3_600_000) {\n                                    minutes = Math.ceil((3_600_000 - minutes) / 60_000);\n                                } else {\n                                    minutes = 0;\n                                }\n\n                                if (minutes) {\n                                    return done(\n                                        `Too many errors. Try again in ${minutes} ${minutes === 1 ? 'minute' : 'minutes'}.`,\n                                        false,\n                                    );\n                                }\n                            }\n\n                            const mayBePromise = this.adapter.checkPassword(\n                                username,\n                                password,\n                                (res: boolean, user: string): void => {\n                                    if (!res) {\n                                        this.bruteForce[username] = this.bruteForce[username] || { errors: 0 };\n                                        this.bruteForce[username].time = new Date().getTime();\n                                        this.bruteForce[username].errors++;\n                                    } else if (this.bruteForce[username]) {\n                                        delete this.bruteForce[username];\n                                    }\n\n                                    if (res) {\n                                        return done(null, (user || username).replace(/^system\\.user\\./, ''));\n                                    }\n                                    return done(null, false);\n                                },\n                            );\n\n                            if (mayBePromise instanceof Promise) {\n                                mayBePromise.catch(e => {\n                                    this.adapter.log.error(`Cannot check password: ${e}`);\n                                    done(null, false);\n                                });\n                            }\n                        },\n                    ),\n                );\n\n                passport.serializeUser((user, done) => done(null, user));\n\n                passport.deserializeUser((user, done) => done(null, user));\n\n                this.server.app.use(cookieParser());\n                this.server.app.use(bodyParser.urlencoded({ extended: true }));\n                this.server.app.use(bodyParser.json());\n                this.server.app.use(\n                    session({\n                        secret: this.adapter.secret,\n                        saveUninitialized: true,\n                        resave: true,\n                        cookie: { maxAge: this.settings.ttl * 1000 },\n                        // rolling: true, // The expiration is reset to the original maxAge, resetting the expiration countdown.\n                        store: this.store as Store,\n                    }),\n                );\n                this.server.app.use(passport.initialize());\n                this.server.app.use(passport.session());\n                this.server.app.use(flash());\n\n                this.server.app.post('/login', (req: Request, res: Response, next: NextFunction): void => {\n                    let redirect = '/';\n                    req.body = req.body || {};\n                    const isDev = req.url.includes('?dev&');\n\n                    const origin = (req.body.origin || '?href=%2F').trim();\n                    if (origin) {\n                        const parts = origin.split('href=');\n                        if (parts?.length > 1 && parts[1]) {\n                            redirect = decodeURIComponent(parts[1]);\n                            // if some invalid characters in redirect\n                            if (redirect.match(/[^-_a-zA-Z0-9&%?./]/) || !isLocalUrl(redirect)) {\n                                redirect = '/';\n                            }\n                        } else {\n                            // extract pathname\n                            redirect = origin.split('?')[0] || '/';\n                        }\n                    }\n                    req.body.password = (req.body.password || '').toString();\n                    req.body.username = (req.body.username || '').toString();\n                    req.body.stayLoggedIn =\n                        req.body.stayloggedin === 'true' ||\n                        req.body.stayloggedin === true ||\n                        req.body.stayloggedin === 'on';\n\n                    passport.authenticate('local', (err: Error | null, user: string): void => {\n                        if (err) {\n                            this.adapter.log.warn(`Cannot login user: ${err.message}`);\n                            return res.redirect(this.getErrorRedirect(origin));\n                        }\n                        if (!user) {\n                            return res.redirect(this.getErrorRedirect(origin));\n                        }\n                        req.logIn(user, err => {\n                            if (err) {\n                                this.adapter.log.warn(`Cannot login user: ${err}`);\n                                return res.redirect(this.getErrorRedirect(origin));\n                            }\n\n                            if (req.body.stayLoggedIn) {\n                                req.session.cookie.httpOnly = true;\n                                // https://www.npmjs.com/package/express-session#cookiemaxage-1\n                                // Interval in ms\n                                req.session.cookie.maxAge =\n                                    (this.settings.ttl > ONE_MONTH_SEC ? this.settings.ttl : ONE_MONTH_SEC) * 1000;\n                            } else {\n                                req.session.cookie.httpOnly = true;\n                                // https://www.npmjs.com/package/express-session#cookiemaxage-1\n                                // Interval in ms\n                                req.session.cookie.maxAge = this.settings.ttl * 1000;\n                            }\n\n                            if (isDev) {\n                                return res.redirect(`http://127.0.0.1:3000${redirect}`);\n                            }\n\n                            return res.redirect(redirect);\n                        });\n                    })(req, res, next);\n                });\n\n                this.server.app.get('/session', (req: Request, res: Response): void => {\n                    res.json({ expireInSec: Math.round(req.session.cookie.maxAge / 1_000) });\n                });\n\n                this.server.app.get('/logout', (req: Request, res: Response): void => {\n                    const isDev = req.url.includes('?dev');\n                    let origin = req.url.split('origin=')[1];\n                    if (origin) {\n                        const pos = origin.lastIndexOf('/');\n                        if (pos !== -1) {\n                            origin = origin.substring(0, pos);\n                        }\n                    }\n\n                    req.logout((): void => {\n                        if (isDev) {\n                            res.redirect('http://127.0.0.1:3000/index.html?login');\n                        } else {\n                            res.redirect(origin ? origin + this.LOGIN_PAGE : this.LOGIN_PAGE);\n                        }\n                    });\n                });\n\n                // route middleware to make sure a user is logged in\n                this.server.app.use((req: Request, res: Response, next: NextFunction): void => {\n                    // return favicon always\n                    if (req.url === '/favicon.ico') {\n                        res.set('Content-Type', 'image/x-icon');\n                        if (this.systemConfig.native.vendor.ico) {\n                            // convert base64 to ico\n                            const text = this.systemConfig.native.vendor.ico.split(',')[1];\n                            res.send(Buffer.from(text, 'base64'));\n                            return;\n                        }\n                        res.send(readFileSync(join(this.wwwDir, 'favicon.ico')));\n                        return;\n                    }\n                    if (/admin\\.\\d+\\/login-bg\\.png(\\?.*)?$/.test(req.originalUrl)) {\n                        // Read the names of files for gong\n                        this.adapter.readFile(this.adapter.namespace, 'login-bg.png', null, (err, file): void => {\n                            if (!err && file) {\n                                res.set('Content-Type', 'image/png');\n                                res.status(200).send(file);\n                            } else {\n                                res.status(404).send(get404Page());\n                            }\n                        });\n                        return;\n                    }\n                    if (!req.isAuthenticated()) {\n                        if (/^\\/login\\//.test(req.originalUrl) || /\\.ico(\\?.*)?$/.test(req.originalUrl)) {\n                            return next();\n                        }\n                        const pathName = req.url.split('?')[0];\n                        // protect all paths except\n                        this.unprotectedFiles =\n                            this.unprotectedFiles ||\n                            readdirSync(this.wwwDir).map(file => {\n                                const stat = lstatSync(join(this.wwwDir, file));\n                                return { name: file, isDir: stat.isDirectory() };\n                            });\n                        if (\n                            pathName &&\n                            pathName !== '/' &&\n                            !this.unprotectedFiles.find(file =>\n                                file.isDir ? pathName.startsWith(`/${file.name}/`) : `/${file.name}` === pathName,\n                            )\n                        ) {\n                            res.redirect(`${this.LOGIN_PAGE}&href=${encodeURIComponent(req.originalUrl)}`);\n                        } else {\n                            next();\n                            return;\n                        }\n                    } else {\n                        next();\n                        return;\n                    }\n                });\n            } else {\n                this.server.app.get('/logout', (_req: Request, res: Response): void => res.redirect('/'));\n            }\n\n            this.server.app.get('/iobroker_check.html', (_req: Request, res: Response): void => {\n                res.status(200).send('ioBroker');\n            });\n\n            this.server.app.get('/validate_config/*', async (req: Request, res: Response): Promise<void> => {\n                const adapterName = req.url.split('/').pop();\n\n                await this.validateJsonConfig(adapterName.toLowerCase());\n\n                res.status(200).send('validated');\n            });\n\n            // send log files\n            this.server.app.get('/log/*', (req: Request, res: Response): void => {\n                let parts = decodeURIComponent(req.url).split('/');\n                if (parts.length === 5) {\n                    // remove first \"/\"\n                    parts.shift();\n                    // remove \"log\"\n                    parts.shift();\n                    const [host, transport] = parts;\n                    parts = parts.splice(2);\n                    const fileName = parts.join('/');\n                    if (fileName.includes('..')) {\n                        res.status(404).send(\n                            get404Page(`File ${escapeHtml(fileName)} not found. Do not use relative paths!`),\n                        );\n                        return;\n                    }\n\n                    this.adapter.sendToHost(\n                        `system.host.${host}`,\n                        'getLogFile',\n                        { filename: fileName, transport },\n                        result => {\n                            const _result = result as { error?: string; data?: string; size?: number; gz?: boolean };\n                            if (!_result || _result.error) {\n                                if (_result.error) {\n                                    this.adapter.log.warn(`Cannot read log file ${fileName}: ${_result.error}`);\n                                }\n                                res.status(404).send(get404Page(`File ${escapeHtml(fileName)} not found`));\n                            } else {\n                                if (_result.gz) {\n                                    if (_result.size > 1024 * 1024) {\n                                        res.header('Content-Type', 'application/gzip');\n                                        res.send(_result.data);\n                                    } else {\n                                        try {\n                                            this.unzipFile(fileName, _result.data, res);\n                                        } catch (e) {\n                                            res.header('Content-Type', 'application/gzip');\n                                            res.send(_result.data);\n                                            this.adapter.log.error(`Cannot extract file ${fileName}: ${e}`);\n                                        }\n                                    }\n                                } else if (_result.data === undefined || _result.data === null) {\n                                    res.status(404).send(get404Page(`File ${escapeHtml(fileName)} not found`));\n                                } else if (_result.size > 2 * 1024 * 1024) {\n                                    res.header('Content-Type', 'text/plain');\n                                    res.send(_result.data);\n                                } else {\n                                    res.header('Content-Type', 'text/html');\n                                    res.send(this.decorateLogFile(fileName, _result.data));\n                                }\n                            }\n                        },\n                    );\n                } else {\n                    parts = parts.splice(2);\n                    const transport = parts.shift();\n                    let fileName = parts.join('/');\n                    const config = this.adapter.systemConfig;\n\n                    // detect file log\n                    if (transport && config?.log?.transport) {\n                        if (transport in config.log.transport && config.log.transport[transport].type === 'file') {\n                            let logFolder;\n                            if (config.log.transport[transport].filename) {\n                                parts = config.log.transport[transport].filename.replace(/\\\\/g, '/').split('/');\n                                parts.pop();\n                                logFolder = normalize(parts.join('/'));\n                            } else {\n                                logFolder = join(process.cwd(), 'log');\n                            }\n\n                            if (logFolder[0] !== '/' && logFolder[0] !== '\\\\' && !logFolder.match(/^[a-zA-Z]:/)) {\n                                const _logFolder = normalize(\n                                    join(`${this.baseDir}/../../`, logFolder).replace(/\\\\/g, '/'),\n                                ).replace(/\\\\/g, '/');\n                                if (!existsSync(_logFolder)) {\n                                    logFolder = normalize(\n                                        join(`${this.baseDir}/../`, logFolder).replace(/\\\\/g, '/'),\n                                    ).replace(/\\\\/g, '/');\n                                } else {\n                                    logFolder = _logFolder;\n                                }\n                            }\n\n                            fileName = normalize(join(logFolder, fileName).replace(/\\\\/g, '/')).replace(/\\\\/g, '/');\n\n                            if (fileName.startsWith(logFolder) && existsSync(fileName)) {\n                                const stat = lstatSync(fileName);\n                                // if a file is an archive\n                                if (fileName.toLowerCase().endsWith('.gz')) {\n                                    // try to not process to big files\n                                    if (stat.size > 1024 * 1024 /* || !existsSync('/dev/null')*/) {\n                                        res.header('Content-Type', 'application/gzip');\n                                        res.sendFile(fileName);\n                                    } else {\n                                        try {\n                                            this.unzipFile(\n                                                fileName,\n                                                readFileSync(fileName, { encoding: 'utf-8' }),\n                                                res,\n                                            );\n                                        } catch (e) {\n                                            res.header('Content-Type', 'application/gzip');\n                                            res.sendFile(fileName);\n                                            this.adapter.log.error(`Cannot extract file ${fileName}: ${e}`);\n                                        }\n                                    }\n                                } else if (stat.size > 2 * 1024 * 1024) {\n                                    res.header('Content-Type', 'text/plain');\n                                    res.sendFile(fileName);\n                                } else {\n                                    res.header('Content-Type', 'text/html');\n                                    res.send(this.decorateLogFile(fileName));\n                                }\n\n                                return;\n                            }\n                        }\n                    }\n\n                    res.status(404).send(get404Page(`File ${escapeHtml(fileName)} not found`));\n                }\n            });\n\n            const appOptions: Record<string, unknown> = {};\n            if (this.settings.cache) {\n                appOptions.maxAge = 30_758_400_000;\n            }\n\n            if (this.settings.tmpPathAllow && this.settings.tmpPath) {\n                this.server.app.use('/tmp/', express.static(this.settings.tmpPath, { maxAge: 0 }));\n                this.server.app.use(\n                    fileUpload({\n                        useTempFiles: true,\n                        tempFileDir: this.settings.tmpPath,\n                    }),\n                );\n                this.server.app.post('/upload', (req: Request, res: Response): void => {\n                    if (!req.files) {\n                        res.status(400).send('No files were uploaded.');\n                        return;\n                    }\n\n                    // The name of the input field (i.e. \"sampleFile\") is used to retrieve the uploaded file\n                    let myFile: fileUpload.UploadedFile;\n                    // take the first non-empty file\n                    for (const file of Object.values(req.files)) {\n                        if (file) {\n                            myFile = file as fileUpload.UploadedFile;\n                            break;\n                        }\n                    }\n\n                    if (myFile) {\n                        if (myFile.data && myFile.data.length > 600 * 1024 * 1024) {\n                            res.header('Content-Type', 'text/plain');\n                            res.status(500).send('File is too big. (Max 600MB)');\n                            return;\n                        }\n                        // Use the mv() method to place the file somewhere on your server\n                        myFile.mv(`${this.settings.tmpPath}/restore.iob`, err => {\n                            if (err) {\n                                res.status(500).send(escapeHtml(typeof err === 'string' ? err : JSON.stringify(err)));\n                            } else {\n                                res.header('Content-Type', 'text/plain');\n                                res.status(200).send('File uploaded!');\n                            }\n                        });\n                    } else {\n                        res.header('Content-Type', 'text/plain');\n                        res.status(500).send('File not uploaded');\n                    }\n                });\n            }\n\n            if (!existsSync(this.wwwDir)) {\n                this.server.app.use('/', (_req: Request, res: Response): void => {\n                    res.header('Content-Type', 'text/plain');\n                    res.status(404).send(\n                        'This adapter cannot be installed directly from GitHub.<br>You must install it from npm.<br>Write for that <i>\"npm install iobroker.admin\"</i> in according directory.',\n                    );\n                });\n            } else {\n                this.server.app.get('/empty.html', (_req: Request, res: Response): void => {\n                    res.status(200).send('');\n                });\n\n                this.server.app.get('/index.html', (_req: Request, res: Response): void => {\n                    this.indexHTML = this.indexHTML || this.prepareIndex();\n                    res.header('Content-Type', 'text/html');\n                    res.status(200).send(this.indexHTML);\n                });\n                this.server.app.get('/', (_req: Request, res: Response): void => {\n                    this.indexHTML = this.indexHTML || this.prepareIndex();\n                    res.header('Content-Type', 'text/html');\n                    res.status(200).send(this.indexHTML);\n                });\n\n                this.server.app.use('/', express.static(this.wwwDir, appOptions));\n            }\n\n            // reverse proxy with url rewrite for couchdb attachments in <adapter-name>.admin\n            this.server.app.use('/adapter/', (req: Request, res: Response): void => {\n                // Example: /example/?0&attr=1\n                let url: string;\n                try {\n                    url = decodeURIComponent(req.url);\n                } catch {\n                    // ignore\n                    url = req.url;\n                }\n\n                // sanitize url\n\n                // add index.html\n                url = url.replace(/\\/($|\\?|#)/, '/index.html$1');\n\n                // Read config files for admin from /adapters/admin/admin/...\n                if (url.startsWith(`/${this.adapter.name}/`)) {\n                    url = url.replace(`/${this.adapter.name}/`, this.dirName);\n                    // important: Linux does not normalize \"\\\" but readFile accepts it as '/'\n                    url = normalize(url.replace(/\\?.*/, '').replace(/\\\\/g, '/')).replace(/\\\\/g, '/');\n\n                    if (url.startsWith(this.dirName)) {\n                        try {\n                            if (existsSync(url)) {\n                                res.contentType(mime.getType(url) || 'text/javascript');\n                                createReadStream(url).pipe(res);\n                            } else {\n                                res.status(404).send(get404Page(`File not found`));\n                            }\n                        } catch (e) {\n                            res.status(404).send(get404Page(`File not found: ${escapeHtml(JSON.stringify(e))}`));\n                        }\n                    } else {\n                        res.status(404).send(get404Page(`File ${escapeHtml(url)} not found`));\n                    }\n                    return;\n                }\n\n                const parts = url.split('/');\n                // Skip first /\n                parts.shift();\n                // Get ID\n                const adapterName = parts.shift();\n                const id = `${adapterName}.admin`;\n                url = parts.join('/');\n                const pos = url.indexOf('?');\n                let _instance = 0;\n                if (pos !== -1) {\n                    _instance = parseInt(url.substring(pos + 1), 10) || 0;\n                    url = url.substring(0, pos);\n                }\n\n                if (this.settings.accessLimit) {\n                    if (url === 'index.html' || url === 'index_m.html') {\n                        const anyConfig = this.settings.accessAllowedConfigs.includes(`${adapterName}.${_instance}`);\n                        if (!anyConfig) {\n                            res.contentType('text/html');\n                            res.status(403).send('You are not allowed to access this page');\n                            return;\n                        }\n                    }\n                    if (url === 'tab.html' || url === 'tab_m.html') {\n                        const anyTabs = this.settings.accessAllowedTabs.includes(`${adapterName}.${_instance}`);\n                        if (!anyTabs) {\n                            res.contentType('text/html');\n                            res.status(403).send('You are not allowed to access this page');\n                            return;\n                        }\n                    }\n                }\n\n                // this.adapter.readFile is sanitized\n                this.adapter.readFile(id, url, null, (err, buffer, mimeType): void => {\n                    if (!buffer || err) {\n                        res.contentType('text/html');\n                        res.status(404).send(get404Page(`File ${escapeHtml(url)} not found`));\n                    } else {\n                        if (mimeType) {\n                            res.contentType(mimeType);\n                        } else {\n                            try {\n                                const _mimeType = mime.getType(url);\n                                res.contentType(_mimeType || 'text/javascript');\n                            } catch {\n                                res.contentType('text/javascript');\n                            }\n                        }\n                        res.send(buffer);\n                    }\n                });\n            });\n\n            // reverse proxy with url rewrite for couchdb attachments in <adapter-name>\n            this.server.app.use('/files/', async (req: Request, res: Response): Promise<void> => {\n                // Example: /vis.0/main/img/image.png\n                let url: string;\n                try {\n                    url = decodeURIComponent(req.url);\n                } catch {\n                    // ignore\n                    url = req.url;\n                }\n\n                // add index.html\n                url = url.replace(/\\/($|\\?|#)/, '/index.html$1');\n\n                const parts = url.split('/');\n                // Skip first /files\n                parts.shift();\n                // Get ID\n                const adapterName = parts.shift();\n                url = parts.join('/');\n                const pos = url.indexOf('?');\n                let _instance = 0;\n                if (pos !== -1) {\n                    _instance = parseInt(url.substring(pos + 1), 10) || 0;\n                    url = url.substring(0, pos);\n                }\n\n                if (this.settings.accessLimit) {\n                    if (url === 'index.html' || url === 'index_m.html') {\n                        const anyConfig = this.settings.accessAllowedConfigs.includes(`${adapterName}.${_instance}`);\n                        if (!anyConfig) {\n                            res.contentType('text/html');\n                            res.status(403).send('You are not allowed to access this page');\n                            return;\n                        }\n                    }\n                    if (url === 'tab.html' || url === 'tab_m.html') {\n                        const anyTabs = this.settings.accessAllowedTabs.includes(`${adapterName}.${_instance}`);\n                        if (!anyTabs) {\n                            res.contentType('text/html');\n                            res.status(403).send('You are not allowed to access this page');\n                            return;\n                        }\n                    }\n                }\n\n                try {\n                    if (await this.adapter.fileExists(adapterName, url)) {\n                        const { mimeType, file } = await this.adapter.readFileAsync(adapterName, url);\n\n                        // special case for svg stored into logo.png\n                        if (url.endsWith('.png') && file.length < 30000) {\n                            const str = file.toString('utf8');\n                            if (str.startsWith('<svg') || str.startsWith('<xml') || str.startsWith('<?xml')) {\n                                // it is svg\n                                res.contentType('image/svg+xml');\n                                res.send(str);\n                                return;\n                            }\n                            res.contentType('image/png');\n                        } else {\n                            res.contentType(mimeType || 'text/javascript');\n                        }\n\n                        if (adapterName === this.adapter.namespace && url.startsWith('zip/')) {\n                            // special files, that can be read-only one time\n                            this.adapter.unlink(adapterName, url, (): void => {});\n                        }\n\n                        res.send(file);\n                    } else {\n                        const filesOfDir = await readFolderRecursive(this.adapter, adapterName, url);\n\n                        const archive = archiver('zip', {\n                            zlib: { level: 9 },\n                        });\n\n                        for (const file of filesOfDir) {\n                            archive.append(file.file, { name: file.name });\n                        }\n\n                        const zip: Buffer[] = [];\n\n                        archive.on('data', chunk => zip.push(chunk));\n\n                        await archive.finalize();\n\n                        res.contentType('application/zip');\n                        res.send(Buffer.concat(zip));\n                    }\n                } catch (e) {\n                    this.adapter.log.warn(`Cannot read file (\"${adapterName}\"/\"${url}\"): ${e.message}`);\n                    res.contentType('text/html');\n                    res.status(404).send(get404Page(`File ${escapeHtml(url)} not found`));\n                }\n            });\n\n            // handler for oauth2 redirects\n            this.server.app.use('/oauth2_callbacks/', (req: Request, res: Response): void => {\n                // extract instance from \"http://localhost:8081/oauth2_callbacks/netatmo.0/?state=ABC&code=CDE\"\n                const [_instance, params] = req.url.split('?');\n                const instance = _instance.replace(/^\\//, '').replace(/\\/$/, ''); // remove last and first \"/\" in \"/netatmo.0/\"\n                const query: Record<string, string | boolean | number> = {};\n                params.split('&').forEach(param => {\n                    const [key, value] = param.split('=');\n                    query[key] = value === undefined ? true : value;\n                    if (Number.isFinite(query[key])) {\n                        query[key] = parseFloat(query[key] as string);\n                    } else if (query[key] === 'true') {\n                        query[key] = true;\n                    } else if (query[key] === 'false') {\n                        query[key] = false;\n                    }\n                });\n\n                if ((query.timeout as number) > 30_000) {\n                    query.timeout = 30_000;\n                }\n\n                let timeout: NodeJS.Timeout = setTimeout(\n                    (): void => {\n                        if (timeout) {\n                            timeout = null;\n                            let text = readFileSync(`${this.baseDir}/public/oauthError.html`).toString('utf8');\n                            text = text.replace('%LANGUAGE%', this.systemLanguage);\n                            text = text.replace('%ERROR%', 'TIMEOUT');\n                            res.setHeader('Content-Type', 'text/html');\n                            res.status(408).send(text);\n                        }\n                    },\n                    (query.timeout as number) || 5_000,\n                );\n\n                this.adapter.sendTo(instance, 'oauth2Callback', query, result => {\n                    const _result = result as { error?: string; result?: string };\n                    if (timeout) {\n                        clearTimeout(timeout);\n                        timeout = null;\n                        if (_result?.error) {\n                            let text = readFileSync(`${this.baseDir}/public/oauthError.html`).toString('utf8');\n                            text = text.replace('%LANGUAGE%', this.systemLanguage);\n                            text = text.replace('%ERROR%', _result.error);\n                            res.setHeader('Content-Type', 'text/html');\n                            res.status(500).send(text);\n                        } else {\n                            let text = readFileSync(`${this.baseDir}/public/oauthSuccess.html`).toString('utf8');\n                            text = text.replace('%LANGUAGE%', this.systemLanguage);\n                            text = text.replace('%MESSAGE%', _result?.result || '');\n                            res.setHeader('Content-Type', 'text/html');\n                            res.status(200).send(text);\n                        }\n                    }\n                });\n            });\n\n            // 404 handler\n            this.server.app.use((req: Request, res: Response): void => {\n                res.status(404).send(get404Page(`File ${escapeHtml(req.url)} not found`));\n            });\n\n            try {\n                const webserver = new IoBWebServer.WebServer({\n                    app: this.server.app,\n                    adapter: this.adapter,\n                    secure: this.settings.secure,\n                });\n                this.server.server = await webserver.init();\n            } catch (err) {\n                this.adapter.log.error(`Cannot create web-server: ${err}`);\n                if (this.adapter.terminate) {\n                    this.adapter.terminate(EXIT_CODES.ADAPTER_REQUESTED_TERMINATION);\n                } else {\n                    process.exit(EXIT_CODES.ADAPTER_REQUESTED_TERMINATION);\n                }\n                return;\n            }\n            if (!this.server.server) {\n                this.adapter.log.error(`Cannot create web-server`);\n                if (this.adapter.terminate) {\n                    this.adapter.terminate(EXIT_CODES.ADAPTER_REQUESTED_TERMINATION);\n                } else {\n                    process.exit(EXIT_CODES.ADAPTER_REQUESTED_TERMINATION);\n                }\n                return;\n            }\n\n            this.server.server.__server = this.server;\n        } else {\n            this.adapter.log.error('port missing');\n            if (this.adapter.terminate) {\n                this.adapter.terminate('port missing', EXIT_CODES.ADAPTER_REQUESTED_TERMINATION);\n            } else {\n                process.exit(EXIT_CODES.ADAPTER_REQUESTED_TERMINATION);\n            }\n        }\n\n        void this.adapter\n            .getForeignObjectAsync('system.config')\n            .then(obj => {\n                this.systemConfig = obj || {};\n                this.systemConfig.native = this.systemConfig.native || {};\n                this.systemConfig.native.vendor = this.systemConfig.native.vendor || {};\n                this.systemConfig.native.vendor.admin = this.systemConfig.native.vendor.admin || {};\n                this.systemConfig.native.vendor.admin.login = this.systemConfig.native.vendor.admin.login || {};\n\n                return this.adapter.getForeignObjectAsync('system.meta.uuid');\n            })\n            .then(obj => {\n                if (obj && obj.native) {\n                    uuid = obj.native.uuid;\n                }\n\n                if (this.server.server) {\n                    let serverListening = false;\n                    let serverPort: number;\n                    this.server.server.on('error', e => {\n                        if (e.toString().includes('EACCES') && serverPort <= 1024) {\n                            this.adapter.log.error(\n                                `node.js process has no rights to start server on the port ${serverPort}.\\n` +\n                                    `Do you know that on linux you need special permissions for ports under 1024?\\n` +\n                                    `You can call in shell following scrip to allow it for node.js: \"iobroker fix\"`,\n                            );\n                        } else {\n                            this.adapter.log.error(\n                                `Cannot start server on ${this.settings.bind || '0.0.0.0'}:${serverPort}: ${e.toString()}`,\n                            );\n                        }\n\n                        if (!serverListening) {\n                            if (this.adapter.terminate) {\n                                this.adapter.terminate(EXIT_CODES.ADAPTER_REQUESTED_TERMINATION);\n                            } else {\n                                process.exit(EXIT_CODES.ADAPTER_REQUESTED_TERMINATION);\n                            }\n                        }\n                    });\n\n                    this.settings.port = parseInt(this.settings.port as unknown as string, 10) || 8081;\n                    serverPort = this.settings.port;\n\n                    this.adapter.getPort(\n                        this.settings.port,\n                        !this.settings.bind || this.settings.bind === '0.0.0.0'\n                            ? undefined\n                            : this.settings.bind || undefined,\n                        port => {\n                            serverPort = port;\n\n                            // Start the web server\n                            this.server.server.listen(\n                                port,\n                                !this.settings.bind || this.settings.bind === '0.0.0.0'\n                                    ? undefined\n                                    : this.settings.bind || undefined,\n                                (): void => {\n                                    void this.adapter.setState('info.connection', true, true);\n\n                                    serverListening = true;\n                                    this.adapter.log.info(\n                                        `http${this.settings.secure ? 's' : ''} server listening on port ${port}`,\n                                    );\n                                    this.adapter.log.info(\n                                        `Use link \"http${\n                                            this.settings.secure ? 's' : ''\n                                        }://127.0.0.1:${port}\" to configure.`,\n                                    );\n\n                                    if (!this.adapter.config.doNotCheckPublicIP && !this.adapter.config.auth) {\n                                        this.checkTimeout = this.adapter.setTimeout(async (): Promise<void> => {\n                                            this.checkTimeout = null;\n                                            try {\n                                                await IoBWebServer.checkPublicIP(\n                                                    this.settings.port,\n                                                    'ioBroker',\n                                                    '/iobroker_check.html',\n                                                );\n                                            } catch (e) {\n                                                // this supported first from js-controller 5.0.\n                                                this.adapter.sendToHost(\n                                                    `system.host.${this.adapter.host}`,\n                                                    'addNotification',\n                                                    {\n                                                        scope: 'system',\n                                                        category: 'securityIssues',\n                                                        message:\n                                                            'Your admin instance is accessible from the internet without any protection. ' +\n                                                            'Please enable authentication or disable the access from the internet.',\n                                                        instance: `system.adapter.${this.adapter.namespace}`,\n                                                    },\n                                                    (/* result */): void => {\n                                                        /* ignore */\n                                                    },\n                                                );\n\n                                                this.adapter.log.error(e.toString());\n                                            }\n                                        }, 1000);\n                                    }\n                                },\n                            );\n\n                            if (typeof this.onReady === 'function') {\n                                this.onReady(this.server.server, this.store, this.adapter);\n                            }\n                        },\n                    );\n                }\n            });\n    }\n}\n\nexport default Web;\n"]}